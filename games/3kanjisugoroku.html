<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ¼¢å­—ã™ã”ã‚ãã‚²ãƒ¼ãƒ </title>
    <style>
        body {
            font-family: 'Hiragino Sans', 'Yu Gothic', sans-serif;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 50%, #1e3c72 100%);
            margin: 0;
            padding: 10px;
            min-height: 100vh;
            overflow-x: hidden;
            animation: backgroundShift 15s ease-in-out infinite;
        }
        
        @keyframes backgroundShift {
            0%, 100% { background: linear-gradient(135deg, #1e3c72 0%, #2a5298 50%, #1e3c72 100%); }
            33% { background: linear-gradient(135deg, #2c3e50 0%, #34495e 50%, #2c3e50 100%); }
            66% { background: linear-gradient(135deg, #0f2027 0%, #203a43 50%, #2c5364 100%); }
        }
        
        .game-container {
            max-width: 100%;
            margin: 0 auto;
            background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
            border-radius: 15px;
            padding: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            height: calc(100vh - 20px);
            display: flex;
            flex-direction: column;
            border: 2px solid #3498db;
        }
        
        .title {
            text-align: center;
            color: #3498db;
            font-size: 2rem;
            margin-bottom: 15px;
            text-shadow: 3px 3px 6px rgba(0,0,0,0.5);
            font-weight: bold;
            animation: titleGlow 2s ease-in-out infinite alternate;
        }
        
        @keyframes titleGlow {
            0% { text-shadow: 3px 3px 6px rgba(0,0,0,0.5), 0 0 20px rgba(52, 152, 219, 0.3); }
            100% { text-shadow: 3px 3px 6px rgba(0,0,0,0.5), 0 0 30px rgba(52, 152, 219, 0.6); }
        }
        
        .game-board {
            display: grid;
            grid-template-columns: repeat(10, 1fr);
            grid-template-rows: repeat(3, 1fr);
            gap: 8px;
            row-gap: 15px;
            margin: 10px 0;
            padding: 15px;
            background: linear-gradient(45deg, #34495e, #2c3e50);
            border-radius: 15px;
            border: 3px solid #3498db;
            box-shadow: 0 8px 25px rgba(52, 152, 219, 0.3);
            height: 200px;
            overflow: visible;
            max-width: 100%;
        }
        
        .cell {
            background: #fff;
            border: 1px solid #ddd;
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            position: relative;
            transition: all 0.3s ease;
            font-size: 0.7rem;
            min-height: 25px;
            max-height: 50px;
            width: 100%;
            box-sizing: border-box;
        }
        
        .cell:hover {
            transform: scale(1.05);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }
        
        .start { background: #4CAF50; color: white; }
        .goal { background: #FF6B6B; color: white; }
        .color1 { background: #FF9999; color: white; }
        .color2 { background: #99CCFF; color: white; }
        .color3 { background: #99FF99; color: white; }
        .color4 { background: #FFCC99; color: white; }
        .color5 { background: #FF99FF; color: white; }
        .color6 { background: #99FFFF; color: white; }
        .color7 { background: #FFFF99; color: #333; }
        .color8 { background: #CC99FF; color: white; }
        .color9 { background: #FFB366; color: white; }
        .color10 { background: #66FFB3; color: white; }
        
        .player {
            position: absolute;
            font-size: 2rem;
            z-index: 10;
            animation: bounce 0.5s ease;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
            filter: drop-shadow(0 0 8px rgba(255,255,255,0.8));
        }
        
        @keyframes bounce {
            0%, 100% { transform: translateY(0) scale(1); }
            50% { transform: translateY(-8px) scale(1.1); }
        }
        
        .player1 { top: -8px; left: 2px; }
        .player2 { bottom: -8px; right: 2px; }
        
        .game-info {
            display: grid;
            grid-template-columns: 1fr auto 1fr;
            gap: 15px;
            margin: 10px 0;
            flex-shrink: 0;
            align-items: center;
        }
        
        .player-info {
            background: linear-gradient(135deg, #34495e, #2c3e50);
            color: #ecf0f1;
            padding: 10px;
            border-radius: 15px;
            text-align: center;
            font-size: 0.75rem;
            border: 2px solid #7f8c8d;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            transition: all 0.3s ease;
        }
        
        .player-info.active {
            background: linear-gradient(135deg, #3498db, #2980b9);
            color: white;
            transform: scale(1.05);
            box-shadow: 0 10px 30px rgba(52, 152, 219, 0.6);
            border-color: #3498db;
            animation: activeGlow 2s ease-in-out infinite alternate;
        }
        
        @keyframes activeGlow {
            0% { box-shadow: 0 10px 30px rgba(52, 152, 219, 0.6); }
            100% { box-shadow: 0 15px 40px rgba(52, 152, 219, 0.8); }
        }
        
        .controls {
            text-align: center;
            margin: 10px 0;
            flex-shrink: 0;
        }
        
        .dice-container {
            display: inline-block;
            margin: 10px;
        }
        
        .dice {
            width: 50px;
            height: 50px;
            background: linear-gradient(135deg, #ffd93d, #ffb347);
            border: 3px solid #ff6b6b;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.3rem;
            font-weight: bold;
            margin: 0 auto 8px;
            transition: transform 0.5s ease;
            box-shadow: 0 5px 15px rgba(255, 107, 107, 0.3);
            color: #333;
        }
        
        .dice.rolling {
            animation: roll 1s ease-in-out;
        }
        
        @keyframes roll {
            0% { transform: rotate(0deg); }
            25% { transform: rotate(90deg); }
            50% { transform: rotate(180deg); }
            75% { transform: rotate(270deg); }
            100% { transform: rotate(360deg); }
        }
        
        .btn {
            background: linear-gradient(135deg, #3498db, #2980b9);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 25px;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 5px;
            box-shadow: 0 5px 15px rgba(52, 152, 219, 0.3);
            font-weight: bold;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.3);
            border: 1px solid #2980b9;
        }
        
        .btn:hover {
            transform: translateY(-3px) scale(1.05);
            box-shadow: 0 15px 25px rgba(52, 152, 219, 0.5);
            background: linear-gradient(135deg, #2980b9, #1f4e79);
        }
        
        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }
        
        .question-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }
        
        .question-content {
            background: white;
            padding: 40px;
            border-radius: 20px;
            text-align: center;
            max-width: 500px;
            width: 90%;
        }
        
        .question-text {
            font-size: 1.5rem;
            margin-bottom: 30px;
            color: #333;
        }
        
        .answer-input {
            width: 100%;
            padding: 15px;
            font-size: 1.2rem;
            border: 2px solid #3498db;
            border-radius: 10px;
            margin: 20px 0;
            text-align: center;
            background: #ecf0f1;
            color: #2c3e50;
        }
        
        .answer-input:focus {
            outline: none;
            border-color: #2980b9;
            box-shadow: 0 0 10px rgba(52, 152, 219, 0.3);
        }
        
        .submit-answer {
            background: linear-gradient(135deg, #27ae60, #2ecc71);
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 25px;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 10px;
            box-shadow: 0 5px 15px rgba(39, 174, 96, 0.3);
        }
        
        .submit-answer:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(39, 174, 96, 0.4);
        }
        
        .cards-section {
            margin-top: 10px;
            text-align: center;
            flex-shrink: 0;
        }
        
        .cards-display {
            display: flex;
            justify-content: center;
            gap: 8px;
            margin: 10px 0;
            flex-wrap: wrap;
            max-height: 80px;
            overflow-y: auto;
        }
        
        .card {
            background: linear-gradient(135deg, #ffd93d, #ff6b6b);
            color: white;
            padding: 15px;
            border-radius: 10px;
            font-weight: bold;
            min-width: 120px;
            text-align: center;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }
        
        .player-cards {
            margin-top: 10px;
            display: flex;
            flex-wrap: wrap;
            gap: 5px;
            justify-content: center;
        }
        
        .mini-card {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 5px 8px;
            border-radius: 5px;
            font-size: 0.8rem;
            cursor: pointer;
            transition: transform 0.2s ease;
        }
        
        .mini-card:hover {
            transform: scale(1.1);
        }
        
        .card-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1500;
        }
        
        .card-menu {
            background: white;
            padding: 30px;
            border-radius: 20px;
            text-align: center;
            max-width: 600px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
        }
        
        .card-list {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        
        .card-item {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 15px;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .card-item:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.3);
        }
        
        .card-description {
            font-size: 0.9rem;
            margin-top: 5px;
            opacity: 0.9;
        }
        
        .winner-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.9);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 2000;
        }
        
        .winner-content {
            background: white;
            padding: 50px;
            border-radius: 20px;
            text-align: center;
            animation: celebration 1s ease-in-out;
        }
        
        @keyframes celebration {
            0% { transform: scale(0.5) rotate(-180deg); opacity: 0; }
            100% { transform: scale(1) rotate(0deg); opacity: 1; }
        }
        
        .card-popup {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 3000;
        }
        
        .card-popup-content {
            background: linear-gradient(135deg, #ffd93d, #ff6b6b);
            color: white;
            padding: 40px;
            border-radius: 20px;
            text-align: center;
            max-width: 400px;
            width: 90%;
            animation: cardAppear 0.8s ease-out;
            box-shadow: 0 20px 40px rgba(0,0,0,0.3);
        }
        
        @keyframes cardAppear {
            0% { transform: scale(0) rotate(180deg); opacity: 0; }
            50% { transform: scale(1.2) rotate(0deg); opacity: 0.8; }
            100% { transform: scale(1) rotate(0deg); opacity: 1; }
        }
        
        .card-popup h2 {
            margin: 0 0 20px 0;
            font-size: 2rem;
        }
        
        .card-popup .card-name {
            font-size: 1.5rem;
            margin: 15px 0;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        
        .card-popup .card-desc {
            font-size: 1.1rem;
            margin: 15px 0;
            opacity: 0.9;
        }
        
        /* ãƒ¢ãƒ¼ã‚·ãƒ§ãƒ³å¼±ã‚è¨­å®šå¯¾å¿œï¼ˆé…”ã„ã‚„ã™ã„å­ã®ãŸã‚ã«ï¼‰ */
        @media (prefers-reduced-motion: reduce) {
            * { 
                animation: none !important; 
                transition: none !important; 
            }
        }
        
        .setup-screen, .instructions-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }
        
        .setup-container, .instructions-container {
            background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.3);
            border: 2px solid #3498db;
            max-width: 500px;
            width: 90%;
            text-align: center;
        }
        
        .setup-form {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        
        .input-group {
            text-align: left;
        }
        
        .input-group label {
            display: block;
            color: #ecf0f1;
            margin-bottom: 8px;
            font-weight: bold;
        }
        
        .name-input, .grade-select {
            width: 100%;
            padding: 12px;
            border: 2px solid #3498db;
            border-radius: 10px;
            font-size: 1rem;
            background: #ecf0f1;
            color: #2c3e50;
        }
        
        .name-input:focus, .grade-select:focus {
            outline: none;
            border-color: #2980b9;
            box-shadow: 0 0 10px rgba(52, 152, 219, 0.3);
        }
        
        .instructions-content {
            color: #ecf0f1;
            text-align: left;
            line-height: 1.6;
        }
        
        .instructions-content h3 {
            color: #3498db;
            margin-top: 25px;
            margin-bottom: 10px;
        }
        
        .instructions-content ol, .instructions-content ul {
            padding-left: 20px;
        }
        
        .instructions-content li {
            margin-bottom: 8px;
        }
        
        .roulette-chip{
          background: linear-gradient(135deg,#f1c40f,#f39c12);
          color:#2c3e50;
          padding:12px 16px;
          border-radius:12px;
          min-width:180px;
          text-align:center;
          border:2px solid #e67e22;
          box-shadow:0 8px 20px rgba(0,0,0,0.2);
          font-weight:bold;
          transition:transform .15s ease, box-shadow .15s ease;
        }
        .roulette-chip.active{
          transform: scale(1.08);
          box-shadow:0 12px 26px rgba(230,126,34,.45);
          border-color:#e74c3c;
        }
    </style>
</head>
<body>
    <!-- åˆæœŸè¨­å®šç”»é¢ -->
    <div class="setup-screen" id="setupScreen">
        <div class="setup-container">
            <h1 class="title">ğŸ¯ æ¼¢å­—ã™ã”ã‚ãã‚²ãƒ¼ãƒ  ğŸ¯</h1>
            <div class="setup-form">
                <div class="input-group">
                    <label>ãƒ—ãƒ¬ã‚¤äººæ•°ã‚’é¸æŠã—ã¦ãã ã•ã„</label>
                    <select id="playerCountSelect" class="grade-select" onchange="togglePlayer2Input()">
                        <option value="1">1äººãƒ—ãƒ¬ã‚¤ï¼ˆvs ã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ã‚¿ãƒ¼ï¼‰</option>
                        <option value="2">2äººãƒ—ãƒ¬ã‚¤</option>
                    </select>
                </div>

                <div class="input-group">
                    <label>ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼1ã®åå‰</label>
                    <input type="text" id="player1Name" value="ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼1" class="name-input" onfocus="this.select()">
                </div>

                <div class="input-group" id="player2Group">
                    <label>ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼2ã®åå‰</label>
                    <input type="text" id="player2Name" value="ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼2" class="name-input" onfocus="this.select()">
                </div>
                <div class="input-group">
                    <label>é›£æ˜“åº¦ã‚’é¸æŠã—ã¦ãã ã•ã„</label>
                    <select id="gradeSelect" class="grade-select">
                        <option value="4">å°å­¦æ ¡4å¹´ç”Ÿ</option>
                        <option value="5">å°å­¦æ ¡5å¹´ç”Ÿ</option>
                        <option value="6">å°å­¦æ ¡6å¹´ç”Ÿ</option>
                    </select>
                </div>
                <button class="btn setup-btn" onclick="showInstructions()">æ¬¡ã¸</button>
            </div>
        </div>
    </div>

    <!-- ã‚²ãƒ¼ãƒ èª¬æ˜ç”»é¢ -->
    <div class="instructions-screen" id="instructionsScreen" style="display: none;">
        <div class="instructions-container">
            <h1 class="title">ğŸ® ã‚²ãƒ¼ãƒ ã®èª¬æ˜ ğŸ®</h1>
            <div class="instructions-content">
                <h3>ğŸ¯ ã‚²ãƒ¼ãƒ ã®ç›®æ¨™</h3>
                <p>30ãƒã‚¹ã®Så­—å‹ã‚³ãƒ¼ã‚¹ã‚’é€²ã‚“ã§ã€æœ€åˆã«ã‚´ãƒ¼ãƒ«ã«åˆ°é”ã—ãŸãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®å‹åˆ©ã§ã™ï¼</p>
                
                <h3>ğŸ² ã‚²ãƒ¼ãƒ ã®æµã‚Œ</h3>
                <ol>
                    <li>ã‚µã‚¤ã‚³ãƒ­ã‚’æŒ¯ã£ã¦å‡ºãŸç›®ã®æ•°ã ã‘é€²ã‚ã¾ã™</li>
                    <li>æ¼¢å­—ã®å•é¡ŒãŒå‡ºé¡Œã•ã‚Œã¾ã™</li>
                    <li>æ­£è§£ã™ã‚‹ã¨é€²ã‚€ã“ã¨ãŒã§ãã€ã‚«ãƒ¼ãƒ‰ãŒã‚‚ã‚‰ãˆã‚‹ã“ã¨ãŒã‚ã‚Šã¾ã™</li>
                    <li>ä¸æ­£è§£ã®å ´åˆã¯é€²ã‚ã¾ã›ã‚“</li>
                </ol>
                
                <h3>ğŸƒ ã‚«ãƒ¼ãƒ‰ã«ã¤ã„ã¦</h3>
                <p>ã‚«ãƒ¼ãƒ‰ã«ã¯æ§˜ã€…ãªåŠ¹æœãŒã‚ã‚Šã¾ã™ï¼š</p>
                <ul>
                    <li>ğŸ² ã‚µã‚¤ã‚³ãƒ­ç³»ï¼šã‚ˆã‚Šå¤šãé€²ã‚ã‚‹</li>
                    <li>ğŸ’¥ æ”»æ’ƒç³»ï¼šç›¸æ‰‹ã‚’å¦¨å®³ã™ã‚‹</li>
                    <li>ğŸ›¡ï¸ é˜²å¾¡ç³»ï¼šæ”»æ’ƒã‹ã‚‰èº«ã‚’å®ˆã‚‹</li>
                    <li>ğŸš€ ç§»å‹•ç³»ï¼šç‰¹åˆ¥ãªç§»å‹•ãŒã§ãã‚‹</li>
                </ul>
                
                <button class="btn start-btn" onclick="startGame()">ã‚²ãƒ¼ãƒ é–‹å§‹ï¼</button>
            </div>
        </div>
    </div>

    <div class="game-container" id="gameContainer" style="display: none;">
        <h1 class="title">ğŸ¯ æ¼¢å­—ã™ã”ã‚ãã‚²ãƒ¼ãƒ  ğŸ¯</h1>
        
        <div class="game-board" id="gameBoard"></div>
        
        <div class="game-info">
            <div class="player-info active" id="player1Info">
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <div style="flex: 1;">
                        <div style="display: flex; align-items: center; gap: 10px;">
                            <h4 style="margin: 0; font-size: 0.9rem;" id="player1NameDisplay">ğŸ‘¦ ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼1</h4>
                            <button class="btn" id="useCardBtn1" onclick="showCardMenu(1)" style="display: none; font-size: 0.6rem; padding: 4px 8px;">ã‚«ãƒ¼ãƒ‰ä½¿ç”¨</button>
                        </div>
                        <div class="player-cards" id="player1CardsList"></div>
                    </div>
                </div>
            </div>
            
            <div class="dice-container" style="display: flex; flex-direction: column; align-items: center; justify-content: center;">
                <div id="diceArea" style="display: flex; gap: 5px; flex-wrap: wrap; justify-content: center;">
                    <div class="dice" id="dice">?</div>
                </div>
                <button class="btn" id="rollBtn" onclick="rollDice()" style="font-size: 1rem; padding: 12px 24px; margin: 8px;">ã‚µã‚¤ã‚³ãƒ­</button>
                <button class="btn" onclick="showQuitConfirm()" style="font-size: 0.7rem; padding: 6px 12px; background: linear-gradient(135deg, #e74c3c, #c0392b); margin-top: 15px;">ã‚²ãƒ¼ãƒ çµ‚äº†</button>
            </div>
            
            <div class="player-info" id="player2Info">
                <div style="flex: 1;">
                    <div style="display: flex; align-items: center; gap: 10px;">
                        <h4 style="margin: 0; font-size: 0.9rem;" id="player2NameDisplay">ğŸ‘§ ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼2</h4>
                        <button class="btn" id="useCardBtn2" onclick="showCardMenu(2)" style="display: none; font-size: 0.6rem; padding: 4px 8px;">ã‚«ãƒ¼ãƒ‰ä½¿ç”¨</button>
                    </div>
                    <div class="player-cards" id="player2CardsList"></div>
                </div>
            </div>
        </div>
        

        

    </div>
    
    <!-- å•é¡Œãƒ¢ãƒ¼ãƒ€ãƒ« -->
    <div class="question-modal" id="questionModal">
        <div class="question-content">
            <h3>æ¼¢å­—å•é¡Œ</h3>
            <div class="question-text" id="questionText"></div>
            <input type="text" class="answer-input" id="answerInput" placeholder="ã²ã‚‰ãŒãªã§ç­”ãˆã‚’å…¥åŠ›ã—ã¦ãã ã•ã„" onkeypress="if(event.key==='Enter') submitAnswer()">
            <button class="submit-answer" onclick="submitAnswer()">å›ç­”ã™ã‚‹</button>
        </div>
    </div>
    
    <!-- ã‚«ãƒ¼ãƒ‰ãƒ¡ãƒ‹ãƒ¥ãƒ¼ãƒ¢ãƒ¼ãƒ€ãƒ« -->
    <div class="card-modal" id="cardModal">
        <div class="card-menu">
            <h3>ã‚«ãƒ¼ãƒ‰ã‚’é¸æŠã—ã¦ãã ã•ã„</h3>
            <div class="card-list" id="cardList"></div>
            <button class="btn" onclick="closeCardMenu()">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
        </div>
    </div>
    
    <!-- ã‚«ãƒ¼ãƒ‰ç²å¾—ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ— -->
    <div class="card-popup" id="cardPopup">
        <div class="card-popup-content">
            <h2>ğŸ‰ ã‚«ãƒ¼ãƒ‰ç²å¾—ï¼ ğŸ‰</h2>
            <div class="card-name" id="popupCardName"></div>
            <div class="card-desc" id="popupCardDesc"></div>
            <button class="btn" onclick="closeCardPopup()">OK</button>
        </div>
    </div>
    
    <!-- ã‚·ãƒ¼ãƒ«ãƒ‰ç™ºå‹•ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ— -->
    <div class="card-popup" id="shieldPopup">
        <div class="card-popup-content" style="background: linear-gradient(135deg, #3498db, #2980b9);">
            <h2>ğŸ›¡ï¸ ã‚·ãƒ¼ãƒ«ãƒ‰ç™ºå‹•ï¼ ğŸ›¡ï¸</h2>
            <div class="card-name">æ”»æ’ƒã‚’é˜²ãã¾ã—ãŸï¼</div>
            <button class="btn" onclick="closeShieldPopup()">OK</button>
        </div>
    </div>
    
    <!-- æ­£è§£ãƒ»ä¸æ­£è§£ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ— -->
    <div class="card-popup" id="answerPopup">
        <div class="card-popup-content" id="answerPopupContent">
            <h2 id="answerResultTitle">ğŸ‰ æ­£è§£ï¼ ğŸ‰</h2>
            <div class="card-name" id="answerResultMessage"></div>
            <button class="btn" onclick="closeAnswerPopup()">OK</button>
        </div>
    </div>
    
    <!-- ã‚«ãƒ¼ãƒ‰ä½¿ç”¨ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ— -->
    <div class="card-popup" id="cardUsePopup">
        <div class="card-popup-content" style="background: linear-gradient(135deg, #9b59b6, #8e44ad);">
            <h2>ğŸƒ ã‚«ãƒ¼ãƒ‰ä½¿ç”¨ï¼ ğŸƒ</h2>
            <div class="card-name" id="usedCardName"></div>
            <div class="card-desc" id="usedCardDesc"></div>
            <button class="btn" onclick="closeCardUsePopup()">OK</button>
        </div>
    </div>
    
    <!-- å‹åˆ©ãƒ¢ãƒ¼ãƒ€ãƒ« -->
    <div class="winner-modal" id="winnerModal">
        <div class="winner-content">
            <h2 id="winnerText"></h2>
            <p>ğŸ‰ ãŠã‚ã§ã¨ã†ã”ã–ã„ã¾ã™ï¼ ğŸ‰</p>
            <button class="btn" onclick="resetGame()">ã‚‚ã†ä¸€åº¦éŠã¶</button>
        </div>
    </div>

    <!-- ã‚²ãƒ¼ãƒ çµ‚äº†ç¢ºèªãƒ¢ãƒ¼ãƒ€ãƒ« -->
    <div class="winner-modal" id="quitModal">
        <div class="winner-content">
            <h2>ğŸšª ã‚²ãƒ¼ãƒ çµ‚äº†</h2>
            <p>æœ¬å½“ã«ã‚²ãƒ¼ãƒ ã‚’ã‚„ã‚ã¾ã™ã‹ï¼Ÿ</p>
            <div style="display: flex; gap: 15px; justify-content: center; margin-top: 20px;">
                <button class="btn" onclick="quitGame()" style="background: linear-gradient(135deg, #e74c3c, #c0392b);">ã¯ã„</button>
                <button class="btn" onclick="closeQuitConfirm()">ã„ã„ãˆ</button>
            </div>
        </div>
    </div>

    <!-- å…ˆè¡Œãƒ«ãƒ¼ãƒ¬ãƒƒãƒˆ -->
    <div class="winner-modal" id="firstPlayerModal" style="display:none;">
      <div class="winner-content" style="max-width:520px;">
        <h2>ğŸ° å…ˆæ”»ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚’æ±ºã‚ã¾ã™</h2>
        <div id="rouletteArea" style="display:flex; gap:16px; justify-content:center; margin:20px 0;">
          <div id="rouletteP1" class="roulette-chip">ğŸ‘¦ <span id="rouletteP1Name">ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼1</span></div>
          <div id="rouletteP2" class="roulette-chip">ğŸ‘§ <span id="rouletteP2Name">ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼2</span></div>
        </div>
        <div id="rouletteMsg" style="margin:10px 0 20px; font-weight:bold;"></div>
        <button class="btn" id="rouletteStartBtn" onclick="startFirstPlayerRoulette()">ã‚¹ã‚¿ãƒ¼ãƒˆ</button>
        <button class="btn" id="rouletteProceedBtn" style="display:none;" onclick="proceedAfterRoulette()">ã“ã®é †ã§é–‹å§‹</button>
      </div>
    </div>

    <script>
// é€ä¿¡æ™‚ã®æ¯”è¼ƒã ã‘ã«ä½¿ã†â€œå¼·ã‚â€ã®æ­£è¦åŒ–ï¼ˆä»Šã¾ã§ã® toHiragana ã¨åŒç­‰ï¼‰
function normalizeForCompare(input){
  let s = input.normalize('NFKC').toLowerCase().trim();
  s = s.replace(/[\u30A1-\u30F6]/g, ch => String.fromCharCode(ch.charCodeAt(0) - 0x60)); // ã‚«ã‚¿ã‚«ãƒŠâ†’ã²ã‚‰ãŒãª
  s = s.replace(/([ã‚ã„ã†ãˆãŠ])ãƒ¼/g, '$1$1');             // ä»»æ„: é•·éŸ³å±•é–‹
  s = s.replace(/[\sã€ã€‚ï¼ãƒ»ï½¥]/g,'');                      // ä»»æ„: ç©ºç™½ãƒ»å¥èª­ç‚¹é™¤å»
  // ä»»æ„: å°æ›¸ãçµ±ä¸€
  // const map = {'ã':'ã‚','ãƒ':'ã„','ã…':'ã†','ã‡':'ãˆ','ã‰':'ãŠ','ã‚ƒ':'ã‚„','ã‚…':'ã‚†','ã‚‡':'ã‚ˆ','ã£':'ã¤','ã‚':'ã‚'};
  // s = s.replace(/[ããƒã…ã‡ã‰ã‚ƒã‚…ã‚‡ã£ã‚]/g, m => map[m] || m);
  return s;
}
// æ—¢å­˜ã‚³ãƒ¼ãƒ‰ã®äº’æ›ç”¨ï¼ˆcheckAnswer ãªã©ã¯ normalize ã‚’å‘¼ã‚“ã§ã„ã‚‹ï¼‰
const normalize = normalizeForCompare;

// å…¥åŠ›ä¸­ã®è¦‹ãŸç›®ã ã‘è»½ãæ•´ãˆã‚‹ç‰ˆï¼ˆãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ç”¨ï¼‰
// â†’ ã‚«ã‚¿ã‚«ãƒŠâ†’ã²ã‚‰ãŒãªã®ã¿ã€‚å°æ›¸ã/é•·éŸ³/ç©ºç™½ã¯è§¦ã‚‰ãªã„
function kanaLiveSanitize(input){
  let s = input.normalize('NFKC');
  return s.replace(/[\u30A1-\u30F6]/g, ch => String.fromCharCode(ch.charCodeAt(0) - 0x60));
}


        // ã‚²ãƒ¼ãƒ çŠ¶æ…‹
        let currentPlayer = 1;
        let players = {
            1: { position: 0, cards: [], shields: 0, skipTurn: false, name: "" },
            2: { position: 0, cards: [], shields: 0, skipTurn: false, name: "" }
        };
        let diceValue = 0;
        let gameEnded = false;
        let selectedGrade = 4;
        let currentQuestion = null;
        let isAIGame = false;
        let playerCount = 2;
        let turnLocked = false;
        // â˜…å¤‰æ›´: ã‚¿ãƒ¼ãƒ³æ‰€æœ‰è€…ã‚·ã‚¹ãƒ†ãƒ è¿½åŠ ï¼ˆç«¶åˆãƒã‚°ä¿®æ­£ï¼‰
        let pendingAnswerFor = null;
        // ãƒ©ãƒƒã‚­ãƒ¼6åŠ¹æœãƒ•ãƒ©ã‚°
        let lucky6Active = false;
        // AIå†å…¥é˜²æ­¢ãƒ•ãƒ©ã‚°
        let aiBusy = false;
        // ã‚¿ã‚¤ãƒãƒ¼ç®¡ç†é…åˆ—
        const timers = [];
        // ã‚«ãƒ¼ãƒ‰ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—é–‰ã˜å‡¦ç†ã®äºŒé‡å®Ÿè¡Œé˜²æ­¢
        let isClosingCardPopup = false;
        // ã‚¿ãƒ¼ãƒ³åˆ‡ã‚Šæ›¿ãˆã®äºŒé‡å®Ÿè¡Œé˜²æ­¢
        let isSwitchingTurn = false;
        // ç›´å‰ã®è§£ç­”ãŒæ­£è§£ã ã£ãŸã‹ï¼ˆæ–‡å­—åˆ—åˆ¤å®šãƒã‚°é˜²æ­¢ï¼‰
        let lastAnswerCorrect = null;
        // ã‚¿ãƒ¼ãƒ³è­˜åˆ¥å­ï¼ˆå„ã‚¿ãƒ¼ãƒ³ã®ä¸€æ„IDï¼‰
        let turnId = 0;
        
        // ãƒ«ãƒ¼ãƒ¬ãƒƒãƒˆé–¢é€£å¤‰æ•°
        let rouletteInterval = null;
        let rouletteSpins = 0;
        let rouletteDecided = null;
        
        // å­¦å¹´åˆ¥æ¼¢å­—å•é¡Œãƒ‡ãƒ¼ã‚¿
        const questionsByGrade = {
            4: [
                { question: "ã“ã®æ¼¢å­—ã®èª­ã¿æ–¹ã¯ï¼Ÿã€Œå”åŠ›ã€", answer: "ãã‚‡ã†ã‚Šã‚‡ã" },
                { question: "ã“ã®æ¼¢å­—ã®èª­ã¿æ–¹ã¯ï¼Ÿã€Œå¯¾è±¡ã€", answer: "ãŸã„ã—ã‚‡ã†" },
                { question: "ã“ã®æ¼¢å­—ã®èª­ã¿æ–¹ã¯ï¼Ÿã€Œçµæœã€", answer: "ã‘ã£ã‹" },
                { question: "ã“ã®æ¼¢å­—ã®èª­ã¿æ–¹ã¯ï¼Ÿã€Œèª¬æ•™ã€", answer: "ã›ã£ãã‚‡ã†" },
                { question: "ã“ã®æ¼¢å­—ã®èª­ã¿æ–¹ã¯ï¼Ÿã€Œç„¡å®Ÿã€", answer: "ã‚€ã˜ã¤" },
                { question: "ã“ã®æ¼¢å­—ã®èª­ã¿æ–¹ã¯ï¼Ÿã€Œé †ä½ã€", answer: "ã˜ã‚…ã‚“ã„" },
                { question: "ã“ã®æ¼¢å­—ã®èª­ã¿æ–¹ã¯ï¼Ÿã€Œè¡£é¡ã€", answer: "ã„ã‚‹ã„" },
                { question: "ã“ã®æ¼¢å­—ã®èª­ã¿æ–¹ã¯ï¼Ÿã€Œè¦æ±‚ã€", answer: "ã‚ˆã†ãã‚…ã†" },
                { question: "ã“ã®æ¼¢å­—ã®èª­ã¿æ–¹ã¯ï¼Ÿã€ŒåŠ ç†±ã€", answer: "ã‹ã­ã¤" },
                { question: "ã“ã®æ¼¢å­—ã®èª­ã¿æ–¹ã¯ï¼Ÿã€Œé–¢é€£ã€", answer: "ã‹ã‚“ã‚Œã‚“" },
                { question: "ã“ã®æ¼¢å­—ã®èª­ã¿æ–¹ã¯ï¼Ÿã€Œå®Ÿé¨“ã€", answer: "ã˜ã£ã‘ã‚“" },
                { question: "ã“ã®æ¼¢å­—ã®èª­ã¿æ–¹ã¯ï¼Ÿã€Œæ™‚å·®ã€", answer: "ã˜ã•" },
                { question: "ã“ã®æ¼¢å­—ã®èª­ã¿æ–¹ã¯ï¼Ÿã€Œæ™¯å“ã€", answer: "ã‘ã„ã²ã‚“" },
                { question: "ã“ã®æ¼¢å­—ã®èª­ã¿æ–¹ã¯ï¼Ÿã€Œå¿µé¡˜ã€", answer: "ã­ã‚“ãŒã‚“" },
                { question: "ã“ã®æ¼¢å­—ã®èª­ã¿æ–¹ã¯ï¼Ÿã€Œå…µå£«ã€", answer: "ã¸ã„ã—" },
                { question: "ã“ã®æ¼¢å­—ã®èª­ã¿æ–¹ã¯ï¼Ÿã€ŒåŒ—æ¥µã€", answer: "ã»ã£ãã‚‡ã" },
                { question: "ã“ã®æ¼¢å­—ã®èª­ã¿æ–¹ã¯ï¼Ÿã€ŒéŒ²éŸ³ã€", answer: "ã‚ããŠã‚“" },
                { question: "ã“ã®æ¼¢å­—ã®èª­ã¿æ–¹ã¯ï¼Ÿã€Œæœ€è¿‘ã€", answer: "ã•ã„ãã‚“" },
                { question: "ã“ã®æ¼¢å­—ã®èª­ã¿æ–¹ã¯ï¼Ÿã€Œé”äººã€", answer: "ãŸã¤ã˜ã‚“" },
                { question: "ã“ã®æ¼¢å­—ã®èª­ã¿æ–¹ã¯ï¼Ÿã€Œå††å‘¨ã€", answer: "ãˆã‚“ã—ã‚…ã†" },
                { question: "ã“ã®æ¼¢å­—ã®èª­ã¿æ–¹ã¯ï¼Ÿã€Œæ¬ å ´ã€", answer: "ã‘ã¤ã˜ã‚‡ã†" },
                { question: "ã“ã®æ¼¢å­—ã®èª­ã¿æ–¹ã¯ï¼Ÿã€Œæ‘æ°‘ã€", answer: "ãã‚“ã¿ã‚“" },
                { question: "ã“ã®æ¼¢å­—ã®èª­ã¿æ–¹ã¯ï¼Ÿã€Œå‡ºå¸­ã€", answer: "ã—ã‚…ã£ã›ã" },
                { question: "ã“ã®æ¼¢å­—ã®èª­ã¿æ–¹ã¯ï¼Ÿã€Œé æµ…ã€", answer: "ã¨ãŠã‚ã•" },
                { question: "ã“ã®æ¼¢å­—ã®èª­ã¿æ–¹ã¯ï¼Ÿã€Œå¯ŸçŸ¥ã€", answer: "ã•ã£ã¡" },
                { question: "ã“ã®æ¼¢å­—ã®èª­ã¿æ–¹ã¯ï¼Ÿã€Œé€šä¿¡ã€", answer: "ã¤ã†ã—ã‚“" },
                { question: "ã“ã®æ¼¢å­—ã®èª­ã¿æ–¹ã¯ï¼Ÿã€Œå…¥éšŠã€", answer: "ã«ã‚…ã†ãŸã„" },
                { question: "ã“ã®æ¼¢å­—ã®èª­ã¿æ–¹ã¯ï¼Ÿã€Œç¨®é¡ã€", answer: "ã—ã‚…ã‚‹ã„" },
                { question: "ã“ã®æ¼¢å­—ã®èª­ã¿æ–¹ã¯ï¼Ÿã€Œç²‰æœ«ã€", answer: "ãµã‚“ã¾ã¤" },
                { question: "ã“ã®æ¼¢å­—ã®èª­ã¿æ–¹ã¯ï¼Ÿã€Œå¹´è¼ªã€", answer: "ã­ã‚“ã‚Šã‚“" },
                { question: "ã“ã®æ¼¢å­—ã®èª­ã¿æ–¹ã¯ï¼Ÿã€Œæ°´ä½ã€", answer: "ã™ã„ã„" },
                { question: "ã“ã®æ¼¢å­—ã®èª­ã¿æ–¹ã¯ï¼Ÿã€Œæœªå®šã€", answer: "ã¿ã¦ã„" },
                { question: "ã“ã®æ¼¢å­—ã®èª­ã¿æ–¹ã¯ï¼Ÿã€ŒåŠ å…¥ã€", answer: "ã‹ã«ã‚…ã†" },
                { question: "ã“ã®æ¼¢å­—ã®èª­ã¿æ–¹ã¯ï¼Ÿã€Œæ®‹æš‘ã€", answer: "ã–ã‚“ã—ã‚‡" },
                { question: "ã“ã®æ¼¢å­—ã®èª­ã¿æ–¹ã¯ï¼Ÿã€Œå°åŒ…ã€", answer: "ã“ã¥ã¤ã¿" },
                { question: "ã“ã®æ¼¢å­—ã®èª­ã¿æ–¹ã¯ï¼Ÿã€Œæº€ç‚¹ã€", answer: "ã¾ã‚“ã¦ã‚“" },
                { question: "ã“ã®æ¼¢å­—ã®èª­ã¿æ–¹ã¯ï¼Ÿã€Œå½“ç„¶ã€", answer: "ã¨ã†ãœã‚“" },
                { question: "ã“ã®æ¼¢å­—ã®èª­ã¿æ–¹ã¯ï¼Ÿã€Œé–¢ä¿‚ã€", answer: "ã‹ã‚“ã‘ã„" },
                { question: "ã“ã®æ¼¢å­—ã®èª­ã¿æ–¹ã¯ï¼Ÿã€Œæ¡ˆå†…ã€", answer: "ã‚ã‚“ãªã„" },
                { question: "ã“ã®æ¼¢å­—ã®èª­ã¿æ–¹ã¯ï¼Ÿã€Œå‹ç´™ã€", answer: "ã‹ãŸãŒã¿" },
                { question: "ã“ã®æ¼¢å­—ã®èª­ã¿æ–¹ã¯ï¼Ÿã€Œé¢ç©ã€", answer: "ã‚ã‚“ã›ã" },
                { question: "ã“ã®æ¼¢å­—ã®èª­ã¿æ–¹ã¯ï¼Ÿã€Œè¿½åŠ ã€", answer: "ã¤ã„ã‹" },
                { question: "ã“ã®æ¼¢å­—ã®èª­ã¿æ–¹ã¯ï¼Ÿã€Œå¹´æœ«ã€", answer: "ã­ã‚“ã¾ã¤" },
                { question: "ã“ã®æ¼¢å­—ã®èª­ã¿æ–¹ã¯ï¼Ÿã€Œæœ¨æã€", answer: "ã‚‚ãã–ã„" },
                { question: "ã“ã®æ¼¢å­—ã®èª­ã¿æ–¹ã¯ï¼Ÿã€Œå›½æ°‘ã€", answer: "ã“ãã¿ã‚“" },
                { question: "ã“ã®æ¼¢å­—ã®èª­ã¿æ–¹ã¯ï¼Ÿã€Œæ³•äº‹ã€", answer: "ã»ã†ã˜" },
                { question: "ã“ã®æ¼¢å­—ã®èª­ã¿æ–¹ã¯ï¼Ÿã€Œå…µå™¨ã€", answer: "ã¸ã„ã" },
                { question: "ã“ã®æ¼¢å­—ã®èª­ã¿æ–¹ã¯ï¼Ÿã€Œä¿¡å·ã€", answer: "ã—ã‚“ã”ã†" },
                { question: "ã“ã®æ¼¢å­—ã®èª­ã¿æ–¹ã¯ï¼Ÿã€Œå€‰åº«ã€", answer: "ãã†ã“" },
                { question: "ã“ã®æ¼¢å­—ã®èª­ã¿æ–¹ã¯ï¼Ÿã€Œå…µéšŠã€", answer: "ã¸ã„ãŸã„" },
                { question: "ã“ã®æ¼¢å­—ã®èª­ã¿æ–¹ã¯ï¼Ÿã€Œæ°—å€™ã€", answer: "ãã“ã†" },
                { question: "ã“ã®æ¼¢å­—ã®èª­ã¿æ–¹ã¯ï¼Ÿã€Œæœ­æŸã€", answer: "ã•ã¤ãŸã°" },
                { question: "ã“ã®æ¼¢å­—ã®èª­ã¿æ–¹ã¯ï¼Ÿã€Œå¾’æ­©ã€", answer: "ã¨ã»" },
                { question: "ã“ã®æ¼¢å­—ã®èª­ã¿æ–¹ã¯ï¼Ÿã€ŒéŒ²ç”»ã€", answer: "ã‚ããŒ" },
                { question: "ã“ã®æ¼¢å­—ã®èª­ã¿æ–¹ã¯ï¼Ÿã€Œå¤§è‡£ã€", answer: "ã ã„ã˜ã‚“" },
                { question: "ã“ã®æ¼¢å­—ã®èª­ã¿æ–¹ã¯ï¼Ÿã€Œä¼šè²»ã€", answer: "ã‹ã„ã²" },
                { question: "ã“ã®æ¼¢å­—ã®èª­ã¿æ–¹ã¯ï¼Ÿã€Œæ–¹æ³•ã€", answer: "ã»ã†ã»ã†" },
                { question: "ã“ã®æ¼¢å­—ã®èª­ã¿æ–¹ã¯ï¼Ÿã€Œå…±ç”¨ã€", answer: "ãã‚‡ã†ã‚ˆã†" },
                { question: "ã“ã®æ¼¢å­—ã®èª­ã¿æ–¹ã¯ï¼Ÿã€Œæ©Ÿæ¢°ã€", answer: "ãã‹ã„" },
                { question: "ã“ã®æ¼¢å­—ã®èª­ã¿æ–¹ã¯ï¼Ÿã€Œè¦³å®¢ã€", answer: "ã‹ã‚“ãã‚ƒã" },
                { question: "ã“ã®æ¼¢å­—ã®èª­ã¿æ–¹ã¯ï¼Ÿã€Œæ„›çŠ¬ã€", answer: "ã‚ã„ã‘ã‚“" },
                { question: "ã“ã®æ¼¢å­—ã®èª­ã¿æ–¹ã¯ï¼Ÿã€Œå‘½ä»¤ã€", answer: "ã‚ã„ã‚Œã„" },
                { question: "ã“ã®æ¼¢å­—ã®èª­ã¿æ–¹ã¯ï¼Ÿã€Œç¥ç¦ã€", answer: "ã—ã‚…ããµã" },
                { question: "ã“ã®æ¼¢å­—ã®èª­ã¿æ–¹ã¯ï¼Ÿã€Œæ¥½å™¨ã€", answer: "ãŒã£ã" },
                { question: "ã“ã®æ¼¢å­—ã®èª­ã¿æ–¹ã¯ï¼Ÿã€Œè‰¯è–¬ã€", answer: "ã‚Šã‚‡ã†ã‚„ã" },
                { question: "ã“ã®æ¼¢å­—ã®èª­ã¿æ–¹ã¯ï¼Ÿã€Œè»æ‰‹ã€", answer: "ãã‚“ã¦" },
                { question: "ã“ã®æ¼¢å­—ã®èª­ã¿æ–¹ã¯ï¼Ÿã€ŒçµæŸã€", answer: "ã‘ã£ãã" },
                { question: "ã“ã®æ¼¢å­—ã®èª­ã¿æ–¹ã¯ï¼Ÿã€Œé€£ç¶šã€", answer: "ã‚Œã‚“ãã" },
                { question: "ã“ã®æ¼¢å­—ã®èª­ã¿æ–¹ã¯ï¼Ÿã€Œåæœ­ã€", answer: "ãªãµã " },
                { question: "ã“ã®æ¼¢å­—ã®èª­ã¿æ–¹ã¯ï¼Ÿã€Œæ”¾ç½®ã€", answer: "ã»ã†ã¡" },
                { question: "ã“ã®æ¼¢å­—ã®èª­ã¿æ–¹ã¯ï¼Ÿã€Œæ–‡è„ˆã€", answer: "ã¶ã‚“ã¿ã‚ƒã" },
                { question: "ã“ã®æ¼¢å­—ã®èª­ã¿æ–¹ã¯ï¼Ÿã€Œå¤«äººã€", answer: "ãµã˜ã‚“" },
                { question: "ã“ã®æ¼¢å­—ã®èª­ã¿æ–¹ã¯ï¼Ÿã€Œå†·é™ã€", answer: "ã‚Œã„ã›ã„" },
                { question: "ã“ã®æ¼¢å­—ã®èª­ã¿æ–¹ã¯ï¼Ÿã€Œé”æˆã€", answer: "ãŸã£ã›ã„" },
                { question: "ã“ã®æ¼¢å­—ã®èª­ã¿æ–¹ã¯ï¼Ÿã€Œä¼šè­°ã€", answer: "ã‹ã„ã" },
                { question: "ã“ã®æ¼¢å­—ã®èª­ã¿æ–¹ã¯ï¼Ÿã€Œè¦ç‚¹ã€", answer: "ã‚ˆã†ã¦ã‚“" },
                { question: "ã“ã®æ¼¢å­—ã®èª­ã¿æ–¹ã¯ï¼Ÿã€Œå›½ç”£ã€", answer: "ã“ãã•ã‚“" },
                { question: "ã“ã®æ¼¢å­—ã®èª­ã¿æ–¹ã¯ï¼Ÿã€ŒæŠ•ç¥¨ã€", answer: "ã¨ã†ã²ã‚‡ã†" },
                { question: "ã“ã®æ¼¢å­—ã®èª­ã¿æ–¹ã¯ï¼Ÿã€Œæ¶ˆå°ã€", answer: "ã‘ã—ã„ã‚“" },
                { question: "ã“ã®æ¼¢å­—ã®èª­ã¿æ–¹ã¯ï¼Ÿã€Œç™ºé”ã€", answer: "ã¯ã£ãŸã¤" },
                { question: "ã“ã®æ¼¢å­—ã®èª­ã¿æ–¹ã¯ï¼Ÿã€Œé‡è¦ã€", answer: "ã˜ã‚…ã†ã‚ˆã†" },
                { question: "ã“ã®æ¼¢å­—ã®èª­ã¿æ–¹ã¯ï¼Ÿã€Œç›®å°ã€", answer: "ã‚ã˜ã‚‹ã—" },
                { question: "ã“ã®æ¼¢å­—ã®èª­ã¿æ–¹ã¯ï¼Ÿã€Œå¾—ç‚¹ã€", answer: "ã¨ãã¦ã‚“" },
                { question: "ã“ã®æ¼¢å­—ã®èª­ã¿æ–¹ã¯ï¼Ÿã€Œè»éšŠã€", answer: "ãã‚“ãŸã„" },
                { question: "ã“ã®æ¼¢å­—ã®èª­ã¿æ–¹ã¯ï¼Ÿã€Œæ¸…æµã€", answer: "ã›ã„ã‚Šã‚…ã†" },
                { question: "ã“ã®æ¼¢å­—ã®èª­ã¿æ–¹ã¯ï¼Ÿã€Œå¾—æ„ã€", answer: "ã¨ãã„" },
                { question: "ã“ã®æ¼¢å­—ã®èª­ã¿æ–¹ã¯ï¼Ÿã€Œæµ´å®¤ã€", answer: "ã‚ˆãã—ã¤" },
                { question: "ã“ã®æ¼¢å­—ã®èª­ã¿æ–¹ã¯ï¼Ÿã€Œå±±è„ˆã€", answer: "ã•ã‚“ã¿ã‚ƒã" },
                { question: "ã“ã®æ¼¢å­—ã®èª­ã¿æ–¹ã¯ï¼Ÿã€Œé¡˜æœ›ã€", answer: "ãŒã‚“ã¼ã†" },
                { question: "ã“ã®æ¼¢å­—ã®èª­ã¿æ–¹ã¯ï¼Ÿã€Œå‘¨è¾ºã€", answer: "ã—ã‚…ã†ã¸ã‚“" },
                { question: "ã“ã®æ¼¢å­—ã®èª­ã¿æ–¹ã¯ï¼Ÿã€Œå‡ºè²»ã€", answer: "ã—ã‚…ã£ã´" },
                { question: "ã“ã®æ¼¢å­—ã®èª­ã¿æ–¹ã¯ï¼Ÿã€Œç›®æ¨™ã€", answer: "ã‚‚ãã²ã‚‡ã†" },
                { question: "ã“ã®æ¼¢å­—ã®èª­ã¿æ–¹ã¯ï¼Ÿã€Œä¿¡ç”¨ã€", answer: "ã—ã‚“ã‚ˆã†" },
                { question: "ã“ã®æ¼¢å­—ã®èª­ã¿æ–¹ã¯ï¼Ÿã€Œè¦³å¯Ÿã€", answer: "ã‹ã‚“ã•ã¤" },
                { question: "ã“ã®æ¼¢å­—ã®èª­ã¿æ–¹ã¯ï¼Ÿã€Œè¾æ›¸ã€", answer: "ã˜ã—ã‚‡" },
                { question: "ã“ã®æ¼¢å­—ã®èª­ã¿æ–¹ã¯ï¼Ÿã€Œå¸­é †ã€", answer: "ã›ãã˜ã‚…ã‚“" },
                { question: "ã“ã®æ¼¢å­—ã®èª­ã¿æ–¹ã¯ï¼Ÿã€Œç”Ÿç”£ã€", answer: "ã›ã„ã•ã‚“" },
                { question: "ã“ã®æ¼¢å­—ã®èª­ã¿æ–¹ã¯ï¼Ÿã€Œå¡©å®³ã€", answer: "ãˆã‚“ãŒã„" },
                { question: "ã“ã®æ¼¢å­—ã®èª­ã¿æ–¹ã¯ï¼Ÿã€Œé£›è¡Œã€", answer: "ã²ã“ã†" },
                { question: "ã“ã®æ¼¢å­—ã®èª­ã¿æ–¹ã¯ï¼Ÿã€Œå¤§é™¸ã€", answer: "ãŸã„ã‚Šã" }
            ],
            5: [
                { question: "ã“ã®æ¼¢å­—ã®èª­ã¿æ–¹ã¯ï¼Ÿã€Œè¼¸é€ã€", answer: "ã‚†ãã†" },
                { question: "ã“ã®æ¼¢å­—ã®èª­ã¿æ–¹ã¯ï¼Ÿã€Œæƒ…ç†±ã€", answer: "ã˜ã‚‡ã†ã­ã¤" },
                { question: "ã“ã®æ¼¢å­—ã®èª­ã¿æ–¹ã¯ï¼Ÿã€Œå›å¾©ã€", answer: "ã‹ã„ãµã" },
                { question: "ã“ã®æ¼¢å­—ã®èª­ã¿æ–¹ã¯ï¼Ÿã€Œæ¶²ä½“ã€", answer: "ãˆããŸã„" },
                { question: "ã“ã®æ¼¢å­—ã®èª­ã¿æ–¹ã¯ï¼Ÿã€Œç¿’æ…£ã€", answer: "ã—ã‚…ã†ã‹ã‚“" },
                { question: "ã“ã®æ¼¢å­—ã®èª­ã¿æ–¹ã¯ï¼Ÿã€Œæ ¼å®‰ã€", answer: "ã‹ãã‚„ã™" },
                { question: "ã“ã®æ¼¢å­—ã®èª­ã¿æ–¹ã¯ï¼Ÿã€Œç¦ç‰©ã€", answer: "ãã‚“ã‚‚ã¤" },
                { question: "ã“ã®æ¼¢å­—ã®èª­ã¿æ–¹ã¯ï¼Ÿã€Œç‹¬ç‰¹ã€", answer: "ã©ãã¨ã" },
                { question: "ã“ã®æ¼¢å­—ã®èª­ã¿æ–¹ã¯ï¼Ÿã€Œè³›æˆã€", answer: "ã•ã‚“ã›ã„" },
                { question: "ã“ã®æ¼¢å­—ã®èª­ã¿æ–¹ã¯ï¼Ÿã€Œå®¶è²¡ã€", answer: "ã‹ã–ã„" },
                { question: "ã“ã®æ¼¢å­—ã®èª­ã¿æ–¹ã¯ï¼Ÿã€Œåå‰‡ã€", answer: "ã¯ã‚“ãã" },
                { question: "ã“ã®æ¼¢å­—ã®èª­ã¿æ–¹ã¯ï¼Ÿã€Œç¢ºå®šã€", answer: "ã‹ãã¦ã„" },
                { question: "ã“ã®æ¼¢å­—ã®èª­ã¿æ–¹ã¯ï¼Ÿã€ŒçŠ¯è¡Œã€", answer: "ã¯ã‚“ã“ã†" },
                { question: "ã“ã®æ¼¢å­—ã®èª­ã¿æ–¹ã¯ï¼Ÿã€Œæ²³å£ã€", answer: "ã‹ã“ã†" },
                { question: "ã“ã®æ¼¢å­—ã®èª­ã¿æ–¹ã¯ï¼Ÿã€Œæ­£ç¢ºã€", answer: "ã›ã„ã‹ã" },
                { question: "ã“ã®æ¼¢å­—ã®èª­ã¿æ–¹ã¯ï¼Ÿã€Œé…¸å‘³ã€", answer: "ã•ã‚“ã¿" },
                { question: "ã“ã®æ¼¢å­—ã®èª­ã¿æ–¹ã¯ï¼Ÿã€Œæƒ…å ±ã€", answer: "ã˜ã‚‡ã†ã»ã†" },
                { question: "ã“ã®æ¼¢å­—ã®èª­ã¿æ–¹ã¯ï¼Ÿã€ŒåŸå› ã€", answer: "ã’ã‚“ã„ã‚“" },
                { question: "ã“ã®æ¼¢å­—ã®èª­ã¿æ–¹ã¯ï¼Ÿã€Œç‰ˆç”»ã€", answer: "ã¯ã‚“ãŒ" },
                { question: "ã“ã®æ¼¢å­—ã®èª­ã¿æ–¹ã¯ï¼Ÿã€ŒåŠ¹èƒ½ã€", answer: "ã“ã†ã®ã†" },
                { question: "ã“ã®æ¼¢å­—ã®èª­ã¿æ–¹ã¯ï¼Ÿã€Œå†…å®¹ã€", answer: "ãªã„ã‚ˆã†" },
                { question: "ã“ã®æ¼¢å­—ã®èª­ã¿æ–¹ã¯ï¼Ÿã€Œè¨¼æ˜ã€", answer: "ã—ã‚‡ã†ã‚ã„" },
                { question: "ã“ã®æ¼¢å­—ã®èª­ã¿æ–¹ã¯ï¼Ÿã€ŒçµŒè·¯ã€", answer: "ã‘ã„ã‚" },
                { question: "ã“ã®æ¼¢å­—ã®èª­ã¿æ–¹ã¯ï¼Ÿã€Œè¬›ç¿’ã€", answer: "ã“ã†ã—ã‚…ã†" },
                { question: "ã“ã®æ¼¢å­—ã®èª­ã¿æ–¹ã¯ï¼Ÿã€Œæ¥ç¶šã€", answer: "ã›ã¤ãã" },
                { question: "ã“ã®æ¼¢å­—ã®èª­ã¿æ–¹ã¯ï¼Ÿã€Œå¼•é€€ã€", answer: "ã„ã‚“ãŸã„" },
                { question: "ã“ã®æ¼¢å­—ã®èª­ã¿æ–¹ã¯ï¼Ÿã€Œæˆç¸¾ã€", answer: "ã›ã„ã›ã" },
                { question: "ã“ã®æ¼¢å­—ã®èª­ã¿æ–¹ã¯ï¼Ÿã€Œå¯¾å¿œã€", answer: "ãŸã„ãŠã†" },
                { question: "ã“ã®æ¼¢å­—ã®èª­ã¿æ–¹ã¯ï¼Ÿã€ŒçµŒé¨“ã€", answer: "ã‘ã„ã‘ã‚“" },
                { question: "ã“ã®æ¼¢å­—ã®èª­ã¿æ–¹ã¯ï¼Ÿã€Œå…ˆç¥–ã€", answer: "ã›ã‚“ã" },
                { question: "ã“ã®æ¼¢å­—ã®èª­ã¿æ–¹ã¯ï¼Ÿã€Œè¡¨æƒ…ã€", answer: "ã²ã‚‡ã†ã˜ã‚‡ã†" },
                { question: "ã“ã®æ¼¢å­—ã®èª­ã¿æ–¹ã¯ï¼Ÿã€Œè¤‡æ•°ã€", answer: "ãµãã™ã†" },
                { question: "ã“ã®æ¼¢å­—ã®èª­ã¿æ–¹ã¯ï¼Ÿã€Œå¿µä»ã€", answer: "ã­ã‚“ã¶ã¤" },
                { question: "ã“ã®æ¼¢å­—ã®èª­ã¿æ–¹ã¯ï¼Ÿã€Œé é‡‘ã€", answer: "ã‚ˆãã‚“" },
                { question: "ã“ã®æ¼¢å­—ã®èª­ã¿æ–¹ã¯ï¼Ÿã€Œé©åº¦ã€", answer: "ã¦ãã©" },
                { question: "ã“ã®æ¼¢å­—ã®èª­ã¿æ–¹ã¯ï¼Ÿã€Œå¿«å¾©ã€", answer: "ã‹ã„ãµã" },
                { question: "ã“ã®æ¼¢å­—ã®èª­ã¿æ–¹ã¯ï¼Ÿã€Œä¾¡æ ¼ã€", answer: "ã‹ã‹ã" },
                { question: "ã“ã®æ¼¢å­—ã®èª­ã¿æ–¹ã¯ï¼Ÿã€Œç±³ä¿µã€", answer: "ã“ã‚ã ã‚ã‚‰" },
                { question: "ã“ã®æ¼¢å­—ã®èª­ã¿æ–¹ã¯ï¼Ÿã€Œæš´åŠ›ã€", answer: "ã¼ã†ã‚Šã‚‡ã" },
                { question: "ã“ã®æ¼¢å­—ã®èª­ã¿æ–¹ã¯ï¼Ÿã€Œå¾€å¾©ã€", answer: "ãŠã†ãµã" },
                { question: "ã“ã®æ¼¢å­—ã®èª­ã¿æ–¹ã¯ï¼Ÿã€Œæç¤ºã€", answer: "ã¦ã„ã˜" },
                { question: "ã“ã®æ¼¢å­—ã®èª­ã¿æ–¹ã¯ï¼Ÿã€Œç‹¬å­¦ã€", answer: "ã©ããŒã" },
                { question: "ã“ã®æ¼¢å­—ã®èª­ã¿æ–¹ã¯ï¼Ÿã€Œé©å½“ã€", answer: "ã¦ãã¨ã†" },
                { question: "ã“ã®æ¼¢å­—ã®èª­ã¿æ–¹ã¯ï¼Ÿã€Œäººæƒ…ã€", answer: "ã«ã‚“ã˜ã‚‡ã†" },
                { question: "ã“ã®æ¼¢å­—ã®èª­ã¿æ–¹ã¯ï¼Ÿã€Œå¼·æ•µã€", answer: "ãã‚‡ã†ã¦ã" },
                { question: "ã“ã®æ¼¢å­—ã®èª­ã¿æ–¹ã¯ï¼Ÿã€Œä¸»å©¦ã€", answer: "ã—ã‚…ãµ" },
                { question: "ã“ã®æ¼¢å­—ã®èª­ã¿æ–¹ã¯ï¼Ÿã€Œè¦åˆ¶ã€", answer: "ãã›ã„" },
                { question: "ã“ã®æ¼¢å­—ã®èª­ã¿æ–¹ã¯ï¼Ÿã€Œä½å±…ã€", answer: "ã˜ã‚…ã†ãã‚‡" },
                { question: "ã“ã®æ¼¢å­—ã®èª­ã¿æ–¹ã¯ï¼Ÿã€Œå€ç‡ã€", answer: "ã°ã„ã‚Šã¤" },
                { question: "ã“ã®æ¼¢å­—ã®èª­ã¿æ–¹ã¯ï¼Ÿã€Œç¥–çˆ¶ã€", answer: "ããµ" },
                { question: "ã“ã®æ¼¢å­—ã®èª­ã¿æ–¹ã¯ï¼Ÿã€Œè¡¨ç¤ºã€", answer: "ã²ã‚‡ã†ã˜" },
                { question: "ã“ã®æ¼¢å­—ã®èª­ã¿æ–¹ã¯ï¼Ÿã€Œæ—§å‹ã€", answer: "ãã‚…ã†ã‚†ã†" },
                { question: "ã“ã®æ¼¢å­—ã®èª­ã¿æ–¹ã¯ï¼Ÿã€Œæ¥­ç¸¾ã€", answer: "ãã‚‡ã†ã›ã" },
                { question: "ã“ã®æ¼¢å­—ã®èª­ã¿æ–¹ã¯ï¼Ÿã€Œæ¸›é€Ÿã€", answer: "ã’ã‚“ãã" },
                { question: "ã“ã®æ¼¢å­—ã®èª­ã¿æ–¹ã¯ï¼Ÿã€Œæ¸…æ½”ã€", answer: "ã›ã„ã‘ã¤" },
                { question: "ã“ã®æ¼¢å­—ã®èª­ã¿æ–¹ã¯ï¼Ÿã€Œæ¡ç‚¹ã€", answer: "ã•ã„ã¦ã‚“" },
                { question: "ã“ã®æ¼¢å­—ã®èª­ã¿æ–¹ã¯ï¼Ÿã€ŒåŒå±…ã€", answer: "ã©ã†ãã‚‡" },
                { question: "ã“ã®æ¼¢å­—ã®èª­ã¿æ–¹ã¯ï¼Ÿã€Œå¢—ç¯‰ã€", answer: "ãã†ã¡ã" },
                { question: "ã“ã®æ¼¢å­—ã®èª­ã¿æ–¹ã¯ï¼Ÿã€Œå‹¢åŠ›ã€", answer: "ã›ã„ã‚Šã‚‡ã" },
                { question: "ã“ã®æ¼¢å­—ã®èª­ã¿æ–¹ã¯ï¼Ÿã€Œç¾å ´ã€", answer: "ã’ã‚“ã°" },
                { question: "ã“ã®æ¼¢å­—ã®èª­ã¿æ–¹ã¯ï¼Ÿã€Œæ¡å–ã€", answer: "ã•ã„ã—ã‚…" },
                { question: "ã“ã®æ¼¢å­—ã®èª­ã¿æ–¹ã¯ï¼Ÿã€Œçµ¶è³›ã€", answer: "ãœã£ã•ã‚“" },
                { question: "ã“ã®æ¼¢å­—ã®èª­ã¿æ–¹ã¯ï¼Ÿã€Œæ ¡èˆã€", answer: "ã“ã†ã—ã‚ƒ" },
                { question: "ã“ã®æ¼¢å­—ã®èª­ã¿æ–¹ã¯ï¼Ÿã€Œçµ¶å¯¾ã€", answer: "ãœã£ãŸã„" },
                { question: "ã“ã®æ¼¢å­—ã®èª­ã¿æ–¹ã¯ï¼Ÿã€Œç²¾ç±³ã€", answer: "ã›ã„ã¾ã„" },
                { question: "ã“ã®æ¼¢å­—ã®èª­ã¿æ–¹ã¯ï¼Ÿã€Œç”»åƒã€", answer: "ãŒãã†" },
                { question: "ã“ã®æ¼¢å­—ã®èª­ã¿æ–¹ã¯ï¼Ÿã€Œç¾©ç†ã€", answer: "ãã‚Š" },
                { question: "ã“ã®æ¼¢å­—ã®èª­ã¿æ–¹ã¯ï¼Ÿã€Œæè±†ã€", answer: "ãˆã ã¾ã‚" },
                { question: "ã“ã®æ¼¢å­—ã®èª­ã¿æ–¹ã¯ï¼Ÿã€Œå‡ç­‰ã€", answer: "ãã‚“ã¨ã†" },
                { question: "ã“ã®æ¼¢å­—ã®èª­ã¿æ–¹ã¯ï¼Ÿã€Œè¨˜è¿°ã€", answer: "ãã˜ã‚…ã¤" },
                { question: "ã“ã®æ¼¢å­—ã®èª­ã¿æ–¹ã¯ï¼Ÿã€Œæ°´è³ªã€", answer: "ã™ã„ã—ã¤" },
                { question: "ã“ã®æ¼¢å­—ã®èª­ã¿æ–¹ã¯ï¼Ÿã€Œå¸¸è­˜ã€", answer: "ã˜ã‚‡ã†ã—ã" },
                { question: "ã“ã®æ¼¢å­—ã®èª­ã¿æ–¹ã¯ï¼Ÿã€Œæ–‡å¥ã€", answer: "ã‚‚ã‚“ã" },
                { question: "ã“ã®æ¼¢å­—ã®èª­ã¿æ–¹ã¯ï¼Ÿã€Œå€‹ä½“ã€", answer: "ã“ãŸã„" },
                { question: "ã“ã®æ¼¢å­—ã®èª­ã¿æ–¹ã¯ï¼Ÿã€Œç¨é‡‘ã€", answer: "ãœã„ãã‚“" },
                { question: "ã“ã®æ¼¢å­—ã®èª­ã¿æ–¹ã¯ï¼Ÿã€Œé˜²çŠ¯ã€", answer: "ã¼ã†ã¯ã‚“" },
                { question: "ã“ã®æ¼¢å­—ã®èª­ã¿æ–¹ã¯ï¼Ÿã€Œå¤©æ•µã€", answer: "ã¦ã‚“ã¦ã" },
                { question: "ã“ã®æ¼¢å­—ã®èª­ã¿æ–¹ã¯ï¼Ÿã€Œé›‘è‰ã€", answer: "ã–ã£ãã†" },
                { question: "ã“ã®æ¼¢å­—ã®èª­ã¿æ–¹ã¯ï¼Ÿã€Œæ‰€å±ã€", answer: "ã—ã‚‡ãã" },
                { question: "ã“ã®æ¼¢å­—ã®èª­ã¿æ–¹ã¯ï¼Ÿã€Œçœ¼ç§‘ã€", answer: "ãŒã‚“ã‹" },
                { question: "ã“ã®æ¼¢å­—ã®èª­ã¿æ–¹ã¯ï¼Ÿã€Œé€€é™¢ã€", answer: "ãŸã„ã„ã‚“" },
                { question: "ã“ã®æ¼¢å­—ã®èª­ã¿æ–¹ã¯ï¼Ÿã€Œè±Šå¯Œã€", answer: "ã»ã†ãµ" },
                { question: "ã“ã®æ¼¢å­—ã®èª­ã¿æ–¹ã¯ï¼Ÿã€Œç½å®³ã€", answer: "ã•ã„ãŒã„" },
                { question: "ã“ã®æ¼¢å­—ã®èª­ã¿æ–¹ã¯ï¼Ÿã€Œè©•ä¾¡ã€", answer: "ã²ã‚‡ã†ã‹" },
                { question: "ã“ã®æ¼¢å­—ã®èª­ã¿æ–¹ã¯ï¼Ÿã€Œæ”¯åº—ã€", answer: "ã—ã¦ã‚“" },
                { question: "ã“ã®æ¼¢å­—ã®èª­ã¿æ–¹ã¯ï¼Ÿã€Œææ¡ˆã€", answer: "ã¦ã„ã‚ã‚“" },
                { question: "ã“ã®æ¼¢å­—ã®èª­ã¿æ–¹ã¯ï¼Ÿã€Œé€†å¢ƒã€", answer: "ãã‚ƒã£ãã‚‡ã†" },
                { question: "ã“ã®æ¼¢å­—ã®èª­ã¿æ–¹ã¯ï¼Ÿã€Œæ··é›‘ã€", answer: "ã“ã‚“ã–ã¤" },
                { question: "ã“ã®æ¼¢å­—ã®èª­ã¿æ–¹ã¯ï¼Ÿã€Œæ€§è³ªã€", answer: "ã›ã„ã—ã¤" },
                { question: "ã“ã®æ¼¢å­—ã®èª­ã¿æ–¹ã¯ï¼Ÿã€Œè¿°èªã€", answer: "ã˜ã‚…ã¤ã”" },
                { question: "ã“ã®æ¼¢å­—ã®èª­ã¿æ–¹ã¯ï¼Ÿã€Œè³‡æ ¼ã€", answer: "ã—ã‹ã" },
                { question: "ã“ã®æ¼¢å­—ã®èª­ã¿æ–¹ã¯ï¼Ÿã€Œç†è§£ã€", answer: "ã‚Šã‹ã„" },
                { question: "ã“ã®æ¼¢å­—ã®èª­ã¿æ–¹ã¯ï¼Ÿã€Œæ§‹æˆã€", answer: "ã“ã†ã›ã„" },
                { question: "ã“ã®æ¼¢å­—ã®èª­ã¿æ–¹ã¯ï¼Ÿã€Œäº‹æƒ…ã€", answer: "ã˜ã˜ã‚‡ã†" },
                { question: "ã“ã®æ¼¢å­—ã®èª­ã¿æ–¹ã¯ï¼Ÿã€Œç‚­é‰±ã€", answer: "ãŸã‚“ã“ã†" },
                { question: "ã“ã®æ¼¢å­—ã®èª­ã¿æ–¹ã¯ï¼Ÿã€ŒéŸ³ç¨‹ã€", answer: "ãŠã‚“ã¦ã„" },
                { question: "ã“ã®æ¼¢å­—ã®èª­ã¿æ–¹ã¯ï¼Ÿã€Œç•™å­¦ã€", answer: "ã‚Šã‚…ã†ãŒã" },
                { question: "ã“ã®æ¼¢å­—ã®èª­ã¿æ–¹ã¯ï¼Ÿã€Œæ°—åœ§ã€", answer: "ãã‚ã¤" },
                { question: "ã“ã®æ¼¢å­—ã®èª­ã¿æ–¹ã¯ï¼Ÿã€Œç§»å‹•ã€", answer: "ã„ã©ã†" },
                { question: "ã“ã®æ¼¢å­—ã®èª­ã¿æ–¹ã¯ï¼Ÿã€Œäº‹æ•…ã€", answer: "ã˜ã“" }
            ],
            6: [
                { question: "ã“ã®æ¼¢å­—ã®èª­ã¿æ–¹ã¯ï¼Ÿã€Œç ‚é‰„ã€", answer: "ã•ã¦ã¤" },
                { question: "ã“ã®æ¼¢å­—ã®èª­ã¿æ–¹ã¯ï¼Ÿã€Œè£åˆ¤ã€", answer: "ã•ã„ã°ã‚“" },
                { question: "ã“ã®æ¼¢å­—ã®èª­ã¿æ–¹ã¯ï¼Ÿã€Œç§˜è”µã€", answer: "ã²ãã†" },
                { question: "ã“ã®æ¼¢å­—ã®èª­ã¿æ–¹ã¯ï¼Ÿã€Œç ´ç‰‡ã€", answer: "ã¯ã¸ã‚“" },
                { question: "ã“ã®æ¼¢å­—ã®èª­ã¿æ–¹ã¯ï¼Ÿã€Œé™¤å»ã€", answer: "ã˜ã‚‡ãã‚‡" },
                { question: "ã“ã®æ¼¢å­—ã®èª­ã¿æ–¹ã¯ï¼Ÿã€Œå¿ å®Ÿã€", answer: "ã¡ã‚…ã†ã˜ã¤" },
                { question: "ã“ã®æ¼¢å­—ã®èª­ã¿æ–¹ã¯ï¼Ÿã€Œæ¨¡å‹ã€", answer: "ã‚‚ã‘ã„" },
                { question: "ã“ã®æ¼¢å­—ã®èª­ã¿æ–¹ã¯ï¼Ÿã€Œå°Šæ•¬ã€", answer: "ãã‚“ã‘ã„" },
                { question: "ã“ã®æ¼¢å­—ã®èª­ã¿æ–¹ã¯ï¼Ÿã€Œæ·±åˆ»ã€", answer: "ã—ã‚“ã“ã" },
                { question: "ã“ã®æ¼¢å­—ã®èª­ã¿æ–¹ã¯ï¼Ÿã€Œéª¨æŠ˜ã€", answer: "ã“ã£ã›ã¤" },
                { question: "ã“ã®æ¼¢å­—ã®èª­ã¿æ–¹ã¯ï¼Ÿã€Œä¸‰å†Šã€", answer: "ã•ã‚“ã•ã¤" },
                { question: "ã“ã®æ¼¢å­—ã®èª­ã¿æ–¹ã¯ï¼Ÿã€Œç¿Œæ—¥ã€", answer: "ã‚ˆãã˜ã¤" },
                { question: "ã“ã®æ¼¢å­—ã®èª­ã¿æ–¹ã¯ï¼Ÿã€Œåé›†ã€", answer: "ã—ã‚…ã†ã—ã‚…ã†" },
                { question: "ã“ã®æ¼¢å­—ã®èª­ã¿æ–¹ã¯ï¼Ÿã€Œå¿ƒè‡“ã€", answer: "ã—ã‚“ãã†" },
                { question: "ã“ã®æ¼¢å­—ã®èª­ã¿æ–¹ã¯ï¼Ÿã€Œè¨ªå•ã€", answer: "ã»ã†ã‚‚ã‚“" },
                { question: "ã“ã®æ¼¢å­—ã®èª­ã¿æ–¹ã¯ï¼Ÿã€Œå°†è»ã€", answer: "ã—ã‚‡ã†ãã‚“" },
                { question: "ã“ã®æ¼¢å­—ã®èª­ã¿æ–¹ã¯ï¼Ÿã€Œè…¹ç—›ã€", answer: "ãµãã¤ã†" },
                { question: "ã“ã®æ¼¢å­—ã®èª­ã¿æ–¹ã¯ï¼Ÿã€Œæ¨ç†ã€", answer: "ã™ã„ã‚Š" },
                { question: "ã“ã®æ¼¢å­—ã®èª­ã¿æ–¹ã¯ï¼Ÿã€Œç¸®å°ºã€", answer: "ã—ã‚…ãã—ã‚ƒã" },
                { question: "ã“ã®æ¼¢å­—ã®èª­ã¿æ–¹ã¯ï¼Ÿã€Œç¸®å°ã€", answer: "ã—ã‚…ãã—ã‚‡ã†" },
                { question: "ã“ã®æ¼¢å­—ã®èª­ã¿æ–¹ã¯ï¼Ÿã€Œé¦–è„³ã€", answer: "ã—ã‚…ã®ã†" },
                { question: "ã“ã®æ¼¢å­—ã®èª­ã¿æ–¹ã¯ï¼Ÿã€Œæ­»äº¡ã€", answer: "ã—ã¼ã†" },
                { question: "ã“ã®æ¼¢å­—ã®èª­ã¿æ–¹ã¯ï¼Ÿã€Œç°è‰²ã€", answer: "ã¯ã„ã„ã‚" },
                { question: "ã“ã®æ¼¢å­—ã®èª­ã¿æ–¹ã¯ï¼Ÿã€Œè£…ç½®ã€", answer: "ãã†ã¡" },
                { question: "ã“ã®æ¼¢å­—ã®èª­ã¿æ–¹ã¯ï¼Ÿã€Œé‹¼æã€", answer: "ã“ã†ã–ã„" },
                { question: "ã“ã®æ¼¢å­—ã®èª­ã¿æ–¹ã¯ï¼Ÿã€Œä¿³å¥ã€", answer: "ã¯ã„ã" },
                { question: "ã“ã®æ¼¢å­—ã®èª­ã¿æ–¹ã¯ï¼Ÿã€Œæä¾›ã€", answer: "ã¦ã„ãã‚‡ã†" },
                { question: "ã“ã®æ¼¢å­—ã®èª­ã¿æ–¹ã¯ï¼Ÿã€Œæœ—èª­ã€", answer: "ã‚ã†ã©ã" },
                { question: "ã“ã®æ¼¢å­—ã®èª­ã¿æ–¹ã¯ï¼Ÿã€Œæ‹…ä»»ã€", answer: "ãŸã‚“ã«ã‚“" },
                { question: "ã“ã®æ¼¢å­—ã®èª­ã¿æ–¹ã¯ï¼Ÿã€Œè­¦å‚™ã€", answer: "ã‘ã„ã³" },
                { question: "ã“ã®æ¼¢å­—ã®èª­ã¿æ–¹ã¯ï¼Ÿã€Œå˜ç´”ã€", answer: "ãŸã‚“ã˜ã‚…ã‚“" },
                { question: "ã“ã®æ¼¢å­—ã®èª­ã¿æ–¹ã¯ï¼Ÿã€Œè²´é‡ã€", answer: "ãã¡ã‚‡ã†" },
                { question: "ã“ã®æ¼¢å­—ã®èª­ã¿æ–¹ã¯ï¼Ÿã€Œè¦–ç‚¹ã€", answer: "ã—ã¦ã‚“" },
                { question: "ã“ã®æ¼¢å­—ã®èª­ã¿æ–¹ã¯ï¼Ÿã€Œæ‹…å½“ã€", answer: "ãŸã‚“ã¨ã†" },
                { question: "ã“ã®æ¼¢å­—ã®èª­ã¿æ–¹ã¯ï¼Ÿã€Œå°±ä»»ã€", answer: "ã—ã‚…ã†ã«ã‚“" },
                { question: "ã“ã®æ¼¢å­—ã®èª­ã¿æ–¹ã¯ï¼Ÿã€Œè‡ªå·±ã€", answer: "ã˜ã“" },
                { question: "ã“ã®æ¼¢å­—ã®èª­ã¿æ–¹ã¯ï¼Ÿã€Œä»Šæ™©ã€", answer: "ã“ã‚“ã°ã‚“" },
                { question: "ã“ã®æ¼¢å­—ã®èª­ã¿æ–¹ã¯ï¼Ÿã€Œå¿ å‘Šã€", answer: "ã¡ã‚…ã†ã“ã" },
                { question: "ã“ã®æ¼¢å­—ã®èª­ã¿æ–¹ã¯ï¼Ÿã€Œå³é‡ã€", answer: "ã’ã‚“ã˜ã‚…ã†" },
                { question: "ã“ã®æ¼¢å­—ã®èª­ã¿æ–¹ã¯ï¼Ÿã€Œæ•£ä¹±ã€", answer: "ã•ã‚“ã‚‰ã‚“" },
                { question: "ã“ã®æ¼¢å­—ã®èª­ã¿æ–¹ã¯ï¼Ÿã€Œå€¤æ®µã€", answer: "ã­ã ã‚“" },
                { question: "ã“ã®æ¼¢å­—ã®èª­ã¿æ–¹ã¯ï¼Ÿã€Œé¦–ç­‹ã€", answer: "ãã³ã™ã˜" },
                { question: "ã“ã®æ¼¢å­—ã®èª­ã¿æ–¹ã¯ï¼Ÿã€Œæ‰¹åˆ¤ã€", answer: "ã²ã¯ã‚“" },
                { question: "ã“ã®æ¼¢å­—ã®èª­ã¿æ–¹ã¯ï¼Ÿã€Œå®£å‘Šã€", answer: "ã›ã‚“ã“ã" },
                { question: "ã“ã®æ¼¢å­—ã®èª­ã¿æ–¹ã¯ï¼Ÿã€Œç²¾å¯†ã€", answer: "ã›ã„ã¿ã¤" },
                { question: "ã“ã®æ¼¢å­—ã®èª­ã¿æ–¹ã¯ï¼Ÿã€Œæ„Ÿæ¿€ã€", answer: "ã‹ã‚“ã’ã" },
                { question: "ã“ã®æ¼¢å­—ã®èª­ã¿æ–¹ã¯ï¼Ÿã€Œè§£é™¤ã€", answer: "ã‹ã„ã˜ã‚‡" },
                { question: "ã“ã®æ¼¢å­—ã®èª­ã¿æ–¹ã¯ï¼Ÿã€Œæ¨ç§»ã€", answer: "ã™ã„ã„" },
                { question: "ã“ã®æ¼¢å­—ã®èª­ã¿æ–¹ã¯ï¼Ÿã€Œæ‚ªå…šã€", answer: "ã‚ãã¨ã†" },
                { question: "ã“ã®æ¼¢å­—ã®èª­ã¿æ–¹ã¯ï¼Ÿã€Œä¿³å„ªã€", answer: "ã¯ã„ã‚†ã†" },
                { question: "ã“ã®æ¼¢å­—ã®èª­ã¿æ–¹ã¯ï¼Ÿã€Œé©å‘½ã€", answer: "ã‹ãã‚ã„" },
                { question: "ã“ã®æ¼¢å­—ã®èª­ã¿æ–¹ã¯ï¼Ÿã€Œé ‚ä¸Šã€", answer: "ã¡ã‚‡ã†ã˜ã‚‡ã†" },
                { question: "ã“ã®æ¼¢å­—ã®èª­ã¿æ–¹ã¯ï¼Ÿã€Œè³ƒé‡‘ã€", answer: "ã¡ã‚“ãã‚“" },
                { question: "ã“ã®æ¼¢å­—ã®èª­ã¿æ–¹ã¯ï¼Ÿã€Œæ“ç¸¦ã€", answer: "ãã†ã˜ã‚…ã†" },
                { question: "ã“ã®æ¼¢å­—ã®èª­ã¿æ–¹ã¯ï¼Ÿã€Œè’¸æ°—ã€", answer: "ã˜ã‚‡ã†ã" },
                { question: "ã“ã®æ¼¢å­—ã®èª­ã¿æ–¹ã¯ï¼Ÿã€Œæ²¿å²¸ã€", answer: "ãˆã‚“ãŒã‚“" },
                { question: "ã“ã®æ¼¢å­—ã®èª­ã¿æ–¹ã¯ï¼Ÿã€Œåç´ã€", answer: "ã—ã‚…ã†ã®ã†" },
                { question: "ã“ã®æ¼¢å­—ã®èª­ã¿æ–¹ã¯ï¼Ÿã€Œçš‡å±…ã€", answer: "ã“ã†ãã‚‡" },
                { question: "ã“ã®æ¼¢å­—ã®èª­ã¿æ–¹ã¯ï¼Ÿã€Œçª“å£ã€", answer: "ã¾ã©ãã¡" },
                { question: "ã“ã®æ¼¢å­—ã®èª­ã¿æ–¹ã¯ï¼Ÿã€Œè¦å¾‹ã€", answer: "ãã‚Šã¤" },
                { question: "ã“ã®æ¼¢å­—ã®èª­ã¿æ–¹ã¯ï¼Ÿã€Œç­é•·ã€", answer: "ã¯ã‚“ã¡ã‚‡ã†" },
                { question: "ã“ã®æ¼¢å­—ã®èª­ã¿æ–¹ã¯ï¼Ÿã€Œå®ç‰©ã€", answer: "ãŸã‹ã‚‰ã‚‚ã®" },
                { question: "ã“ã®æ¼¢å­—ã®èª­ã¿æ–¹ã¯ï¼Ÿã€Œå‚·å£ã€", answer: "ããšãã¡" },
                { question: "ã“ã®æ¼¢å­—ã®èª­ã¿æ–¹ã¯ï¼Ÿã€Œè‘—è€…ã€", answer: "ã¡ã‚‡ã—ã‚ƒ" },
                { question: "ã“ã®æ¼¢å­—ã®èª­ã¿æ–¹ã¯ï¼Ÿã€Œé£Ÿæ¬²ã€", answer: "ã—ã‚‡ãã‚ˆã" },
                { question: "ã“ã®æ¼¢å­—ã®èª­ã¿æ–¹ã¯ï¼Ÿã€Œå¹²æ½®ã€", answer: "ã‹ã‚“ã¡ã‚‡ã†" },
                { question: "ã“ã®æ¼¢å­—ã®èª­ã¿æ–¹ã¯ï¼Ÿã€Œèª¤è§£ã€", answer: "ã”ã‹ã„" },
                { question: "ã“ã®æ¼¢å­—ã®èª­ã¿æ–¹ã¯ï¼Ÿã€Œå­—å¹•ã€", answer: "ã˜ã¾ã" },
                { question: "ã“ã®æ¼¢å­—ã®èª­ã¿æ–¹ã¯ï¼Ÿã€Œé™å‚ã€", answer: "ã“ã†ã•ã‚“" },
                { question: "ã“ã®æ¼¢å­—ã®èª­ã¿æ–¹ã¯ï¼Ÿã€Œè²¡å®ã€", answer: "ã–ã„ã»ã†" },
                { question: "ã“ã®æ¼¢å­—ã®èª­ã¿æ–¹ã¯ï¼Ÿã€Œå±±é ‚ã€", answer: "ã•ã‚“ã¡ã‚‡ã†" },
                { question: "ã“ã®æ¼¢å­—ã®èª­ã¿æ–¹ã¯ï¼Ÿã€Œåº¦èƒ¸ã€", answer: "ã©ãã‚‡ã†" },
                { question: "ã“ã®æ¼¢å­—ã®èª­ã¿æ–¹ã¯ï¼Ÿã€Œå·»ç‰©ã€", answer: "ã¾ãã‚‚ã®" },
                { question: "ã“ã®æ¼¢å­—ã®èª­ã¿æ–¹ã¯ï¼Ÿã€Œæ¨©é™ã€", answer: "ã‘ã‚“ã’ã‚“" },
                { question: "ã“ã®æ¼¢å­—ã®èª­ã¿æ–¹ã¯ï¼Ÿã€Œç§èªã€", answer: "ã—ã”" },
                { question: "ã“ã®æ¼¢å­—ã®èª­ã¿æ–¹ã¯ï¼Ÿã€Œç ‚é‡‘ã€", answer: "ã•ãã‚“" },
                { question: "ã“ã®æ¼¢å­—ã®èª­ã¿æ–¹ã¯ï¼Ÿã€Œæ™‚åˆ»ã€", answer: "ã˜ã“ã" },
                { question: "ã“ã®æ¼¢å­—ã®èª­ã¿æ–¹ã¯ï¼Ÿã€Œå¯¸æ³•ã€", answer: "ã™ã‚“ã½ã†" },
                { question: "ã“ã®æ¼¢å­—ã®èª­ã¿æ–¹ã¯ï¼Ÿã€Œæ†²æ³•ã€", answer: "ã‘ã‚“ã½ã†" },
                { question: "ã“ã®æ¼¢å­—ã®èª­ã¿æ–¹ã¯ï¼Ÿã€Œè¿”æ¸ˆã€", answer: "ã¸ã‚“ã•ã„" },
                { question: "ã“ã®æ¼¢å­—ã®èª­ã¿æ–¹ã¯ï¼Ÿã€Œæ˜ åƒã€", answer: "ãˆã„ãã†" },
                { question: "ã“ã®æ¼¢å­—ã®èª­ã¿æ–¹ã¯ï¼Ÿã€Œå–„æ‚ªã€", answer: "ãœã‚“ã‚ã" },
                { question: "ã“ã®æ¼¢å­—ã®èª­ã¿æ–¹ã¯ï¼Ÿã€Œç¢ºèªã€", answer: "ã‹ãã«ã‚“" },
                { question: "ã“ã®æ¼¢å­—ã®èª­ã¿æ–¹ã¯ï¼Ÿã€Œå¦æ±ºã€", answer: "ã²ã‘ã¤" },
                { question: "ã“ã®æ¼¢å­—ã®èª­ã¿æ–¹ã¯ï¼Ÿã€Œè¦–ç·šã€", answer: "ã—ã›ã‚“" },
                { question: "ã“ã®æ¼¢å­—ã®èª­ã¿æ–¹ã¯ï¼Ÿã€Œå‹¤å‹™ã€", answer: "ãã‚“ã‚€" },
                { question: "ã“ã®æ¼¢å­—ã®èª­ã¿æ–¹ã¯ï¼Ÿã€ŒèƒŒé¢ã€", answer: "ã¯ã„ã‚ã‚“" },
                { question: "ã“ã®æ¼¢å­—ã®èª­ã¿æ–¹ã¯ï¼Ÿã€Œç ‚å ´ã€", answer: "ã™ãªã°" },
                { question: "ã“ã®æ¼¢å­—ã®èª­ã¿æ–¹ã¯ï¼Ÿã€Œå¯¾ç­–ã€", answer: "ãŸã„ã•ã" },
                { question: "ã“ã®æ¼¢å­—ã®èª­ã¿æ–¹ã¯ï¼Ÿã€Œä¸»å°†ã€", answer: "ã—ã‚…ã—ã‚‡ã†" },
                { question: "ã“ã®æ¼¢å­—ã®èª­ã¿æ–¹ã¯ï¼Ÿã€Œç–‘å•ã€", answer: "ãã‚‚ã‚“" },
                { question: "ã“ã®æ¼¢å­—ã®èª­ã¿æ–¹ã¯ï¼Ÿã€Œæ•¬èªã€", answer: "ã‘ã„ã”" },
                { question: "ã“ã®æ¼¢å­—ã®èª­ã¿æ–¹ã¯ï¼Ÿã€Œç¿Œå¹´ã€", answer: "ã‚ˆãã­ã‚“" },
                { question: "ã“ã®æ¼¢å­—ã®èª­ã¿æ–¹ã¯ï¼Ÿã€Œå±é™ºã€", answer: "ãã‘ã‚“" },
                { question: "ã“ã®æ¼¢å­—ã®èª­ã¿æ–¹ã¯ï¼Ÿã€Œä»æ„›ã€", answer: "ã˜ã‚“ã‚ã„" },
                { question: "ã“ã®æ¼¢å­—ã®èª­ã¿æ–¹ã¯ï¼Ÿã€Œå°†æ¥ã€", answer: "ã—ã‚‡ã†ã‚‰ã„" },
                { question: "ã“ã®æ¼¢å­—ã®èª­ã¿æ–¹ã¯ï¼Ÿã€ŒçŸ³æ®µã€", answer: "ã„ã—ã ã‚“" },
                { question: "ã“ã®æ¼¢å­—ã®èª­ã¿æ–¹ã¯ï¼Ÿã€Œå½¹å‰²ã€", answer: "ã‚„ãã‚ã‚Š" },
                { question: "ã“ã®æ¼¢å­—ã®èª­ã¿æ–¹ã¯ï¼Ÿã€Œç‰›ä¹³ã€", answer: "ãã‚…ã†ã«ã‚…ã†" },
                { question: "ã“ã®æ¼¢å­—ã®èª­ã¿æ–¹ã¯ï¼Ÿã€Œç¶¿æ£’ã€", answer: "ã‚ã‚“ã¼ã†" }
            ]
        };
        
        // ã‚«ãƒ¼ãƒ‰ã®ç¨®é¡ã¨å‡ºç¾å‰²åˆ
        const cardTypes = [
            { name: "ğŸ²ğŸ² ã‚µã‚¤ã‚³ãƒ­2å€‹", description: "2ã¤ã®ã‚µã‚¤ã‚³ãƒ­ã®åˆè¨ˆã§é€²ã‚ã‚‹", type: "dice2", weight: 15 },
            { name: "ğŸ²ğŸ²ğŸ² ã‚µã‚¤ã‚³ãƒ­3å€‹", description: "3ã¤ã®ã‚µã‚¤ã‚³ãƒ­ã®åˆè¨ˆã§é€²ã‚ã‚‹", type: "dice3", weight: 5 },
            { name: "ğŸ€ ãƒ©ãƒƒã‚­ãƒ¼6", description: "å¿…ãš6ãŒå‡ºã‚‹ã‚µã‚¤ã‚³ãƒ­", type: "lucky6", weight: 10 },
            { name: "ğŸ’¥ å¦¨å®³ã‚«ãƒ¼ãƒ‰", description: "ç›¸æ‰‹ã‚’3ãƒã‚¹æˆ»ã™", type: "attack", weight: 10 },
            { name: "ğŸš€ ã‚¸ãƒ£ãƒ³ãƒ—", description: "3ãƒã‚¹é€²ã‚€", type: "jump", weight: 10 },
            { name: "ğŸ›¡ï¸ ã‚·ãƒ¼ãƒ«ãƒ‰", description: "æ”»æ’ƒã‚’1å›é˜²ã", type: "shield", weight: 15 },
            { name: "ğŸ’£ çˆ†ç™º", description: "2äººã¨ã‚‚ã‚¹ã‚¿ãƒ¼ãƒˆã«æˆ»ã‚‹", type: "bomb", weight: 5 },
            { name: "ğŸš§ ã‚¹ãƒˆãƒƒãƒ—", description: "ç›¸æ‰‹ã‚’1å›ä¼‘ã¿ã«ã™ã‚‹", type: "stop", weight: 10 },
            { name: "ğŸª‚ ãƒ©ãƒ³ãƒ€ãƒ ", description: "ã©ã“ã‹åˆ¥ã®å ´æ‰€ã«ãƒ†ãƒ¬ãƒãƒ¼ãƒˆã™ã‚‹", type: "random", weight: 10 },
            { name: "ğŸ¥· æ³¥æ£’", description: "ç›¸æ‰‹ã®ã‚«ãƒ¼ãƒ‰ã‚’ãƒ©ãƒ³ãƒ€ãƒ ã§1æšå¥ªãˆã‚‹", type: "steal", weight: 10 }
        ];
        
        // é‡ã¿ä»˜ããƒ©ãƒ³ãƒ€ãƒ é¸æŠã§ã‚«ãƒ¼ãƒ‰ã‚’å–å¾—
        function getRandomCard() {
            const totalWeight = cardTypes.reduce((sum, card) => sum + card.weight, 0);
            let random = Math.random() * totalWeight;
            
            for (const card of cardTypes) {
                random -= card.weight;
                if (random <= 0) {
                    return { ...card };
                }
            }
            return { ...cardTypes[0] }; // ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯
        }
        
        // å…¥åŠ›ãƒ­ãƒƒã‚¯æ©Ÿèƒ½
        function lockInputs() {
            turnLocked = true;
            document.getElementById('rollBtn').disabled = true;
            document.getElementById('useCardBtn1').disabled = true;
            document.getElementById('useCardBtn2').disabled = true;
        }
        
        function unlockInputsForCurrentPlayer() {
            turnLocked = false;
            
            if (isAIGame && currentPlayer === 2) {
                // AIã®ã‚¿ãƒ¼ãƒ³ã¯å…¨ã¦ç„¡åŠ¹ã®ã¾ã¾
                document.getElementById('rollBtn').disabled = true;
                document.getElementById('useCardBtn1').disabled = true;
                document.getElementById('useCardBtn2').disabled = true;
            } else {
                // äººé–“ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®ã‚¿ãƒ¼ãƒ³
                document.getElementById('rollBtn').disabled = false;
                
                // ã‚«ãƒ¼ãƒ‰ãƒœã‚¿ãƒ³ã¯ç¾åœ¨ã®ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®ã¿æœ‰åŠ¹åŒ–
                document.getElementById('useCardBtn1').disabled = (currentPlayer !== 1 || players[1].cards.length === 0);
                document.getElementById('useCardBtn2').disabled = (currentPlayer !== 2 || players[2].cards.length === 0);
            }
        }
        
        // ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼2å…¥åŠ›æ¬„ã®è¡¨ç¤º/éè¡¨ç¤ºåˆ‡ã‚Šæ›¿ãˆ
        function togglePlayer2Input() {
            const playerCount = document.getElementById('playerCountSelect').value;
            const player2Group = document.getElementById('player2Group');
            
            if (playerCount === '1') {
                player2Group.style.display = 'none';
            } else {
                player2Group.style.display = 'block';
            }
        }

        document.addEventListener('DOMContentLoaded', () => {
  loadSettings();
  togglePlayer2Input();

  const ai = document.getElementById('answerInput');
  if (!ai) return;

  let composing = false;

  // æ—¥æœ¬èªIMEã®å¤‰æ›é–‹å§‹/ç¢ºå®šã‚’æ¤œçŸ¥
  ai.addEventListener('compositionstart', () => { composing = true; });
  ai.addEventListener('compositionend', () => {
    composing = false;
    const pos = ai.selectionStart;
    ai.value = kanaLiveSanitize(ai.value); // ç¢ºå®šå¾Œã«ã ã‘è»½ã‚ã«æ•´ãˆã‚‹
    ai.setSelectionRange(pos, pos);
  });

  // å…¥åŠ›ä¸­ã¯â€œã‚«ã‚¿ã‚«ãƒŠâ†’ã²ã‚‰ãŒãªâ€ã ã‘ï¼ˆå°æ›¸ããƒ»é•·éŸ³ãƒ»ç©ºç™½ã¯ãã®ã¾ã¾ï¼‰
  ai.addEventListener('input', () => {
    if (composing) return; // å¤‰æ›ä¸­ã¯ä¸€åˆ‡è§¦ã‚‰ãªã„
    const pos = ai.selectionStart;
    ai.value = kanaLiveSanitize(ai.value);
    ai.setSelectionRange(pos, pos);
  });

  // è²¼ã‚Šä»˜ã‘æ™‚ã‚‚â€œè»½ã‚â€ã«
  ai.addEventListener('paste', (e) => {
    e.preventDefault();
    const text = (e.clipboardData || window.clipboardData).getData('text');
    const start = ai.selectionStart, end = ai.selectionEnd;
    const before = ai.value.slice(0, start);
    const after  = ai.value.slice(end);
    const mid    = kanaLiveSanitize(text);
    ai.value = before + mid + after;
    const pos = (before + mid).length;
    ai.setSelectionRange(pos, pos);
  });
});



        // åˆæœŸè¨­å®šç”»é¢ã®é–¢æ•°
        function showInstructions() {
            const player1Name = document.getElementById('player1Name').value.trim();
            playerCount = parseInt(document.getElementById('playerCountSelect').value);
            
            if (!player1Name) {
                alert('ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼åã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
                return;
            }
            
            players[1].name = player1Name;
            
            if (playerCount === 1) {
                isAIGame = true;
                players[2].name = 'ã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ã‚¿ãƒ¼';
            } else {
                const player2Name = document.getElementById('player2Name').value.trim();
                if (!player2Name) {
                    alert('ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼2ã®åå‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
                    return;
                }
                isAIGame = false;
                players[2].name = player2Name;
            }
            
            selectedGrade = parseInt(document.getElementById('gradeSelect').value);
            
            // è¨­å®šã‚’ä¿å­˜
            saveSettings();
            
            document.getElementById('setupScreen').style.display = 'none';
            document.getElementById('instructionsScreen').style.display = 'flex';
        }
        
        function startGame() {
            // èª¬æ˜ç”»é¢ã‚’é–‰ã˜ã¦ã€ã¾ãšã¯ãƒ«ãƒ¼ãƒ¬ãƒƒãƒˆãƒ¢ãƒ¼ãƒ€ãƒ«ã¸
            document.getElementById('instructionsScreen').style.display = 'none';
            
            // å­¦å¹´è¡¨ç¤ºã‚’è¿½åŠ 
            const titleElement = document.querySelector('.title');
            if (!titleElement.querySelector('.grade-display')) {
                titleElement.insertAdjacentHTML('beforeend', 
                    ` <span class="grade-display" style="font-size:1rem;opacity:.8">ï¼ˆ${selectedGrade}å¹´ç”Ÿï¼‰</span>`);
            }
            
            prepareFirstPlayerRoulette();
            document.getElementById('firstPlayerModal').style.display = 'flex';
        }
        
        // ãƒ«ãƒ¼ãƒ¬ãƒƒãƒˆæº–å‚™ï¼ˆåå‰ã¨ã‚¢ã‚¤ã‚³ãƒ³åæ˜ ï¼‰
        function prepareFirstPlayerRoulette(){
            // ã“ã“ã§ã‚²ãƒ¼ãƒ ç”»é¢ã¯ã¾ã è¡¨ç¤ºã—ãªã„
            const p1 = players[1].name || 'ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼1';
            const p2 = isAIGame ? 'ã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ã‚¿ãƒ¼' : (players[2].name || 'ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼2');
            document.getElementById('rouletteP1Name').textContent = p1;
            document.getElementById('rouletteP2Name').textContent = p2;
            document.getElementById('rouletteMsg').textContent = 'ã‚¹ã‚¿ãƒ¼ãƒˆã‚’æŠ¼ã™ã¨æŠ½é¸ã—ã¾ã™ï¼';
            document.getElementById('rouletteProceedBtn').style.display = 'none';
            document.getElementById('rouletteStartBtn').style.display = 'inline-block';
            document.getElementById('rouletteP1').classList.remove('active');
            document.getElementById('rouletteP2').classList.remove('active');
            rouletteDecided = null;
        }
        
        // ãƒ«ãƒ¼ãƒ¬ãƒƒãƒˆé–‹å§‹
        function startFirstPlayerRoulette(){
            const chip1 = document.getElementById('rouletteP1');
            const chip2 = document.getElementById('rouletteP2');
            const msg = document.getElementById('rouletteMsg');
            document.getElementById('rouletteStartBtn').style.display = 'none';
            msg.textContent = 'ãã‚‹ãã‚‹ã€œâ€¦';

            rouletteSpins = 0;
            let highlight = 1;

            // é«˜é€Ÿã§äº¤äº’ãƒã‚¤ãƒ©ã‚¤ãƒˆ â†’ æœ€å¾Œã«ãƒ©ãƒ³ãƒ€ãƒ ã§æ­¢ã‚ã‚‹
            rouletteInterval = setInterval(() => {
                highlight = (highlight === 1 ? 2 : 1);
                chip1.classList.toggle('active', highlight === 1);
                chip2.classList.toggle('active', highlight === 2);
                rouletteSpins++;
                // å°‘ã—ãšã¤é…ãã—ã¦ã„ãæ¼”å‡ºï¼ˆä»»æ„ï¼‰
                // ã“ã“ã§ã¯ç°¡å˜åŒ–ã®ãŸã‚ä¸€å®šé€Ÿåº¦
                if (rouletteSpins > 20) {
                    clearInterval(rouletteInterval);
                    const winner = Math.random() < 0.5 ? 1 : 2;
                    rouletteDecided = winner;
                    chip1.classList.toggle('active', winner === 1);
                    chip2.classList.toggle('active', winner === 2);
                    const winnerIcon = (winner === 1) ? 'ğŸ‘¦' : (isAIGame ? 'ğŸ¤–' : 'ğŸ‘§');
                    const winnerName = (winner === 1)
                      ? (players[1].name || 'ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼1')
                      : (isAIGame ? 'ã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ã‚¿ãƒ¼' : (players[2].name || 'ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼2'));
                    msg.textContent = `ğŸ‰ å…ˆæ”»ã¯ ${winnerIcon} ${winnerName}ï¼`;
                    document.getElementById('rouletteProceedBtn').style.display = 'inline-block';
                }
            }, 120);
        }
        
        // ãƒ«ãƒ¼ãƒ¬ãƒƒãƒˆå¾Œã«ã‚²ãƒ¼ãƒ é–‹å§‹
        function proceedAfterRoulette(){
            document.getElementById('firstPlayerModal').style.display = 'none';
            document.getElementById('gameContainer').style.display = 'flex';
            initializeBoard();
            
            // ãƒ«ãƒ¼ãƒ¬ãƒƒãƒˆçµæœã‚’åæ˜ 
            currentPlayer = rouletteDecided || 1;
            
            turnLocked = false;
            updateTurnDisplay();
            startPlayerTurn();
        }
        
        // ã‚²ãƒ¼ãƒ ãƒœãƒ¼ãƒ‰åˆæœŸåŒ–ï¼ˆSå­—å‹ï¼‰
        function initializeBoard() {
            const board = document.getElementById('gameBoard');
            board.innerHTML = '';
            
            // 30ãƒã‚¹ã®Så­—å‹ã‚³ãƒ¼ã‚¹ã‚’ä½œæˆ
            for (let i = 0; i < 30; i++) {
                const cell = document.createElement('div');
                cell.className = 'cell';
                cell.id = `cell-${i}`;
                
                // Så­—å‹ã®é…ç½®ã‚’è¨ˆç®—
                let row, col;
                if (i <= 9) {
                    // 1è¡Œç›®: 0-9 (å·¦ã‹ã‚‰å³)
                    row = 0;
                    col = i;
                } else if (i <= 19) {
                    // 2è¡Œç›®: 10-19 (å³ã‹ã‚‰å·¦)
                    row = 1;
                    col = 19 - i;
                } else {
                    // 3è¡Œç›®: 20-29 (å·¦ã‹ã‚‰å³)
                    row = 2;
                    col = i - 20;
                }
                
                cell.style.gridRow = row + 1;
                cell.style.gridColumn = col + 1;
                
                if (i === 0) {
                    cell.classList.add('start');
                    cell.textContent = 'START';
                } else if (i === 29) {
                    cell.classList.add('goal');
                    cell.textContent = 'GOAL';
                } else {
                    // ã‚«ãƒ©ãƒ•ãƒ«ãªè‰²ã‚’ãƒ©ãƒ³ãƒ€ãƒ ã«å‰²ã‚Šå½“ã¦
                    const colorClass = `color${Math.floor(Math.random() * 10) + 1}`;
                    cell.classList.add(colorClass);
                }
                
                // é€²è¡Œæ–¹å‘ã®çŸ¢å°ã‚’è¿½åŠ 
                if (i < 29) {
                    const arrow = document.createElement('div');
                    arrow.style.position = 'absolute';
                    arrow.style.fontSize = '0.6rem';
                    arrow.style.color = '#fff';
                    arrow.style.fontWeight = 'bold';
                    arrow.style.textShadow = '1px 1px 2px rgba(0,0,0,0.8)';
                    
                    if (i < 9) {
                        arrow.textContent = 'â†’';
                        arrow.style.right = '-8px';
                        arrow.style.top = '50%';
                        arrow.style.transform = 'translateY(-50%)';
                    } else if (i === 9) {
                        arrow.textContent = 'â†“';
                        arrow.style.bottom = '-8px';
                        arrow.style.left = '50%';
                        arrow.style.transform = 'translateX(-50%)';
                    } else if (i >= 10 && i < 19) {
                        arrow.textContent = 'â†';
                        arrow.style.left = '-8px';
                        arrow.style.top = '50%';
                        arrow.style.transform = 'translateY(-50%)';
                    } else if (i === 19) {
                        arrow.textContent = 'â†“';
                        arrow.style.bottom = '-8px';
                        arrow.style.left = '50%';
                        arrow.style.transform = 'translateX(-50%)';
                    } else if (i >= 20 && i < 28) {
                        arrow.textContent = 'â†’';
                        arrow.style.right = '-8px';
                        arrow.style.top = '50%';
                        arrow.style.transform = 'translateY(-50%)';
                    }
                    
                    if (arrow.textContent) {
                        cell.appendChild(arrow);
                    }
                }
                
                board.appendChild(cell);
            }
            
            updatePlayerPositions();
        }
        
        // ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ä½ç½®æ›´æ–°
        function updatePlayerPositions() {
            // å…¨ã¦ã®é§’ã‚’å‰Šé™¤
            document.querySelectorAll('.player').forEach(p => p.remove());
            
            // ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼1ã®é§’ã‚’é…ç½®
            const cell1 = document.getElementById(`cell-${players[1].position}`);
            if (cell1) {
                const player1 = document.createElement('div');
                player1.className = 'player player1';
                player1.textContent = 'ğŸ‘¦';
                cell1.appendChild(player1);
            }
            
            // ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼2ã®é§’ã‚’é…ç½®ï¼ˆäººé–“ã‹ã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ã‚¿ãƒ¼ã‹ã§åŒºåˆ¥ï¼‰
            const cell2 = document.getElementById(`cell-${players[2].position}`);
            if (cell2) {
                const player2 = document.createElement('div');
                player2.className = 'player player2';
                player2.textContent = isAIGame ? 'ğŸ¤–' : 'ğŸ‘§';
                cell2.appendChild(player2);
            }
            
            // ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼åè¡¨ç¤ºã‚’æ›´æ–°ï¼ˆç¾åœ¨ä½ç½®ã‚‚è¡¨ç¤ºï¼‰
            document.getElementById('player1NameDisplay').textContent = `ğŸ‘¦ ${players[1].name} (${players[1].position}ãƒã‚¹ç›®)`;
            const player2Icon = isAIGame ? 'ğŸ¤–' : 'ğŸ‘§';
            document.getElementById('player2NameDisplay').textContent = `${player2Icon} ${players[2].name} (${players[2].position}ãƒã‚¹ç›®)`;
            
            // ã‚«ãƒ¼ãƒ‰è¡¨ç¤ºæ›´æ–°
            updatePlayerCards(1);
            updatePlayerCards(2);
            
            // ã‚«ãƒ¼ãƒ‰ä½¿ç”¨ãƒœã‚¿ãƒ³ã®è¡¨ç¤º/éè¡¨ç¤º
            document.getElementById('useCardBtn1').style.display = players[1].cards.length > 0 ? 'block' : 'none';
            document.getElementById('useCardBtn2').style.display = players[2].cards.length > 0 ? 'block' : 'none';
        }
        
        // ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®ã‚«ãƒ¼ãƒ‰è¡¨ç¤ºæ›´æ–°
        function updatePlayerCards(playerNum) {
            const cardsList = document.getElementById(`player${playerNum}CardsList`);
            cardsList.innerHTML = '';
            
            players[playerNum].cards.forEach((card, index) => {
                const cardElement = document.createElement('div');
                cardElement.className = 'mini-card';
                cardElement.textContent = card.name.split(' ')[0]; // çµµæ–‡å­—éƒ¨åˆ†ã®ã¿è¡¨ç¤º
                cardElement.title = card.name + ': ' + card.description;
                cardsList.appendChild(cardElement);
            });
        }
        
        // ã‚µã‚¤ã‚³ãƒ­ã‚’æŒ¯ã‚‹
        function rollDice() {
            if (gameEnded || turnLocked) return;
            
            lockInputs();
            
            // â˜…å¤‰æ›´: ã‚¿ãƒ¼ãƒ³æ‰€æœ‰è€…ã‚’è¨˜éŒ²ï¼ˆç«¶åˆãƒã‚°ä¿®æ­£ï¼‰
            pendingAnswerFor = currentPlayer;
            
            // ã‚¹ã‚­ãƒƒãƒ—ã‚¿ãƒ¼ãƒ³ãƒã‚§ãƒƒã‚¯
            if (players[currentPlayer].skipTurn) {
                players[currentPlayer].skipTurn = false;
                alert(`ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼${currentPlayer}ã¯1å›ä¼‘ã¿ã§ã™ï¼`);
                const t = setTimeout(() => switchToNextPlayer(), 1000);
                timers.push(t);
                return;
            }
            
            rollMultipleDice(1);
        }
        
        // è¤‡æ•°ã‚µã‚¤ã‚³ãƒ­ã‚’æŒ¯ã‚‹é–¢æ•°
        function rollMultipleDice(diceCount) {
            const diceArea = document.getElementById('diceArea');
            const rollBtn = document.getElementById('rollBtn');
            
            // ã‚µã‚¤ã‚³ãƒ­ã‚¨ãƒªã‚¢ã‚’ã‚¯ãƒªã‚¢
            diceArea.innerHTML = '';
            
            // æŒ‡å®šã•ã‚ŒãŸæ•°ã®ã‚µã‚¤ã‚³ãƒ­ã‚’ä½œæˆ
            const diceElements = [];
            for (let i = 0; i < diceCount; i++) {
                const dice = document.createElement('div');
                dice.className = 'dice';
                dice.id = `dice-${i}`;
                dice.textContent = '?';
                diceArea.appendChild(dice);
                diceElements.push(dice);
            }
            
            rollBtn.disabled = true;
            
            // å…¨ã¦ã®ã‚µã‚¤ã‚³ãƒ­ã«ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’è¿½åŠ 
            diceElements.forEach(dice => dice.classList.add('rolling'));
            
            // ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ä¸­ã¯ãƒ©ãƒ³ãƒ€ãƒ ãªæ•°å­—ã‚’è¡¨ç¤º
            let rollCount = 0;
            const diceValues = [];
            
            const rollInterval = setInterval(() => {
                diceElements.forEach(dice => {
                    dice.textContent = Math.floor(Math.random() * 6) + 1;
                });
                rollCount++;
                
                if (rollCount > 10) {
                    clearInterval(rollInterval);
                    
                    // æœ€çµ‚çš„ãªå€¤ã‚’æ±ºå®š
                    let total = 0;
                    diceElements.forEach((dice, index) => {
                        let value;
                        if (lucky6Active) {
                            value = 6; // ãƒ©ãƒƒã‚­ãƒ¼6åŠ¹æœã§å¿…ãš6
                        } else {
                            value = Math.floor(Math.random() * 6) + 1;
                        }
                        dice.textContent = value;
                        dice.classList.remove('rolling');
                        diceValues.push(value);
                        total += value;
                    });
                    
                    diceValue = total;
                    
                    // ãƒ©ãƒƒã‚­ãƒ¼6åŠ¹æœã‚’ãƒªã‚»ãƒƒãƒˆ
                    if (lucky6Active) {
                        lucky6Active = false;
                        console.log('ãƒ©ãƒƒã‚­ãƒ¼6åŠ¹æœã‚’ãƒªã‚»ãƒƒãƒˆ');
                    }
                    
                    // è¤‡æ•°ã‚µã‚¤ã‚³ãƒ­ã®å ´åˆã¯åˆè¨ˆã‚’è¡¨ç¤º
                    if (diceCount > 1) {
                        setTimeout(() => {
                            alert(`ğŸ² ã‚µã‚¤ã‚³ãƒ­ã®åˆè¨ˆ: ${diceValues.join(' + ')} = ${total}`);
                        }, 500);
                    }
                    
                    // â˜…ä¿®æ­£: AIã®ã‚¿ãƒ¼ãƒ³ï¼ˆç‰¹ã«AIãŒãƒ€ã‚¤ã‚¹ç³»ã‚«ãƒ¼ãƒ‰ä½¿ç”¨æ™‚ï¼‰ã¯äººé–“ç”¨ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’å‡ºã•ãšã«AIå›ç­”ã¸
                    const myTurn = turnId;
                    const isAITurn = isAIGame && currentPlayer === 2 && pendingAnswerFor === 2;
                    const nextStep = isAITurn ? aiAnswerQuestion : showQuestion;
                    const t = setTimeout(() => {
                        if (gameEnded || myTurn !== turnId) return;
                        nextStep();
                    }, diceCount > 1 ? 1500 : 500);
                    timers.push(t);
                }
            }, 100);
        }
        
        // å•é¡Œè¡¨ç¤º
        function showQuestion() {
            // â˜…ä¿é™º: AIã‚¿ãƒ¼ãƒ³ã§èª¤ã£ã¦å‘¼ã°ã‚ŒãŸã‚‰å³AIå›ç­”ã¸å›ã™
            if (isAIGame && currentPlayer === 2) {
                const modal = document.getElementById('questionModal');
                if (modal) modal.style.display = 'none';
                aiAnswerQuestion();
                return;
            }
            
            const modal = document.getElementById('questionModal');
            const questionText = document.getElementById('questionText');
            const answerInput = document.getElementById('answerInput');
            
            const questions = questionsByGrade[selectedGrade];
            currentQuestion = questions[Math.floor(Math.random() * questions.length)];
            
            questionText.textContent = currentQuestion.question;
            answerInput.value = '';
            
            openModal('questionModal', '#answerInput');
            
            // â˜…å¤‰æ›´: å›ç­”ãƒ•ã‚§ãƒ¼ã‚ºã®ã¿å…¥åŠ›è¨±å¯ï¼ˆãƒ­ãƒ¼ãƒ«/ã‚«ãƒ¼ãƒ‰ã¯ä¸å¯ã®ã¾ã¾ï¼‰
            turnLocked = false;
            document.getElementById('rollBtn').disabled = true;
            document.getElementById('useCardBtn1').disabled = true;
            document.getElementById('useCardBtn2').disabled = true;
        }
        
        // å›ç­”ã‚’é€ä¿¡
        function submitAnswer() {
            // â˜…å¤‰æ›´: ãƒ‡ãƒãƒƒã‚°ç”¨ãƒ­ã‚°è¿½åŠ 
            if (turnLocked) { 
                console.warn('submit blocked by turnLocked'); 
                return; 
            }
            
            const answerInput = document.getElementById('answerInput');
            const userAnswer = normalize(answerInput.value);
            
            if (!userAnswer) {
                alert('ç­”ãˆã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
                return;
            }
            
            lockInputs();
            // â˜…å¤‰æ›´: ã‚¿ãƒ¼ãƒ³æ‰€æœ‰è€…ã‚’æ¸¡ã™ï¼ˆç«¶åˆãƒã‚°ä¿®æ­£ï¼‰
            checkAnswer(userAnswer, pendingAnswerFor);
        }
        
        // ç­”ãˆã‚’ãƒã‚§ãƒƒã‚¯
        function checkAnswer(userAnswer, playerNum = null) {
            closeModal('questionModal');
            
            // â˜…å¤‰æ›´: pendingAnswerForã‚’å„ªå…ˆä½¿ç”¨
            const actualPlayer = playerNum ?? pendingAnswerFor;
            
            console.log(`ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼${actualPlayer}ã®å›ç­”: ${userAnswer}`);
            
            const correct = normalize(currentQuestion.answer);
            if (userAnswer === correct) {
                console.log(`ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼${actualPlayer}æ­£è§£`);
                // æ­£è§£ã®ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—è¡¨ç¤º
                showAnswerPopup(true, diceValue);
                
                // æ­£è§£ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ã‚’è¡¨ç¤ºï¼ˆæ‰‹å‹•ã§é–‰ã˜ã‚‹ã¾ã§å¾…æ©Ÿï¼‰
                // ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ãŒé–‰ã˜ã‚‰ã‚ŒãŸå¾Œã®å‡¦ç†ã¯ closeAnswerPopup() ã§å®Ÿè¡Œ
            } else {
                console.log(`ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼${actualPlayer}ä¸æ­£è§£`);
                // ä¸æ­£è§£ã®ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—è¡¨ç¤º
                showAnswerPopup(false, 0, currentQuestion.answer);
                
                // ä¸æ­£è§£ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ã‚’è¡¨ç¤ºï¼ˆæ‰‹å‹•ã§é–‰ã˜ã‚‹ã¾ã§å¾…æ©Ÿï¼‰
                // ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ãŒé–‰ã˜ã‚‰ã‚ŒãŸå¾Œã®å‡¦ç†ã¯ closeAnswerPopup() ã§å®Ÿè¡Œ
            }
        }
        
        // æ–°ã—ã„ã‚¿ãƒ¼ãƒ³äº¤ä»£é–¢æ•°ï¼ˆã‚·ãƒ³ãƒ—ãƒ«ç‰ˆï¼‰
        function switchToNextPlayer() {
            if (gameEnded || isSwitchingTurn) return; // äºŒé‡ã‚¿ãƒ¼ãƒ³åˆ‡ã‚Šæ›¿ãˆé˜²æ­¢
            isSwitchingTurn = true;
            
            // â˜…ã‚¿ã‚¤ãƒãƒ¼ã®å–ã‚Šã“ã¼ã—ã‚’ã‚­ãƒ£ãƒ³ã‚»ãƒ«
            timers.forEach(id => {
                clearTimeout(id);
                clearInterval(id);
            });
            timers.length = 0;
            
            // â˜…ä»»æ„ã ãŒå¼·åŠ›ãªä¿é™ºï¼šé–‹ã„ã¦ã„ã‚‹ãƒ¢ãƒ¼ãƒ€ãƒ«/ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ã‚’å…¨éƒ¨é–‰ã˜ã‚‹
            closeAllPopups();
            
            // â˜…AIå†å…¥é˜²æ­¢ãƒ•ãƒ©ã‚°ã‚’ãƒªã‚»ãƒƒãƒˆ
            aiBusy = false;
            
            // â˜…ä»»æ„: ã‚¿ãƒ¼ãƒ³æ‰€æœ‰ãƒ•ãƒ©ã‚°ã‚’ã‚¯ãƒªã‚¢
            pendingAnswerFor = null;
            
            console.log(`=== ã‚¿ãƒ¼ãƒ³äº¤ä»£é–‹å§‹: ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼${currentPlayer} ===`);
            
            // å…¥åŠ›ã‚’ãƒ­ãƒƒã‚¯
            lockInputs();
            
            // ç¾åœ¨ã®ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚’è¨˜éŒ²
            const previousPlayer = currentPlayer;
            
            // ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚’ç¢ºå®Ÿã«äº¤ä»£
            currentPlayer = currentPlayer === 1 ? 2 : 1;
            turnId++; // æ–°ã—ã„ã‚¿ãƒ¼ãƒ³IDã‚’ç™ºè¡Œ
            console.log(`ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼${previousPlayer} â†’ ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼${currentPlayer}ã«äº¤ä»£ (turnId=${turnId})`);
            
            // UIæ›´æ–°
            updateTurnDisplay();
            
            // çŸ­ã„é…å»¶å¾Œã«æ¬¡ã®ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®ã‚¿ãƒ¼ãƒ³é–‹å§‹
            const t = setTimeout(() => {
                if (!gameEnded) {
                    startPlayerTurn();
                }
                // ã‚¿ãƒ¼ãƒ³åˆ‡ã‚Šæ›¿ãˆãƒ•ãƒ©ã‚°ã‚’ãƒªã‚»ãƒƒãƒˆ
                setTimeout(() => { isSwitchingTurn = false; }, 100);
            }, 300);
            timers.push(t);
        }
        
        // ã‚¿ãƒ¼ãƒ³è¡¨ç¤ºã‚’æ›´æ–°
        function updateTurnDisplay() {
            // ã‚¢ã‚¯ãƒ†ã‚£ãƒ–è¡¨ç¤ºã‚’æ›´æ–°
            document.getElementById('player1Info').classList.remove('active');
            document.getElementById('player2Info').classList.remove('active');
            document.getElementById(`player${currentPlayer}Info`).classList.add('active');
            
            // å…¨ã¦ã®ãƒœã‚¿ãƒ³ã‚’ç„¡åŠ¹åŒ–
            document.getElementById('rollBtn').disabled = true;
            document.getElementById('useCardBtn1').disabled = true;
            document.getElementById('useCardBtn2').disabled = true;
            
            // ã‚µã‚¤ã‚³ãƒ­ãƒœã‚¿ãƒ³ã®ãƒ†ã‚­ã‚¹ãƒˆã‚’æ›´æ–°
            const rollBtn = document.getElementById('rollBtn');
            rollBtn.textContent = `ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼${currentPlayer}ã®ç•ª`;
        }
        
        // ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®ã‚¿ãƒ¼ãƒ³ã‚’é–‹å§‹
        function startPlayerTurn() {
            const rollBtn = document.getElementById('rollBtn');
            const diceArea = document.getElementById('diceArea');
            
            // ã‚µã‚¤ã‚³ãƒ­è¡¨ç¤ºã‚’å¸¸ã« ? ã«æˆ»ã™
            diceArea.innerHTML = '<div class="dice" id="dice">?</div>';
            
            if (isAIGame && currentPlayer === 2) {
                // â˜…AIå†å…¥é˜²æ­¢ãƒã‚§ãƒƒã‚¯
                if (aiBusy) return;
                
                // AIã®ã‚¿ãƒ¼ãƒ³
                rollBtn.textContent = 'ã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ã‚¿ãƒ¼ã®ç•ª';
                rollBtn.style.cursor = 'not-allowed';
                rollBtn.title = 'ã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ã‚¿ãƒ¼ãŒè€ƒãˆä¸­ã§ã™';
                console.log('AIã‚¿ãƒ¼ãƒ³é–‹å§‹');
                
                const myTurn = turnId; // ã“ã®æ™‚ç‚¹ã®ã‚¿ãƒ¼ãƒ³IDã‚’æ•ã¾ãˆã‚‹
                const t = setTimeout(() => {
                    if (!gameEnded && currentPlayer === 2 && myTurn === turnId) {
                        aiTurn();
                    }
                }, 1500);
                timers.push(t);
            } else {
                // äººé–“ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®ã‚¿ãƒ¼ãƒ³
                rollBtn.textContent = 'ã‚µã‚¤ã‚³ãƒ­';
                rollBtn.style.cursor = 'pointer';
                rollBtn.title = 'ã‚¯ãƒªãƒƒã‚¯ã—ã¦ã‚µã‚¤ã‚³ãƒ­ã‚’æŒ¯ã‚‹';
                console.log(`ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼${currentPlayer}ã®ã‚¿ãƒ¼ãƒ³é–‹å§‹`);
                
                // ç¾åœ¨ã®ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®å…¥åŠ›ã‚’æœ‰åŠ¹åŒ–
                unlockInputsForCurrentPlayer();
            }
        }
        
        // ç¾åœ¨ã®ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®ã‚¿ãƒ¼ãƒ³ã‚’çµ‚äº†ã™ã‚‹çµ±ä¸€é–¢æ•°ï¼ˆæ—§ç‰ˆã€äº’æ›æ€§ã®ãŸã‚æ®‹ã™ï¼‰
        function endCurrentPlayerTurn() {
            switchToNextPlayer();
        }
        
        // æ­£è§£ãƒ»ä¸æ­£è§£ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—è¡¨ç¤º
        function showAnswerPopup(isCorrect, steps, info = '') {
            const popup = document.getElementById('answerPopup');
            const content = document.getElementById('answerPopupContent');
            const title = document.getElementById('answerResultTitle');
            const message = document.getElementById('answerResultMessage');

            // ãƒ•ãƒ©ã‚°ã«æ­£èª¤ã‚’ä¿å­˜ï¼ˆcloseå´ã§å‚ç…§ï¼‰
            lastAnswerCorrect = !!isCorrect;

            if (isCorrect) {
                content.style.background = 'linear-gradient(135deg, #27ae60, #2ecc71)';
                title.textContent = 'ğŸ‰ æ­£è§£ï¼ ğŸ‰';
                message.textContent = `${steps}ãƒã‚¹é€²ã¿ã¾ã™ï¼`;
            } else {
                content.style.background = 'linear-gradient(135deg, #e74c3c, #c0392b)';
                title.textContent = 'âŒ ä¸æ­£è§£... âŒ';
                // info ãŒ currentQuestion.answer ã¨é•ã†å ´åˆã¯ã‚«ã‚¹ã‚¿ãƒ æ–‡è¨€ã¨ã—ã¦ãã®ã¾ã¾è¡¨ç¤º
                // ï¼ˆAI ã¯ã€Œå•é¡Œã«é–“é•ãˆã¾ã—ãŸã€ãŒãã®ã¾ã¾å‡ºã‚‹ï¼‰
                if (info && info !== (currentQuestion?.answer ?? '')) {
                    message.textContent = info;
                } else if (info) {
                    message.textContent = `æ­£è§£ã¯ã€Œ${info}ã€ã§ã—ãŸ`;
                } else {
                    message.textContent = 'æ®‹å¿µï¼';
                }
            }
            
            popup.style.display = 'flex';
        }
        
        // æ­£è§£ãƒ»ä¸æ­£è§£ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ã‚’é–‰ã˜ã‚‹
        function closeAnswerPopup() {
            document.getElementById('answerPopup').style.display = 'none';
            
            // ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ãŒé–‰ã˜ã‚‰ã‚ŒãŸå¾Œã®å‡¦ç†ã‚’å®Ÿè¡Œï¼ˆæ–‡å­—åˆ—ã§ã¯ãªããƒ•ãƒ©ã‚°ã§åˆ¤å®šï¼‰
            const isCorrect = !!lastAnswerCorrect;
            lastAnswerCorrect = null; // ä½¿ã„çµ‚ã‚ã£ãŸã‚‰ã‚¯ãƒªã‚¢
            
            if (isCorrect) {
                // æ­£è§£ã®å ´åˆã®å‡¦ç†
                const actualPlayer = pendingAnswerFor || currentPlayer;
                movePlayer(diceValue, actualPlayer);
                if (gameEnded) return; // å‹åˆ©å¾Œã®å¾Œç¶šå‡¦ç†ã‚’ä¸­æ–­
                
                // ç§»å‹•å®Œäº†å¾Œã®å‡¦ç†
                const t = setTimeout(() => {
                    if (gameEnded) return;
                    
                    // ã‚´ãƒ¼ãƒ«ã—ãŸå ´åˆã¯ã‚«ãƒ¼ãƒ‰ç²å¾—ãªã—
                    if (players[actualPlayer].position >= 29) {
                        console.log('ã‚´ãƒ¼ãƒ«åˆ°é”â†’ã‚«ãƒ¼ãƒ‰ç²å¾—ãªã—â†’ã‚²ãƒ¼ãƒ çµ‚äº†');
                        return;
                    }
                    
                    // 70%ã®ç¢ºç‡ã§ã‚«ãƒ¼ãƒ‰ã‚’ç²å¾—
                    if (Math.random() < 0.7) {
                        // 20%ã®ç¢ºç‡ã§2æšç²å¾—
                        const cardCount = Math.random() < 0.2 ? 2 : 1;
                        giveCards(actualPlayer, cardCount);
                        // ã‚«ãƒ¼ãƒ‰ç²å¾—ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ã¯æ‰‹å‹•ã§é–‰ã˜ã‚‹ã¾ã§å¾…æ©Ÿ
                    } else {
                        // ã‚«ãƒ¼ãƒ‰ç²å¾—ãªã—ã®å ´åˆã¯ã‚¿ãƒ¼ãƒ³åˆ‡ã‚Šæ›¿ãˆ
                        console.log('æ­£è§£â†’ã‚«ãƒ¼ãƒ‰ç²å¾—ãªã—â†’ã‚¿ãƒ¼ãƒ³çµ‚äº†');
                        switchToNextPlayer();
                    }
                }, 1000);
                timers.push(t);
            } else {
                // ä¸æ­£è§£ã®å ´åˆã¯ã‚¿ãƒ¼ãƒ³åˆ‡ã‚Šæ›¿ãˆ
                console.log('ä¸æ­£è§£â†’ã‚¿ãƒ¼ãƒ³çµ‚äº†');
                switchToNextPlayer();
            }
        }
        
        // ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚’ç§»å‹•
        function movePlayer(steps, playerNum = null) {
            if (gameEnded) return;
            
            // â˜…å¤‰æ›´: æ‰€æœ‰è€…æŒ‡å®šå¯¾å¿œï¼ˆç«¶åˆãƒã‚°ä¿®æ­£ï¼‰
            const targetPlayer = playerNum || currentPlayer;
            const oldPosition = players[targetPlayer].position;
            const newPosition = Math.min(oldPosition + steps, 29);
            
            console.log(`ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼${targetPlayer}: ${oldPosition} â†’ ${newPosition} (${steps}ãƒã‚¹é€²ã‚€)`);
            
            // ç§»å‹•ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³åŠ¹æœ
            animateMovement(oldPosition, newPosition, targetPlayer, () => {
                players[targetPlayer].position = newPosition;
                updatePlayerPositions();
                
                // ã‚´ãƒ¼ãƒ«åˆ¤å®šï¼ˆå³æ™‚ãƒ»åŒæœŸï¼‰
                if (newPosition >= 29) {
                    if (!gameEnded) endGame(targetPlayer);
                    return;
                }
            });
        }
        
        // ç§»å‹•ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆrequestAnimationFrameä½¿ç”¨ã§ã‚«ã‚¯ã¤ãä½æ¸›ï¼‰
        function animateMovement(from, to, playerNum, callback) {
            if (from === to) {
                callback();
                return;
            }
            
            let current = from;
            let lastTime = 0;
            const stepDelay = 300; // ãƒŸãƒªç§’
            
            const step = (currentTime) => {
                if (gameEnded) return;
                
                if (currentTime - lastTime >= stepDelay) {
                    if (current < to) {
                        current++;
                        players[playerNum].position = current;
                        updatePlayerPositions();
                        lastTime = currentTime;
                    } else {
                        callback();
                        return;
                    }
                }
                requestAnimationFrame(step);
            };
            requestAnimationFrame(step);
        }
        
        // ã‚«ãƒ¼ãƒ‰ã‚’ä¸ãˆã‚‹ï¼ˆè¤‡æ•°æšå¯¾å¿œï¼‰
        function giveCards(playerNum = null, count = 1) {
            // â˜…å¤‰æ›´: æ‰€æœ‰è€…æŒ‡å®šå¯¾å¿œï¼ˆç«¶åˆãƒã‚°ä¿®æ­£ï¼‰
            const targetPlayer = playerNum || currentPlayer;
            const obtainedCards = [];
            
            for (let i = 0; i < count; i++) {
                const randomCard = getRandomCard();
                players[targetPlayer].cards.push(randomCard);
                obtainedCards.push(randomCard);
            }
            
            // ã‚«ãƒ¼ãƒ‰ç²å¾—ã®ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—è¡¨ç¤º
            const t = setTimeout(() => {
                if (count === 1) {
                    showCardPopup(obtainedCards[0]);
                } else {
                    showMultipleCardPopup(obtainedCards);
                }
                updatePlayerPositions();
                
                // AIã®å ´åˆã¯è‡ªå‹•ã§ã‚«ãƒ¼ãƒ‰ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ã‚’é–‰ã˜ã‚‹
                if (isAIGame && targetPlayer === 2) {
                    const t2 = setTimeout(() => {
                        closeCardPopup();
                    }, 2000);
                    timers.push(t2);
                }
            }, 500);
            timers.push(t);
        }
        
        // è¤‡æ•°ã‚«ãƒ¼ãƒ‰ç²å¾—ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—è¡¨ç¤º
        function showMultipleCardPopup(cards) {
            const cardNames = cards.map(card => card.name).join('ã€');
            document.getElementById('popupCardName').textContent = `${cards.length}æšç²å¾—ï¼`;
            document.getElementById('popupCardDesc').textContent = cardNames;
            document.getElementById('cardPopup').style.display = 'flex';
        }
        
        // ã‚«ãƒ¼ãƒ‰ç²å¾—ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—è¡¨ç¤º
        function showCardPopup(card) {
            document.getElementById('popupCardName').textContent = card.name;
            document.getElementById('popupCardDesc').textContent = card.description;
            document.getElementById('cardPopup').style.display = 'flex';
        }
        
        // ã‚«ãƒ¼ãƒ‰ç²å¾—ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ã‚’é–‰ã˜ã‚‹
        function closeCardPopup() {
            if (isClosingCardPopup) return; // äºŒé‡å®Ÿè¡Œé˜²æ­¢
            isClosingCardPopup = true;
            
            document.getElementById('cardPopup').style.display = 'none';
            
            // ã‚«ãƒ¼ãƒ‰ç²å¾—å¾Œã¯ã‚¿ãƒ¼ãƒ³åˆ‡ã‚Šæ›¿ãˆ
            if (!gameEnded) {
                console.log('ã‚«ãƒ¼ãƒ‰ç²å¾—â†’ã‚¿ãƒ¼ãƒ³çµ‚äº†');
                switchToNextPlayer();
            }
            
            // ãƒ•ãƒ©ã‚°ã‚’ãƒªã‚»ãƒƒãƒˆ
            setTimeout(() => { isClosingCardPopup = false; }, 100);
        }
        
        // ã‚·ãƒ¼ãƒ«ãƒ‰ç™ºå‹•ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—è¡¨ç¤º
        function showShieldPopup() {
            document.getElementById('shieldPopup').style.display = 'flex';
        }
        
        // ã‚·ãƒ¼ãƒ«ãƒ‰ç™ºå‹•ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ã‚’é–‰ã˜ã‚‹
        function closeShieldPopup() {
            document.getElementById('shieldPopup').style.display = 'none';
        }
        
        // ã‚«ãƒ¼ãƒ‰ä½¿ç”¨ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—è¡¨ç¤º
        function showCardUsePopup(card) {
            document.getElementById('usedCardName').textContent = card.name;
            document.getElementById('usedCardDesc').textContent = card.description;
            document.getElementById('cardUsePopup').style.display = 'flex';
        }
        
        // ã‚«ãƒ¼ãƒ‰ä½¿ç”¨ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ã‚’é–‰ã˜ã‚‹
        function closeCardUsePopup() {
            document.getElementById('cardUsePopup').style.display = 'none';
            
            // äººé–“ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®å ´åˆã€ä¿ç•™ã•ã‚ŒãŸã‚«ãƒ¼ãƒ‰åŠ¹æœã‚’å®Ÿè¡Œ
            if (window.pendingCardEffect) {
                const { card, playerNum, cardIndex, opponent } = window.pendingCardEffect;
                executeCardEffect(card, playerNum, cardIndex, opponent);
                window.pendingCardEffect = null;
            }
        }
        

        
        // AIã®ã‚¿ãƒ¼ãƒ³å‡¦ç†
        function aiTurn() {
            if (gameEnded || currentPlayer !== 2) return;
            
            // â˜…AIå†å…¥é˜²æ­¢ãƒ•ãƒ©ã‚°ã‚’è¨­å®š
            if (aiBusy) return;
            aiBusy = true;
            const myTurn = turnId;
            
            console.log('AIã®ã‚¿ãƒ¼ãƒ³é–‹å§‹');
            
            // ã‚¹ã‚­ãƒƒãƒ—ã‚¿ãƒ¼ãƒ³ãƒã‚§ãƒƒã‚¯
            if (players[2].skipTurn) {
                players[2].skipTurn = false;
                showAnswerPopup(false, 0, 'ã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ã‚¿ãƒ¼ã¯1å›ä¼‘ã¿ã§ã™');
                const t = setTimeout(() => {
                    closeAnswerPopup();
                    switchToNextPlayer();
                }, 2000);
                timers.push(t);
                return;
            }
            
            // AIãŒã‚«ãƒ¼ãƒ‰ã‚’ä½¿ç”¨ã™ã‚‹ã‹ï¼ˆ90%ï¼‰ï¼‹ ã‚·ãƒ¼ãƒ«ãƒ‰ä»¥å¤–ã®ã¿æŠ½å‡º
            const usableIdx = players[2].cards
              .map((c, i) => ({ c, i }))
              .filter(x => x.c.type !== 'shield')   // æ‰‹å‹•ä½¿ç”¨ä¸å¯ã¯é™¤å¤–
              .map(x => x.i);
            if (usableIdx.length > 0 && Math.random() < 0.9) {
                const cardIndex = usableIdx[Math.floor(Math.random() * usableIdx.length)];
                console.log('AIãŒã‚«ãƒ¼ãƒ‰ã‚’ä½¿ç”¨');
                useCard(2, cardIndex);
                // ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ã¯ä¸è¦ã€‚ã‚«ãƒ¼ãƒ‰åŠ¹æœå´ã§æ¬¡ã®è¡Œå‹•ã¸é€²ã‚€ã€‚
                return;
            }
            
            // AIã®ã‚µã‚¤ã‚³ãƒ­å‡¦ç†
            console.log('AIãŒã‚µã‚¤ã‚³ãƒ­ã‚’æŒ¯ã‚‹');
            aiRollDice();
        }
        
        // AIå°‚ç”¨ã®ã‚µã‚¤ã‚³ãƒ­å‡¦ç†
        function aiRollDice() {
            const diceArea = document.getElementById('diceArea');
            diceArea.innerHTML = '<div class="dice" id="dice">?</div>';
            const dice = document.getElementById('dice');
            
            const myTurn = turnId;
            dice.classList.add('rolling');
            
            let rollCount = 0;
            const rollInterval = setInterval(() => {
                dice.textContent = Math.floor(Math.random() * 6) + 1;
                rollCount++;
                
                if (rollCount > 10) {
                    clearInterval(rollInterval);
                    
                    if (lucky6Active) {
                        diceValue = 6; // ãƒ©ãƒƒã‚­ãƒ¼6åŠ¹æœã§å¿…ãš6
                        lucky6Active = false;
                        console.log('AI: ãƒ©ãƒƒã‚­ãƒ¼6åŠ¹æœã§ã‚µã‚¤ã‚³ãƒ­ãŒ6ã«');
                    } else {
                        diceValue = Math.floor(Math.random() * 6) + 1;
                    }
                    dice.textContent = diceValue;
                    dice.classList.remove('rolling');
                    
                    // AIã®å•é¡Œå‡¦ç†
                    const t = setTimeout(() => {
                        if (gameEnded || currentPlayer !== 2 || myTurn !== turnId) return;
                        aiAnswerQuestion();
                    }, 500);
                    timers.push(t);
                }
            }, 100);
            timers.push(rollInterval);
        }
        
        // AIå°‚ç”¨ã®å•é¡Œå›ç­”å‡¦ç†
        function aiAnswerQuestion() {
            if (gameEnded || currentPlayer !== 2) return;
            
            const myTurn = turnId;
            console.log(`AIå•é¡Œå›ç­”å‡¦ç†é–‹å§‹ - ã‚µã‚¤ã‚³ãƒ­ã®ç›®: ${diceValue}`);
            
            // â˜…å¤‰æ›´: AIã®ã‚¿ãƒ¼ãƒ³æ‰€æœ‰è€…ã‚’è¨˜éŒ²ï¼ˆç«¶åˆãƒã‚°ä¿®æ­£ï¼‰
            pendingAnswerFor = 2;
            
            // å•é¡Œã‚’ç”Ÿæˆï¼ˆAIã‚‚åŒã˜å•é¡Œãƒ‡ãƒ¼ã‚¿ã‚’ä½¿ç”¨ï¼‰
            const questions = questionsByGrade[selectedGrade];
            currentQuestion = questions[Math.floor(Math.random() * questions.length)];
            
            // AIã¯95%ã®ç¢ºç‡ã§æ­£è§£
            const isCorrect = Math.random() < 0.95;
            
            if (isCorrect) {
                console.log(`AIæ­£è§£ - ${diceValue}ãƒã‚¹é€²ã‚€äºˆå®š`);
                
                // AIã®ç§»å‹•å‡¦ç†ï¼ˆäººé–“ã¨åŒã˜æµã‚Œï¼‰
                movePlayer(diceValue, 2);
                if (gameEnded) return; // å‹åˆ©å¾Œã®å¾Œç¶šå‡¦ç†ã‚’ä¸­æ–­
                
                // ç§»å‹•å®Œäº†å¾Œã®å‡¦ç†
                const t = setTimeout(() => {
                    if (gameEnded || currentPlayer !== 2 || myTurn !== turnId) return;
                    
                    // ã‚´ãƒ¼ãƒ«ã—ãŸå ´åˆã¯ã‚«ãƒ¼ãƒ‰ç²å¾—ãªã—
                    if (players[2].position >= 29) {
                        console.log('AI ã‚´ãƒ¼ãƒ«åˆ°é”â†’ã‚«ãƒ¼ãƒ‰ç²å¾—ãªã—â†’ã‚²ãƒ¼ãƒ çµ‚äº†');
                        return;
                    }
                    
                    // 70%ã®ç¢ºç‡ã§ã‚«ãƒ¼ãƒ‰ã‚’ç²å¾—ï¼ˆäººé–“ã¨åŒã˜ç¢ºç‡ï¼‰
                    if (Math.random() < 0.7) {
                        // 20%ã®ç¢ºç‡ã§2æšç²å¾—
                        const cardCount = Math.random() < 0.2 ? 2 : 1;
                        console.log(`AIæ­£è§£â†’${cardCount}æšã‚«ãƒ¼ãƒ‰ç²å¾—`);
                        giveCards(2, cardCount);
                        // AIã®å ´åˆã¯ã‚«ãƒ¼ãƒ‰ç²å¾—ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ãŒè‡ªå‹•ã§é–‰ã˜ã‚‰ã‚Œã‚‹
                    } else {
                        // ã‚«ãƒ¼ãƒ‰ç²å¾—ãªã—ã®å ´åˆã¯ã‚¿ãƒ¼ãƒ³åˆ‡ã‚Šæ›¿ãˆ
                        console.log('AIæ­£è§£â†’ã‚«ãƒ¼ãƒ‰ç²å¾—ãªã—â†’ã‚¿ãƒ¼ãƒ³çµ‚äº†');
                        switchToNextPlayer();
                    }
                }, 1500);
                timers.push(t);
            } else {
                console.log('AIä¸æ­£è§£ - é€²ã¾ãªã„');
                showAnswerPopup(false, 0, 'å•é¡Œã«é–“é•ãˆã¾ã—ãŸ');
                // AIã®å ´åˆã¯è‡ªå‹•ã§ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ã‚’é–‰ã˜ã‚‹
                const t = setTimeout(() => {
                    if (gameEnded || currentPlayer !== 2 || myTurn !== turnId) return;
                    closeAnswerPopup();
                }, 2000);
                timers.push(t);
            }
        }
        
        // ã‚²ãƒ¼ãƒ çµ‚äº†
        function endGame(winnerNum = null) {
            gameEnded = true;
            const winnerModal = document.getElementById('winnerModal');
            const winnerText = document.getElementById('winnerText');
            
            const actualWinner = winnerNum || currentPlayer;
            winnerText.textContent = `ğŸ‘¦ğŸ‘§ ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼${actualWinner}ã®å‹åˆ©ï¼`;
            winnerModal.style.display = 'flex';
        }
        
        // ã‚²ãƒ¼ãƒ ãƒªã‚»ãƒƒãƒˆ
        function resetGame() {
            // â˜…ã‚¿ã‚¤ãƒãƒ¼ã‚’ã‚¯ãƒªã‚¢
            timers.forEach(clearTimeout);
            timers.length = 0;
            
            currentPlayer = 1;
            players = {
                1: { position: 0, cards: [], shields: 0, skipTurn: false, name: players[1].name },
                2: { position: 0, cards: [], shields: 0, skipTurn: false, name: players[2].name }
            };
            gameEnded = false;
            diceValue = 0;
            turnLocked = false;
            // â˜…å¤‰æ›´: ã‚¿ãƒ¼ãƒ³æ‰€æœ‰è€…ã‚‚ãƒªã‚»ãƒƒãƒˆï¼ˆç«¶åˆãƒã‚°ä¿®æ­£ï¼‰
            pendingAnswerFor = null;
            // ãƒ©ãƒƒã‚­ãƒ¼6åŠ¹æœã‚‚ãƒªã‚»ãƒƒãƒˆ
            lucky6Active = false;
            // â˜…AIå†å…¥é˜²æ­¢ãƒ•ãƒ©ã‚°ã‚‚ãƒªã‚»ãƒƒãƒˆ
            aiBusy = false;
            // äºŒé‡å®Ÿè¡Œé˜²æ­¢ãƒ•ãƒ©ã‚°ã‚‚ãƒªã‚»ãƒƒãƒˆ
            isClosingCardPopup = false;
            isSwitchingTurn = false;
            // ã‚¿ãƒ¼ãƒ³IDã‚‚ãƒªã‚»ãƒƒãƒˆ
            turnId = 0;
            // ã‚¿ãƒ¼ãƒ³IDã‚‚ãƒªã‚»ãƒƒãƒˆ
            turnId = 0;

            document.getElementById('winnerModal').style.display = 'none';
            
            // ã‚µã‚¤ã‚³ãƒ­ã‚¨ãƒªã‚¢ã‚’åˆæœŸçŠ¶æ…‹ã«æˆ»ã™
            const diceArea = document.getElementById('diceArea');
            diceArea.innerHTML = '<div class="dice" id="dice">?</div>';
            
            updateTurnDisplay();
            startPlayerTurn();
            
            // ãƒœãƒ¼ãƒ‰ã‚’å†åˆæœŸåŒ–
            initializeBoard();
        }
        
        // ã‚«ãƒ¼ãƒ‰ãƒ¡ãƒ‹ãƒ¥ãƒ¼è¡¨ç¤º
        function showCardMenu(playerNum) {
            if (playerNum !== currentPlayer || turnLocked) return;
            
            const modal = document.getElementById('cardModal');
            const cardList = document.getElementById('cardList');
            
            cardList.innerHTML = '';
            
            players[playerNum].cards.forEach((card, index) => {
                // ã‚·ãƒ¼ãƒ«ãƒ‰ã‚«ãƒ¼ãƒ‰ã¯ä½¿ç”¨ä¸å¯
                if (card.type === 'shield') {
                    const cardItem = document.createElement('div');
                    cardItem.className = 'card-item';
                    cardItem.style.opacity = '0.5';
                    cardItem.style.cursor = 'not-allowed';
                    cardItem.innerHTML = `
                        <div style="font-size: 1.2rem; margin-bottom: 5px;">${card.name}</div>
                        <div class="card-description">è‡ªå‹•ç™ºå‹•ï¼ˆä½¿ç”¨ä¸å¯ï¼‰</div>
                    `;
                    cardList.appendChild(cardItem);
                } else {
                    const cardItem = document.createElement('div');
                    cardItem.className = 'card-item';
                    cardItem.innerHTML = `
                        <div style="font-size: 1.2rem; margin-bottom: 5px;">${card.name}</div>
                        <div class="card-description">${card.description}</div>
                    `;
                    cardItem.onclick = () => useCard(playerNum, index);
                    cardList.appendChild(cardItem);
                }
            });
            
            modal.style.display = 'flex';
        }
        
        // ã‚«ãƒ¼ãƒ‰ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’é–‰ã˜ã‚‹
        function closeCardMenu() {
            document.getElementById('cardModal').style.display = 'none';
        }
        
        // ã‚«ãƒ¼ãƒ‰ã‚’ä½¿ç”¨
        function useCard(playerNum, cardIndex) {
            // äººé–“ã®èª¤æ“ä½œã¯ãƒ­ãƒƒã‚¯ã§é˜²ããŒã€AIã¯ãƒ­ãƒƒã‚¯ä¸­ã§ã‚‚ä½¿ç”¨ã‚’è¨±å¯ã™ã‚‹
            if (turnLocked && !(isAIGame && playerNum === 2)) return;
            
            lockInputs();
            
            const card = players[playerNum].cards[cardIndex];
            const opponent = playerNum === 1 ? 2 : 1;
            
            closeCardMenu();
            
            // ã‚«ãƒ¼ãƒ‰ä½¿ç”¨ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ã‚’è¡¨ç¤º
            showCardUsePopup(card);
            
            // AIã®å ´åˆã¯è‡ªå‹•ã§ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ã‚’é–‰ã˜ã‚‹ã€äººé–“ã®å ´åˆã¯æ‰‹å‹•
            if (isAIGame && playerNum === 2) {
                const t = setTimeout(() => {
                    closeCardUsePopup();
                    executeCardEffect(card, playerNum, cardIndex, opponent);
                }, 1500);
                timers.push(t);
            } else {
                // äººé–“ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®å ´åˆã¯æ‰‹å‹•ã§é–‰ã˜ã‚‹ã¾ã§å¾…æ©Ÿ
                // ã‚«ãƒ¼ãƒ‰åŠ¹æœã¯ closeCardUsePopup() ã§å®Ÿè¡Œã•ã‚Œã‚‹
                window.pendingCardEffect = { card, playerNum, cardIndex, opponent };
            }
        }
        
        // ã‚«ãƒ¼ãƒ‰åŠ¹æœã‚’å®Ÿè¡Œã™ã‚‹é–¢æ•°
        function executeCardEffect(card, playerNum, cardIndex, opponent) {
            switch(card.type) {
                case 'shield':
                    console.log('ğŸ›¡ï¸ ã‚·ãƒ¼ãƒ«ãƒ‰ã¯è‡ªå‹•ç™ºå‹•ã®ãŸã‚æ‰‹å‹•ä½¿ç”¨ä¸å¯');
                    // AIãªã‚‰ãã®ã¾ã¾æ¬¡ã®è¡Œå‹•ã¸ã€äººé–“ãªã‚‰å…¥åŠ›ã‚’æˆ»ã™
                    if (isAIGame && playerNum === 2) {
                        setTimeout(() => { if (!gameEnded && currentPlayer === 2) aiRollDice(); }, 400);
                    } else {
                        unlockInputsForCurrentPlayer();
                    }
                    return;
                    
                case 'dice2':
                    // â˜…å¤‰æ›´: ãƒ€ã‚¤ã‚¹ç³»ã‚«ãƒ¼ãƒ‰ã®ã‚¿ãƒ¼ãƒ³æ‰€æœ‰è€…ã‚’è¨˜éŒ²ï¼ˆç«¶åˆãƒã‚°ä¿®æ­£ï¼‰
                    pendingAnswerFor = playerNum;
                    // 2å€‹ã®ã‚µã‚¤ã‚³ãƒ­ã‚’è¡¨ç¤ºã—ã¦ã‹ã‚‰å•é¡Œã¸
                    rollMultipleDice(2);
                    // ã‚«ãƒ¼ãƒ‰ã‚’æ¶ˆè²»
                    players[playerNum].cards.splice(cardIndex, 1);
                    updatePlayerPositions();
                    return; // æ—©æœŸãƒªã‚¿ãƒ¼ãƒ³ã§ä»¥ä¸‹ã®å‡¦ç†ã‚’ã‚¹ã‚­ãƒƒãƒ—
                    
                case 'dice3':
                    // â˜…å¤‰æ›´: ãƒ€ã‚¤ã‚¹ç³»ã‚«ãƒ¼ãƒ‰ã®ã‚¿ãƒ¼ãƒ³æ‰€æœ‰è€…ã‚’è¨˜éŒ²ï¼ˆç«¶åˆãƒã‚°ä¿®æ­£ï¼‰
                    pendingAnswerFor = playerNum;
                    // 3å€‹ã®ã‚µã‚¤ã‚³ãƒ­ã‚’è¡¨ç¤ºã—ã¦ã‹ã‚‰å•é¡Œã¸
                    rollMultipleDice(3);
                    // ã‚«ãƒ¼ãƒ‰ã‚’æ¶ˆè²»
                    players[playerNum].cards.splice(cardIndex, 1);
                    updatePlayerPositions();
                    return; // æ—©æœŸãƒªã‚¿ãƒ¼ãƒ³ã§ä»¥ä¸‹ã®å‡¦ç†ã‚’ã‚¹ã‚­ãƒƒãƒ—
                    
                case 'lucky6':
                    lucky6Active = true;
                    console.log('ãƒ©ãƒƒã‚­ãƒ¼6åŠ¹æœã‚’æœ‰åŠ¹åŒ–');
                    alert('ğŸ€ ãƒ©ãƒƒã‚­ãƒ¼6åŠ¹æœãŒæœ‰åŠ¹ã«ãªã‚Šã¾ã—ãŸï¼æ¬¡ã®ã‚µã‚¤ã‚³ãƒ­ã§å¿…ãš6ãŒå‡ºã¾ã™ï¼');
                    break;
                    
                case 'attack':
                    if (hasShield(opponent)) {
                        useShield(opponent);
                        showShieldPopup();
                    } else {
                        players[opponent].position = Math.max(0, players[opponent].position - 3);
                        alert(`ğŸ’¥ ç›¸æ‰‹ã‚’3ãƒã‚¹æˆ»ã—ã¾ã—ãŸï¼`);
                        updatePlayerPositions();
                    }
                    break;
                    
                case 'jump':
                    alert('ğŸš€ ã‚¸ãƒ£ãƒ³ãƒ—: 3ãƒã‚¹é€²ã¿ã¾ã™ï¼');
                    movePlayer(3, playerNum);
                    break;
                    

                    
                case 'bomb':
                    if (hasShield(opponent)) {
                        useShield(opponent);
                        showShieldPopup();
                    } else {
                        players[1].position = 0;
                        players[2].position = 0;
                        alert('ğŸ’£ çˆ†ç™ºï¼ä¸¡ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ãŒã‚¹ã‚¿ãƒ¼ãƒˆã«æˆ»ã‚Šã¾ã—ãŸï¼');
                        updatePlayerPositions();
                    }
                    break;
                    
                case 'stop':
                    if (hasShield(opponent)) {
                        useShield(opponent);
                        showShieldPopup();
                    } else {
                        players[opponent].skipTurn = true;
                        alert(`ğŸš§ ç›¸æ‰‹ã‚’1å›ä¼‘ã¿ã«ã—ã¾ã—ãŸï¼`);
                    }
                    break;
                    
                case 'random':
                    const randomPos = Math.floor(Math.random() * 29); // 0..28ï¼ˆã‚¹ã‚¿ãƒ¼ãƒˆã‹ã‚‰ã‚´ãƒ¼ãƒ«æ‰‹å‰ã¾ã§ï¼‰
                    players[playerNum].position = randomPos;
                    const positionText = randomPos === 0 ? 'ã‚¹ã‚¿ãƒ¼ãƒˆ' : `${randomPos}ç•ªç›®ã®ãƒã‚¹`;
                    alert(`ğŸª‚ ãƒ©ãƒ³ãƒ€ãƒ ãƒ†ãƒ¬ãƒãƒ¼ãƒˆ: ${positionText}ã«ç§»å‹•ã—ã¾ã—ãŸï¼`);
                    updatePlayerPositions();
                    break;
                    
                case 'steal':
                    if (hasShield(opponent)) {
                        useShield(opponent);
                        showShieldPopup();
                    } else if (players[opponent].cards.length > 0) {
                        const stolenIndex = Math.floor(Math.random() * players[opponent].cards.length);
                        const stolenCard = players[opponent].cards.splice(stolenIndex, 1)[0];
                        players[playerNum].cards.push(stolenCard);
                        alert(`ğŸ¥· ç›¸æ‰‹ã‹ã‚‰ã€Œ${stolenCard.name}ã€ã‚’å¥ªã„ã¾ã—ãŸï¼`);
                        updatePlayerPositions();
                    } else {
                        alert('ğŸ¥· ç›¸æ‰‹ã¯ã‚«ãƒ¼ãƒ‰ã‚’æŒã£ã¦ã„ã¾ã›ã‚“...');
                    }
                    break;
            }
            
            // ã‚«ãƒ¼ãƒ‰ã‚’æ¶ˆè²»
            players[playerNum].cards.splice(cardIndex, 1);
            updatePlayerPositions();
            
            // ã‚´ãƒ¼ãƒ«åˆ¤å®š
            if (players[playerNum].position >= 29) {
                endGame(playerNum);
                return;
            }
            
            // ã‚«ãƒ¼ãƒ‰ä½¿ç”¨å¾Œã®ã‚¿ãƒ¼ãƒ³å‡¦ç†
            console.log(`ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼${playerNum}ãŒã‚«ãƒ¼ãƒ‰ã€Œ${card.name}ã€ã‚’ä½¿ç”¨å®Œäº†`);
            
            // dice2, dice3ã‚«ãƒ¼ãƒ‰ã¯å•é¡Œå›ç­”å¾Œã«ã‚¿ãƒ¼ãƒ³çµ‚äº†ã™ã‚‹ãŸã‚ã€ã“ã“ã§ã¯ã‚¿ãƒ¼ãƒ³äº¤ä»£ã—ãªã„
            if (['dice2', 'dice3'].includes(card.type)) {
                // ã“ã‚Œã‚‰ã®ã‚«ãƒ¼ãƒ‰ã¯ rollMultipleDice â†’ å•é¡Œå›ç­” â†’ switchToNextPlayer ã®æµã‚Œã§å‡¦ç†ã•ã‚Œã‚‹
                console.log(`${card.name}ã‚«ãƒ¼ãƒ‰ä½¿ç”¨ã€å•é¡Œå›ç­”å¾Œã«ã‚¿ãƒ¼ãƒ³çµ‚äº†äºˆå®š`);
                return;
            }
            
            // ãƒ©ãƒ³ãƒ€ãƒ ã¨æ³¥æ£’ã‚«ãƒ¼ãƒ‰ã¯ã‚¿ãƒ¼ãƒ³çµ‚äº†
            if (['random', 'steal'].includes(card.type)) {
                console.log(`${card.name}ã‚«ãƒ¼ãƒ‰ä½¿ç”¨ã€ã‚¿ãƒ¼ãƒ³çµ‚äº†`);
                const t = setTimeout(() => {
                    if (!gameEnded) switchToNextPlayer();
                }, 800);
                timers.push(t);
                return;
            }
            
            // ãã®ä»–ã®ã‚«ãƒ¼ãƒ‰ï¼šäººé–“ã¯ç¶™ç¶šã€AIã¯è‡ªå‹•ã§æ¬¡ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã¸
            if (!gameEnded) {
              if (isAIGame && playerNum === 2) {
                console.log(`AIãŒã€Œ${card.name}ã€ä½¿ç”¨ â†’ è‡ªå‹•ã§ã‚µã‚¤ã‚³ãƒ­ã¸`);
                const t = setTimeout(() => {
                  if (!gameEnded && currentPlayer === 2) aiRollDice();
                }, 800);
                timers.push(t);
              } else {
                console.log(`ã‚«ãƒ¼ãƒ‰ã€Œ${card.name}ã€ä½¿ç”¨ã€ã‚¿ãƒ¼ãƒ³ç¶™ç¶šï¼ˆäººé–“ï¼‰`);
                const t = setTimeout(() => { if (!gameEnded) unlockInputsForCurrentPlayer(); }, 300);
                timers.push(t);
              }
            }
        }
        
        // ã‚·ãƒ¼ãƒ«ãƒ‰é–¢é€£ã®é–¢æ•°
        function hasShield(playerNum) {
            return players[playerNum].cards.some(card => card.type === 'shield');
        }
        
        function useShield(playerNum) {
            const shieldIndex = players[playerNum].cards.findIndex(card => card.type === 'shield');
            if (shieldIndex !== -1) {
                players[playerNum].cards.splice(shieldIndex, 1);
                updatePlayerPositions();
            }
        }
        
        
        // ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼
        document.addEventListener('keydown', function(event) {
            if (event.key === 'Enter') {
                // ã‚²ãƒ¼ãƒ é–‹å§‹å‰ã®ç”»é¢ã§ã¯ä½•ã‚‚ã—ãªã„
                if (document.getElementById('setupScreen').style.display === 'flex' || 
                    document.getElementById('instructionsScreen').style.display === 'flex' ||
                    document.getElementById('firstPlayerModal').style.display === 'flex') {
                    return;
                }
                
                // å•é¡Œãƒ¢ãƒ¼ãƒ€ãƒ«ãŒé–‹ã„ã¦ã„ã‚‹å ´åˆ
                if (document.getElementById('questionModal').style.display === 'flex') {
                    submitAnswer();
                    return;
                }
                
                // ã‚«ãƒ¼ãƒ‰ç²å¾—ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ãŒé–‹ã„ã¦ã„ã‚‹å ´åˆ
                if (document.getElementById('cardPopup').style.display === 'flex') {
                    closeCardPopup();
                    return;
                }
                
                // ã‚«ãƒ¼ãƒ‰ä½¿ç”¨ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ãŒé–‹ã„ã¦ã„ã‚‹å ´åˆ
                if (document.getElementById('cardUsePopup').style.display === 'flex') {
                    closeCardUsePopup();
                    return;
                }
                
                // ã‚·ãƒ¼ãƒ«ãƒ‰ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ãŒé–‹ã„ã¦ã„ã‚‹å ´åˆ
                if (document.getElementById('shieldPopup').style.display === 'flex') {
                    closeShieldPopup();
                    return;
                }
                
                // æ­£è§£ãƒ»ä¸æ­£è§£ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ãŒé–‹ã„ã¦ã„ã‚‹å ´åˆ
                if (document.getElementById('answerPopup').style.display === 'flex') {
                    closeAnswerPopup();
                    return;
                }
                
                // å‹åˆ©ãƒ¢ãƒ¼ãƒ€ãƒ«ãŒé–‹ã„ã¦ã„ã‚‹å ´åˆ
                if (document.getElementById('winnerModal').style.display === 'flex') {
                    resetGame();
                    return;
                }
                
                // ã‚²ãƒ¼ãƒ ä¸­ã®ã¿ã‚µã‚¤ã‚³ãƒ­ãƒœã‚¿ãƒ³ãŒæœ‰åŠ¹ãªå ´åˆ
                if (document.getElementById('gameContainer').style.display === 'flex') {
                    const rollBtn = document.getElementById('rollBtn');
                    if (rollBtn && !rollBtn.disabled && rollBtn.style.display !== 'none') {
                        rollDice();
                        return;
                    }
                }
            }
        });
        
        // ã‚²ãƒ¼ãƒ çµ‚äº†ç¢ºèªè¡¨ç¤º
        function showQuitConfirm() {
            document.getElementById('quitModal').style.display = 'flex';
        }
        
        // ã‚²ãƒ¼ãƒ çµ‚äº†ç¢ºèªã‚’é–‰ã˜ã‚‹
        function closeQuitConfirm() {
            document.getElementById('quitModal').style.display = 'none';
        }
        
        // ã‚²ãƒ¼ãƒ çµ‚äº†ï¼ˆæœ€åˆã®ç”»é¢ã«æˆ»ã‚‹ï¼‰
        function quitGame() {
            // ã‚²ãƒ¼ãƒ çŠ¶æ…‹ã‚’ãƒªã‚»ãƒƒãƒˆ
            currentPlayer = 1;
            players = {
                1: { position: 0, cards: [], shields: 0, skipTurn: false, name: "" },
                2: { position: 0, cards: [], shields: 0, skipTurn: false, name: "" }
            };
            gameEnded = false;
            diceValue = 0;
            isAIGame = false;
            playerCount = 2;
            turnLocked = false;
            // â˜…å¤‰æ›´: ã‚¿ãƒ¼ãƒ³æ‰€æœ‰è€…ã‚‚ãƒªã‚»ãƒƒãƒˆï¼ˆç«¶åˆãƒã‚°ä¿®æ­£ï¼‰
            pendingAnswerFor = null;
            // ãƒ©ãƒƒã‚­ãƒ¼6åŠ¹æœã‚‚ãƒªã‚»ãƒƒãƒˆ
            lucky6Active = false;
            // äºŒé‡å®Ÿè¡Œé˜²æ­¢ãƒ•ãƒ©ã‚°ã‚‚ãƒªã‚»ãƒƒãƒˆ
            isClosingCardPopup = false;
            isSwitchingTurn = false;
            // ã‚¿ãƒ¼ãƒ³IDã‚‚ãƒªã‚»ãƒƒãƒˆ
            turnId = 0;
            
            // å…¨ã¦ã®ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’é–‰ã˜ã‚‹
            document.getElementById('quitModal').style.display = 'none';
            document.getElementById('questionModal').style.display = 'none';
            document.getElementById('cardModal').style.display = 'none';
            document.getElementById('cardPopup').style.display = 'none';
            document.getElementById('cardUsePopup').style.display = 'none';
            document.getElementById('shieldPopup').style.display = 'none';
            document.getElementById('answerPopup').style.display = 'none';
            document.getElementById('winnerModal').style.display = 'none';
            
            // ç”»é¢ã‚’åˆ‡ã‚Šæ›¿ãˆ
            document.getElementById('gameContainer').style.display = 'none';
            document.getElementById('instructionsScreen').style.display = 'none';
            document.getElementById('setupScreen').style.display = 'flex';
            
            // å…¥åŠ›ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’ãƒªã‚»ãƒƒãƒˆ
            document.getElementById('player1Name').value = 'ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼1';
            document.getElementById('player2Name').value = 'ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼2';
            document.getElementById('playerCountSelect').value = '2';
            document.getElementById('gradeSelect').value = '4';
            togglePlayer2Input();
        }
        
        // å…¨ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ã‚’é–‰ã˜ã‚‹é–¢æ•°
        function closeAllPopups() {
            ['questionModal','cardModal','cardPopup','shieldPopup','answerPopup','winnerModal','quitModal','cardUsePopup','firstPlayerModal']
                .forEach(id => {
                    const el = document.getElementById(id);
                    if (el) el.style.display = 'none';
                });
        }
        
        // è¨­å®šä¿å­˜ï¼ˆæˆæ¥­ã§ç¹°ã‚Šè¿”ã—éŠã¶éš›ã®ä¾¿åˆ©æ©Ÿèƒ½ï¼‰
        function saveSettings(){
            try {
                localStorage.setItem('kanjiSugorokuSettings', JSON.stringify({
                    p1: players[1].name,
                    p2: players[2].name,
                    grade: selectedGrade,
                    isAIGame: isAIGame
                }));
            } catch(e) {
                console.warn('è¨­å®šä¿å­˜ã«å¤±æ•—:', e);
            }
        }
        
        // è¨­å®šèª­ã¿è¾¼ã¿
        function loadSettings(){
            try{
                const s = JSON.parse(localStorage.getItem('kanjiSugorokuSettings'));
                if(!s) return;
                document.getElementById('player1Name').value = s.p1 || 'ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼1';
                document.getElementById('player2Name').value = s.p2 || 'ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼2';
                document.getElementById('gradeSelect').value = String(s.grade || 4);
                document.getElementById('playerCountSelect').value = s.isAIGame ? '1' : '2';
                togglePlayer2Input();
            }catch(e){
                console.warn('è¨­å®šèª­ã¿è¾¼ã¿ã«å¤±æ•—:', e);
            }
        }
        
        // ãƒ¢ãƒ¼ãƒ€ãƒ«å…±é€šãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£
        function openModal(id, focusSelector) {
            const el = document.getElementById(id);
            if (!el) return;
            el.style.display = 'flex';
            if (focusSelector) {
                // æ¬¡ãƒ•ãƒ¬ãƒ¼ãƒ ã§ãƒ•ã‚©ãƒ¼ã‚«ã‚¹ï¼ˆè¦ç´ ç”Ÿæˆç›´å¾Œã§ã‚‚OKã«ã™ã‚‹ãŸã‚ï¼‰
                requestAnimationFrame(() => {
                    const f = document.querySelector(focusSelector);
                    if (f && typeof f.focus === 'function') f.focus();
                });
            }
        }

        function closeModal(id) {
            const el = document.getElementById(id);
            if (!el) return;
            el.style.display = 'none';
        }
        
        // ã‚²ãƒ¼ãƒ åˆæœŸåŒ–
        initializeBoard();
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'971215ddd552d3ce',t:'MTc1NTUyNzE3OC4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
