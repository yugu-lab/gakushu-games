<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ•´æ•°åˆ¤åˆ¥ã‚²ãƒ¼ãƒ </title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Comic Sans MS', cursive, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            overflow: hidden;
            position: relative;
        }

        .stars {
            position: absolute;
            width: 100%;
            height: 100%;
            pointer-events: none;
        }

        .star {
            position: absolute;
            color: white;
            font-size: 20px;
            animation: twinkle 2s infinite;
        }

        @keyframes twinkle {
            0%, 100% { opacity: 0.3; }
            50% { opacity: 1; }
        }

        .container {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            min-height: 100dvh;
            min-height: 100svh;
            padding: 20px;
            position: relative;
            z-index: 10;
        }

        .title {
            font-size: 3rem;
            color: white;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
            margin-bottom: 2rem;
            text-align: center;
        }

        .menu {
            display: flex;
            flex-direction: column;
            gap: 1rem;
            align-items: center;
        }

        .game-button {
            background: linear-gradient(45deg, #ff6b6b, #feca57);
            border: none;
            padding: 1rem 2rem;
            font-size: 1.2rem;
            font-weight: bold;
            color: white;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            min-width: 300px;
        }

        .game-button:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.3);
        }

        .game-screen {
            display: none;
            width: 100%;
            height: 100vh;
            min-height: 100dvh;
            min-height: 100svh;
            position: relative;
            overflow: hidden;
        }

        .game-header {
            position: absolute;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 1rem;
            z-index: 100;
            flex-wrap: nowrap;
            width: 90%;
            max-width: 800px;
            justify-content: center;
        }

        .score-display, .timer-display, .rule-display {
            background: rgba(255,255,255,0.9);
            padding: 8px 16px;
            border-radius: 15px;
            font-weight: bold;
            font-size: 1rem;
            color: #333;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
            white-space: nowrap;
            flex: 1;
            text-align: center;
            min-width: 120px;
        }

        .shooting-star {
            position: absolute;
            background: linear-gradient(45deg, #ff9a9e, #fecfef);
            color: white;
            padding: 15px 25px;
            border-radius: 50px;
            font-size: 2.5rem;
            font-weight: bold;
            box-shadow: 0 0 20px rgba(255,255,255,0.5);
            animation: shoot 4s linear;
            z-index: 50;
        }

        @keyframes shoot {
            from {
                right: -100px;
                transform: translateY(0);
            }
            to {
                right: 100vw;
                transform: translateY(0);
            }
        }

        .shooting-star-left {
            animation: shootLeft 4s linear;
        }

        @keyframes shootLeft {
            from {
                left: -100px;
                transform: translateY(0);
            }
            to {
                left: 100vw;
                transform: translateY(0);
            }
        }

        .shooting-star-lcm {
            animation: shootLCM 20s linear;
        }

        .shooting-star-lcm-left {
            animation: shootLCMLeft 20s linear;
        }

        @keyframes shootLCM {
            from {
                right: -100px;
                transform: translateY(0);
            }
            to {
                right: 100vw;
                transform: translateY(0);
            }
        }

        @keyframes shootLCMLeft {
            from {
                left: -100px;
                transform: translateY(0);
            }
            to {
                left: 100vw;
                transform: translateY(0);
            }
        }



        .explosion {
            position: absolute;
            font-size: 3rem;
            animation: explode 0.5s ease-out;
            z-index: 60;
        }

        @keyframes explode {
            0% {
                transform: scale(0);
                opacity: 1;
            }
            100% {
                transform: scale(2);
                opacity: 0;
            }
        }

        .back-button {
            position: absolute;
            bottom: 20px;
            right: 20px;
            background: rgba(255,255,255,0.2);
            border: 2px solid white;
            color: white;
            padding: 10px 20px;
            border-radius: 20px;
            cursor: pointer;
            font-weight: bold;
            z-index: 100;
        }

        .back-button:hover {
            background: rgba(255,255,255,0.3);
        }

        .game-over {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0,0,0,0.8);
            color: white;
            padding: 2rem;
            border-radius: 20px;
            text-align: center;
            z-index: 200;
        }

        .roulette {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            padding: 2rem;
            border-radius: 20px;
            text-align: center;
            z-index: 200;
        }

        .roulette-wheel {
            width: 200px;
            height: 200px;
            border: 10px solid #333;
            border-radius: 50%;
            margin: 1rem auto;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 3rem;
            font-weight: bold;
            background: linear-gradient(45deg, #ff6b6b, #4ecdc4, #45b7d1, #96ceb4, #feca57, #ff9ff3);
            animation: spin 2s linear infinite;
        }

        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        .input-area {
            position: absolute;
            bottom: 140px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            flex-direction: column;
            gap: 1rem;
            align-items: center;
            z-index: 100;
        }

        .input-row {
            display: flex;
            gap: 1rem;
            align-items: center;
        }

        .number-input {
            padding: 15px;
            font-size: 1.5rem;
            border: 3px solid white;
            border-radius: 10px;
            text-align: center;
            width: 150px;
        }

        .submit-button {
            background: #4ecdc4;
            border: none;
            color: white;
            padding: 15px 25px;
            font-size: 1.2rem;
            border-radius: 10px;
            cursor: pointer;
            font-weight: bold;
        }

        .numpad {
            display: flex;
            gap: 0.5rem;
            flex-wrap: nowrap;
            justify-content: center;
            max-width: 800px;
            overflow-x: auto;
        }

        .numpad-button {
            background: rgba(255,255,255,0.9);
            border: 2px solid #333;
            color: #333;
            padding: 12px 16px;
            font-size: 1.2rem;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            min-width: 50px;
            transition: all 0.2s ease;
        }

        .numpad-button:hover {
            background: #4ecdc4;
            color: white;
            transform: translateY(-2px);
        }

        .numpad-button.clear {
            background: #ff6b6b;
            color: white;
        }

        .numpad-button.clear:hover {
            background: #ff5252;
        }

        .instructions {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            color: white;
            text-align: center;
            font-size: 1.1rem;
            background: rgba(0,0,0,0.5);
            padding: 10px 20px;
            border-radius: 10px;
            z-index: 100;
        }

        .game-buttons {
            position: absolute;
            bottom: 80px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 1rem;
            z-index: 100;
        }

        .touch-button {
            background: linear-gradient(45deg, #4ecdc4, #44a08d);
            border: none;
            color: white;
            padding: 15px 25px;
            font-size: 1.2rem;
            border-radius: 15px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            min-width: 120px;
        }

        .touch-button:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.3);
        }

        .touch-button:active {
            transform: translateY(0);
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
        }

        .even-button {
            background: linear-gradient(45deg, #667eea, #764ba2);
        }

        .odd-button {
            background: linear-gradient(45deg, #f093fb, #f5576c);
        }

        .multiple-yes-button {
            background: linear-gradient(45deg, #4ecdc4, #44a08d);
        }

        .multiple-no-button {
            background: linear-gradient(45deg, #ff6b6b, #ee5a52);
        }

        @media (prefers-reduced-motion: reduce) {
            .shooting-star, .shooting-star-left,
            .shooting-star-lcm, .shooting-star-lcm-left,
            .roulette-wheel {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
            }
        }
    </style>
</head>
<body>
    <div class="stars" id="stars"></div>
    
    <div class="container" id="menu">
        <h1 class="title">ğŸŒŸ æ•´æ•°åˆ¤åˆ¥ã‚²ãƒ¼ãƒ  ğŸŒŸ</h1>
        <div class="menu">
            <button class="game-button" onclick="startGame('evenOdd')">
                ğŸ¯ å¶æ•°å¥‡æ•°åˆ¤åˆ¥ã‚²ãƒ¼ãƒ <br>
                <small>ãƒã‚¤ã‚¹ã‚³ã‚¢: <span id="evenOddMenuHigh">0</span></small>
            </button>
            <button class="game-button" onclick="startGame('multiple')">
                ğŸ² ã€‡ã®å€æ•°ã‚²ãƒ¼ãƒ <br>
                <small>ãƒã‚¤ã‚¹ã‚³ã‚¢: <span id="multipleMenuHigh">0</span></small>
            </button>
            <button class="game-button" onclick="startGame('lcm')">
                ğŸ§® æœ€å°å…¬å€æ•°ã‚²ãƒ¼ãƒ <br>
                <small>ãƒã‚¤ã‚¹ã‚³ã‚¢: <span id="lcmMenuHigh">0</span></small>
            </button>
        </div>
    </div>

    <!-- å¶æ•°å¥‡æ•°ã‚²ãƒ¼ãƒ  -->
    <div class="game-screen" id="evenOddGame">
        <button class="back-button" onclick="backToMenu()">â† ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã«æˆ»ã‚‹</button>
        <div class="game-header">
            <div class="score-display">ã‚¹ã‚³ã‚¢: <span id="evenOddScore">0</span></div>
            <div class="timer-display">æ™‚é–“: <span id="evenOddTimer">20</span>ç§’</div>
            <div class="score-display">ãƒã‚¤ã‚¹ã‚³ã‚¢: <span id="evenOddHigh">0</span></div>
        </div>
        <div class="game-buttons">
            <button class="touch-button even-button" onclick="checkEvenOdd(true)">å¶æ•°</button>
            <button class="touch-button odd-button" onclick="checkEvenOdd(false)">å¥‡æ•°</button>
        </div>
        <div class="instructions">
            å¶æ•°ãªã‚‰ã€Œå¶æ•°ã€ãƒœã‚¿ãƒ³ã¾ãŸã¯ Enter ã‚­ãƒ¼ã€å¥‡æ•°ãªã‚‰ã€Œå¥‡æ•°ã€ãƒœã‚¿ãƒ³ã¾ãŸã¯ Space ã‚­ãƒ¼ã‚’æŠ¼ãã†ï¼
        </div>
    </div>

    <!-- å€æ•°ã‚²ãƒ¼ãƒ  -->
    <div class="game-screen" id="multipleGame">
        <button class="back-button" onclick="backToMenu()">â† ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã«æˆ»ã‚‹</button>
        <div class="game-header">
            <div class="score-display">ã‚¹ã‚³ã‚¢: <span id="multipleScore">0</span></div>
            <div class="timer-display">æ™‚é–“: <span id="multipleTimer">20</span>ç§’</div>
            <div class="rule-display" id="multipleRule">?ã®å€æ•°</div>
            <div class="score-display">ãƒã‚¤ã‚¹ã‚³ã‚¢: <span id="multipleHigh">0</span></div>
        </div>
        <div class="game-buttons">
            <button class="touch-button multiple-yes-button" onclick="checkMultiple(true)"><span id="multipleYesText">3</span>ã®å€æ•°</button>
            <button class="touch-button multiple-no-button" onclick="checkMultiple(false)"><span id="multipleNoText">3</span>ã®å€æ•°ã§ã¯ãªã„</button>
        </div>
        <div class="instructions">
            <span id="multipleInstructions">å€æ•°ãªã‚‰ Enter ã‚­ãƒ¼ã€é•ã†ãªã‚‰ Space ã‚­ãƒ¼ã‚’æŠ¼ãã†ï¼</span>
        </div>
    </div>

    <!-- æœ€å°å…¬å€æ•°ã‚²ãƒ¼ãƒ  -->
    <div class="game-screen" id="lcmGame">
        <button class="back-button" onclick="backToMenu()">â† ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã«æˆ»ã‚‹</button>
        <div class="game-header">
            <div class="score-display">ã‚¹ã‚³ã‚¢: <span id="lcmScore">0</span></div>
            <div class="timer-display">æ™‚é–“: <span id="lcmTimer">60</span>ç§’</div>
            <div class="score-display">ãƒã‚¤ã‚¹ã‚³ã‚¢: <span id="lcmHigh">0</span></div>
        </div>
        <div class="input-area">
            <div class="input-row">
                <input type="text" inputmode="numeric" pattern="[0-9]*" class="number-input" id="lcmInput" placeholder="ç­”ãˆã‚’å…¥åŠ›">
                <button class="submit-button" onclick="submitLCM()">é€ä¿¡</button>
                <button class="touch-button" onclick="skipLCM()">ã‚¹ã‚­ãƒƒãƒ—ï¼ˆ-3ç§’ï¼‰</button>
            </div>
            <div class="numpad">
                <button class="numpad-button" onclick="addNumber('1')">1</button>
                <button class="numpad-button" onclick="addNumber('2')">2</button>
                <button class="numpad-button" onclick="addNumber('3')">3</button>
                <button class="numpad-button" onclick="addNumber('4')">4</button>
                <button class="numpad-button" onclick="addNumber('5')">5</button>
                <button class="numpad-button" onclick="addNumber('6')">6</button>
                <button class="numpad-button" onclick="addNumber('7')">7</button>
                <button class="numpad-button" onclick="addNumber('8')">8</button>
                <button class="numpad-button" onclick="addNumber('9')">9</button>
                <button class="numpad-button" onclick="addNumber('0')">0</button>
                <button class="numpad-button clear" onclick="clearInput()">ã‚¯ãƒªã‚¢</button>
            </div>
        </div>
        <div class="instructions">
            å·¦å³ã®æ•°å­—ã®æœ€å°å…¬å€æ•°ã‚’å…¥åŠ›ã—ã¦Enterã‚­ãƒ¼ã‚’æŠ¼ãã†ï¼
        </div>
    </div>

    <!-- ãƒ«ãƒ¼ãƒ¬ãƒƒãƒˆ -->
    <div class="roulette" id="roulette" style="display: none;">
        <h2>ä½•ã®å€æ•°ã‹ãªï¼Ÿ</h2>
        <div class="roulette-wheel" id="rouletteWheel">?</div>
        <button class="game-button" onclick="stopRoulette()">ã‚¹ãƒˆãƒƒãƒ—ï¼</button>
        <p style="margin-top: 1rem; color: #666; font-size: 0.9rem;">Enter ã¾ãŸã¯ Space ã‚­ãƒ¼ã§ã‚¹ãƒˆãƒƒãƒ—</p>
    </div>

    <!-- å€æ•°ç¢ºèªç”»é¢ -->
    <div class="game-over" id="multipleConfirm" style="display: none;">
        <h2 id="multipleConfirmTitle">æ±ºå®šï¼</h2>
        <div style="margin: 1.5rem 0; font-size: 1.2rem; line-height: 1.8;">
            <p><strong id="multipleNumber">3</strong>ã®å€æ•°ã‚²ãƒ¼ãƒ ã§ã™ï¼</p>
            <br>
            <p>ğŸ“ <strong>æ“ä½œæ–¹æ³•</strong></p>
            <p><strong id="multipleNumberRule">3</strong>ã®å€æ•°ãªã‚‰ <strong>Enter</strong> ã‚­ãƒ¼</p>
            <p><strong id="multipleNumberRule2">3</strong>ã®å€æ•°ã§ãªã‘ã‚Œã° <strong>Space</strong> ã‚­ãƒ¼</p>
        </div>
        <button class="game-button" onclick="startMultipleGame()" style="margin-top: 1rem;">ã‚²ãƒ¼ãƒ ã‚¹ã‚¿ãƒ¼ãƒˆï¼</button>
        <button class="game-button" onclick="backToRoulette()" style="margin-top: 0.5rem; background: #666;">ãƒ«ãƒ¼ãƒ¬ãƒƒãƒˆã«æˆ»ã‚‹</button>
        <p style="margin-top: 1rem; color: #ccc; font-size: 0.9rem;">Enterï¼šã‚²ãƒ¼ãƒ é–‹å§‹ / Spaceï¼šãƒ«ãƒ¼ãƒ¬ãƒƒãƒˆã«æˆ»ã‚‹</p>
    </div>

    <!-- ãƒ«ãƒ¼ãƒ«èª¬æ˜ç”»é¢ -->
    <div class="game-over" id="ruleScreen" style="display: none;">
        <h2 id="ruleTitle">ã‚²ãƒ¼ãƒ ãƒ«ãƒ¼ãƒ«</h2>
        <div id="ruleContent" style="margin: 1rem 0; line-height: 1.6;"></div>
        <button class="game-button" onclick="startActualGame()" style="margin-top: 1rem;">ã‚²ãƒ¼ãƒ ã‚¹ã‚¿ãƒ¼ãƒˆï¼</button>
        <button class="game-button" onclick="backToMenu()" style="margin-top: 0.5rem; background: #666;">æˆ»ã‚‹</button>
        <p style="margin-top: 1rem; color: #ccc; font-size: 0.9rem;">Enterï¼šã‚²ãƒ¼ãƒ é–‹å§‹ / Spaceï¼šãƒ¡ãƒ‹ãƒ¥ãƒ¼ã«æˆ»ã‚‹</p>
    </div>

    <!-- ã‚²ãƒ¼ãƒ ã‚ªãƒ¼ãƒãƒ¼ -->
    <div class="game-over" id="gameOver" style="display: none;">
        <h2 id="gameOverTitle">ã‚²ãƒ¼ãƒ ã‚ªãƒ¼ãƒãƒ¼ï¼</h2>
        <p id="gameOverText">ã‚¹ã‚³ã‚¢: 0</p>
        <p id="gameOverHigh"></p>
        <button class="game-button" onclick="backToMenu()" style="margin-top: 1rem;">ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã«æˆ»ã‚‹</button>
        <p style="margin-top: 1rem; color: #ccc; font-size: 0.9rem;">Enter ã¾ãŸã¯ Space ã‚­ãƒ¼ã§ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã«æˆ»ã‚‹</p>
    </div>

    <script>
        let currentGame = null;
        let gameTimer = null;
        let currentStar = null;
        let currentStarLeft = null;
        let score = 0;
        let timeLeft = 30;
        let gameActive = false;
        let multipleNumber = 3;
        let rouletteInterval = null;

        // èƒŒæ™¯ã®æ˜Ÿã‚’ç”Ÿæˆ
        function createBackgroundStars() {
            const starsContainer = document.getElementById('stars');
            for (let i = 0; i < 50; i++) {
                const star = document.createElement('div');
                star.className = 'star';
                star.innerHTML = 'âœ¨';
                star.style.left = Math.random() * 100 + '%';
                star.style.top = Math.random() * 100 + '%';
                star.style.animationDelay = Math.random() * 2 + 's';
                starsContainer.appendChild(star);
            }
        }

        // ãƒã‚¤ã‚¹ã‚³ã‚¢ã‚’å–å¾—
        function getHighScore(gameType) {
            try { 
                return parseInt(localStorage.getItem(`highScore_${gameType}`)) || 0; 
            } catch { 
                return 0; 
            }
        }

        // ãƒã‚¤ã‚¹ã‚³ã‚¢ã‚’ä¿å­˜
        function saveHighScore(gameType, score) {
            try {
                const currentHigh = getHighScore(gameType);
                if (score > currentHigh) { 
                    localStorage.setItem(`highScore_${gameType}`, String(score)); 
                    return true; 
                }
                return false;
            } catch { 
                return false; 
            }
        }

        // ã‚²ãƒ¼ãƒ é–‹å§‹ï¼ˆãƒ«ãƒ¼ãƒ«ç”»é¢è¡¨ç¤ºï¼‰
        function startGame(gameType) {
            currentGame = gameType;
            document.getElementById('menu').style.display = 'none';
            showRuleScreen(gameType);
        }

        // ãƒ«ãƒ¼ãƒ«ç”»é¢è¡¨ç¤º
        function showRuleScreen(gameType) {
            const rules = {
                'evenOdd': {
                    title: 'ğŸ¯ å¶æ•°å¥‡æ•°åˆ¤åˆ¥ã‚²ãƒ¼ãƒ ',
                    content: `
                        <p><strong>ãƒ«ãƒ¼ãƒ«ï¼š</strong></p>
                        <p>â€¢ å³ã‹ã‚‰å·¦ã«0ï½50ã®æ•°å­—ãŒæµã‚Œã¦ãã¾ã™</p>
                        <p>â€¢ å¶æ•°ãªã‚‰ <strong>Enter</strong> ã‚­ãƒ¼ã‚’æŠ¼ãã†</p>
                        <p>â€¢ å¥‡æ•°ãªã‚‰ <strong>Space</strong> ã‚­ãƒ¼ã‚’æŠ¼ãã†</p>
                        <p>â€¢ åˆ¶é™æ™‚é–“ã¯20ç§’ã§ã™</p>
                        <p>â€¢ é–“é•ãˆã‚‹ã¨ã‚²ãƒ¼ãƒ ã‚ªãƒ¼ãƒãƒ¼ã§ã™</p>
                    `
                },
                'multiple': {
                    title: 'ğŸ² ã€‡ã®å€æ•°ã‚²ãƒ¼ãƒ ',
                    content: `
                        <p><strong>ãƒ«ãƒ¼ãƒ«ï¼š</strong></p>
                        <p>â€¢ ã¾ãšãƒ«ãƒ¼ãƒ¬ãƒƒãƒˆã§ä½•ã®å€æ•°ã‹ã‚’æ±ºã‚ã¾ã™</p>
                        <p>â€¢ å³ã‹ã‚‰å·¦ã«<strong>1ï½50</strong>ã®æ•°å­—ãŒæµã‚Œã¦ãã¾ã™</p>
                        <p>â€¢ å€æ•°ãªã‚‰ <strong>Enter</strong> ã‚­ãƒ¼ã‚’æŠ¼ãã†</p>
                        <p>â€¢ å€æ•°ã§ãªã‘ã‚Œã° <strong>Space</strong> ã‚­ãƒ¼ã‚’æŠ¼ãã†</p>
                        <p>â€¢ åˆ¶é™æ™‚é–“ã¯20ç§’ã§ã™</p>
                        <p>â€¢ é–“é•ãˆã‚‹ã¨ã‚²ãƒ¼ãƒ ã‚ªãƒ¼ãƒãƒ¼ã§ã™</p>
                    `
                },
                'lcm': {
                    title: 'ğŸ§® æœ€å°å…¬å€æ•°ã‚²ãƒ¼ãƒ ',
                    content: `
                        <p><strong>ãƒ«ãƒ¼ãƒ«ï¼š</strong></p>
                        <p>â€¢ å·¦å³ã‹ã‚‰2ï½10ã®æ•°å­—ãŒæµã‚Œã¦ãã¾ã™</p>
                        <p>â€¢ 2ã¤ã®æ•°å­—ã®æœ€å°å…¬å€æ•°ã‚’è¨ˆç®—ã—ã‚ˆã†</p>
                        <p>â€¢ ç­”ãˆã‚’å…¥åŠ›ã—ã¦ <strong>Enter</strong> ã‚­ãƒ¼ã‚’æŠ¼ãã†</p>
                        <p>â€¢ åˆ¶é™æ™‚é–“ã¯60ç§’ã§ã™</p>
                        <p>â€¢ é–“é•ãˆã‚‹ã¨ã‚²ãƒ¼ãƒ ã‚ªãƒ¼ãƒãƒ¼ã§ã™</p>
                        <p>â€¢ åˆ†ã‹ã‚‰ãªã‘ã‚Œã°<strong>Sã‚­ãƒ¼</strong>ã‹ã€Œã‚¹ã‚­ãƒƒãƒ—ã€ã§æ¬¡ã¸ï¼ˆ<strong>-3ç§’</strong>ï¼‰</p>
                    `
                }
            };

            document.getElementById('ruleTitle').textContent = rules[gameType].title;
            document.getElementById('ruleContent').innerHTML = rules[gameType].content;
            document.getElementById('ruleScreen').style.display = 'block';
        }

        // å®Ÿéš›ã®ã‚²ãƒ¼ãƒ é–‹å§‹
        function startActualGame() {
            document.getElementById('ruleScreen').style.display = 'none';
            
            if (currentGame === 'multiple') {
                showRoulette();
            } else {
                showGameScreen(currentGame);
            }
        }

        // ãƒ«ãƒ¼ãƒ¬ãƒƒãƒˆè¡¨ç¤º
        function showRoulette() {
            if (rouletteInterval) { clearInterval(rouletteInterval); rouletteInterval = null; }
            document.getElementById('roulette').style.display = 'block';
            
            // ãƒ«ãƒ¼ãƒ¬ãƒƒãƒˆã®åˆæœŸåŒ–
            const wheel = document.getElementById('rouletteWheel');
            wheel.style.animation = 'spin 2s linear infinite';
            wheel.style.background = 'linear-gradient(45deg, #ff6b6b, #4ecdc4, #45b7d1, #96ceb4, #feca57, #ff9ff3)';
            wheel.style.transform = 'scale(1)';
            
            // ã‚¹ãƒˆãƒƒãƒ—ãƒœã‚¿ãƒ³ã®åˆæœŸåŒ–
            const stopButton = document.querySelector('#roulette .game-button');
            stopButton.disabled = false;
            stopButton.style.opacity = '1';
            stopButton.textContent = 'ã‚¹ãƒˆãƒƒãƒ—ï¼';
            
            const numbers = [2, 3, 4, 5, 6, 7, 8, 9];
            let index = 0;
            
            rouletteInterval = setInterval(() => {
                document.getElementById('rouletteWheel').textContent = numbers[index];
                index = (index + 1) % numbers.length;
            }, 100);
        }

        // ãƒ«ãƒ¼ãƒ¬ãƒƒãƒˆåœæ­¢
        function stopRoulette() {
            clearInterval(rouletteInterval);
            rouletteInterval = null;
            multipleNumber = parseInt(document.getElementById('rouletteWheel').textContent);
            
            // ãƒ«ãƒ¼ãƒ¬ãƒƒãƒˆã®çµæœã‚’2ç§’é–“è¡¨ç¤ºã—ã¦ã‹ã‚‰æ¬¡ã®ç”»é¢ã¸
            const wheel = document.getElementById('rouletteWheel');
            wheel.style.animation = 'none';
            wheel.style.background = 'linear-gradient(45deg, #4ecdc4, #44a08d)';
            wheel.style.transform = 'scale(1.1)';
            
            // ã‚¹ãƒˆãƒƒãƒ—ãƒœã‚¿ãƒ³ã‚’ç„¡åŠ¹åŒ–
            const stopButton = document.querySelector('#roulette .game-button');
            stopButton.disabled = true;
            stopButton.style.opacity = '0.5';
            stopButton.textContent = 'æ±ºå®šä¸­...';
            
            setTimeout(() => {
                document.getElementById('roulette').style.display = 'none';
                showMultipleConfirm();
            }, 2000);
        }

        // å€æ•°ç¢ºèªç”»é¢è¡¨ç¤º
        function showMultipleConfirm() {
            document.getElementById('multipleNumber').textContent = multipleNumber;
            document.getElementById('multipleNumberRule').textContent = multipleNumber;
            document.getElementById('multipleNumberRule2').textContent = multipleNumber;
            document.getElementById('multipleConfirm').style.display = 'block';
        }

        // å€æ•°ã‚²ãƒ¼ãƒ é–‹å§‹
        function startMultipleGame() {
            document.getElementById('multipleConfirm').style.display = 'none';
            showGameScreen('multiple');
        }

        // ãƒ«ãƒ¼ãƒ¬ãƒƒãƒˆã«æˆ»ã‚‹
        function backToRoulette() {
            document.getElementById('multipleConfirm').style.display = 'none';
            showRoulette();
        }

        // ã‚²ãƒ¼ãƒ ç”»é¢è¡¨ç¤º
        function showGameScreen(gameType) {
            const gameScreen = document.getElementById(gameType + 'Game');
            gameScreen.style.display = 'block';
            
            // ãƒã‚¤ã‚¹ã‚³ã‚¢è¡¨ç¤º
            document.getElementById(gameType + 'High').textContent = getHighScore(gameType);
            
            if (gameType === 'multiple') {
                document.getElementById('multipleRule').textContent = multipleNumber + 'ã®å€æ•°';
                document.getElementById('multipleInstructions').textContent = 
                    multipleNumber + 'ã®å€æ•°ãªã‚‰ Enter ã‚­ãƒ¼ã€é•ã†ãªã‚‰ Space ã‚­ãƒ¼ã‚’æŠ¼ãã†ï¼';
                document.getElementById('multipleYesText').textContent = multipleNumber;
                document.getElementById('multipleNoText').textContent = multipleNumber;
            }
            
            resetGame(gameType);
            startGameTimer(gameType);
            createShootingStar(gameType);
        }

        // ã‚²ãƒ¼ãƒ ãƒªã‚»ãƒƒãƒˆ
        function resetGame(gameType) {
            score = 0;
            timeLeft = gameType === 'lcm' ? 60 : 20;
            gameActive = true;
            document.getElementById(gameType + 'Score').textContent = score;
            document.getElementById(gameType + 'Timer').textContent = timeLeft;
            
            if (gameType === 'lcm') {
                document.getElementById('lcmInput').value = '';
                // å…¥åŠ›ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã«ãƒ•ã‚©ãƒ¼ã‚«ã‚¹
                setTimeout(() => {
                    document.getElementById('lcmInput').focus();
                }, 100);
            }
        }

        // ã‚¿ã‚¤ãƒãƒ¼é–‹å§‹
        function startGameTimer(gameType) {
            if (gameTimer) { clearInterval(gameTimer); gameTimer = null; }
            gameTimer = setInterval(() => {
                timeLeft--;
                document.getElementById(gameType + 'Timer').textContent = timeLeft;
                
                if (timeLeft <= 0) {
                    endGame(gameType);
                }
            }, 1000);
        }

        // æµã‚Œæ˜Ÿä½œæˆ
        function createShootingStar(gameType) {
            if (!gameActive) return;
            
            if (gameType === 'lcm') {
                // æœ€å°å…¬å€æ•°ã‚²ãƒ¼ãƒ ã¯å·¦å³ã‹ã‚‰
                createLCMStars();
            } else {
                // å³ã‹ã‚‰å·¦ã¸
                const star = document.createElement('div');
                star.className = 'shooting-star';
                const raw = Math.floor(Math.random() * 51);
                const number = (gameType === 'multiple' ? Math.max(1, raw) : raw);
                star.textContent = number;
                star.dataset.number = number;
                
                // ãƒœã‚¿ãƒ³ã‚¨ãƒªã‚¢ã‚’é¿ã‘ã¦æ˜Ÿã‚’é…ç½®ï¼ˆä¸Šéƒ¨100pxï½ä¸‹éƒ¨250pxã®é–“ï¼‰
                const minTop = 100;
                const maxTop = Math.max(minTop + 150, window.innerHeight - 250);
                star.style.top = (Math.random() * (maxTop - minTop) + minTop) + 'px';
                
                document.getElementById(gameType + 'Game').appendChild(star);
                currentStar = star;
                
                setTimeout(() => {
                    if (star.parentNode && gameActive) {
                        // æ™‚é–“åˆ‡ã‚Œã§ã‚²ãƒ¼ãƒ ã‚ªãƒ¼ãƒãƒ¼
                        endGame(gameType);
                    }
                }, 4000);
            }
        }

        // æœ€å°å…¬å€æ•°ç”¨ã®æ˜Ÿä½œæˆ
        function createLCMStars() {
            function safeTop() {
                const min = 120;
                const max = Math.max(min + 120, window.innerHeight - 400);
                return (Math.random() * (max - min) + min) + 'px';
            }
            
            // 2ï½10ã®ç¯„å›²ã§ç•°ãªã‚‹2ã¤ã®æ•°å­—ã‚’ç”Ÿæˆ
            const numbers = [2, 3, 4, 5, 6, 7, 8, 9, 10];
            const shuffled = numbers.sort(() => Math.random() - 0.5);
            const numberRight = shuffled[0];
            const numberLeft = shuffled[1];
            
            // å³ã‹ã‚‰ã®æ˜Ÿï¼ˆ2ï½10ã®ç¯„å›²ï¼‰
            const starRight = document.createElement('div');
            starRight.className = 'shooting-star shooting-star-lcm';
            starRight.textContent = numberRight;
            starRight.dataset.number = numberRight;
            starRight.style.top = safeTop();
            starRight.style.animationDuration = '14s';
            
            // å·¦ã‹ã‚‰ã®æ˜Ÿï¼ˆ2ï½10ã®ç¯„å›²ã€å³ã¨ç•°ãªã‚‹æ•°å­—ï¼‰
            const starLeft = document.createElement('div');
            starLeft.className = 'shooting-star shooting-star-lcm-left';
            starLeft.textContent = numberLeft;
            starLeft.dataset.number = numberLeft;
            starLeft.style.top = safeTop();
            starLeft.style.animationDuration = '14s';
            
            document.getElementById('lcmGame').appendChild(starRight);
            document.getElementById('lcmGame').appendChild(starLeft);
            
            currentStar = starRight;
            currentStarLeft = starLeft;
            
            setTimeout(() => {
                if ((starRight.parentNode || starLeft.parentNode) && gameActive) {
                    endGame('lcm');
                }
            }, 14000);
        }

        // æœ€å°å…¬å€æ•°è¨ˆç®—
        function gcd(a, b) {
            while (b !== 0) {
                let temp = b;
                b = a % b;
                a = temp;
            }
            return a;
        }

        function lcm(a, b) {
            return (a * b) / gcd(a, b);
        }

        // çˆ†ç™ºã‚¨ãƒ•ã‚§ã‚¯ãƒˆ
        function createExplosion(x, y, gameType) {
            const explosion = document.createElement('div');
            explosion.className = 'explosion';
            explosion.innerHTML = 'ğŸ’¥';
            explosion.style.left = x + 'px';
            explosion.style.top = y + 'px';
            
            document.getElementById(gameType + 'Game').appendChild(explosion);
            
            setTimeout(() => {
                explosion.remove();
            }, 500);
        }

        // å¶æ•°å¥‡æ•°åˆ¤å®š
        function checkEvenOdd(isEven) {
            if (!gameActive || !currentStar || currentGame !== 'evenOdd') return;
            
            const number = parseInt(currentStar.dataset.number);
            const numberIsEven = number % 2 === 0;
            
            if ((isEven && numberIsEven) || (!isEven && !numberIsEven)) {
                correctAnswer('evenOdd');
            } else {
                endGame('evenOdd');
            }
        }

        // å€æ•°åˆ¤å®š
        function checkMultiple(isMultiple) {
            if (!gameActive || !currentStar || currentGame !== 'multiple') return;
            
            const number = parseInt(currentStar.dataset.number);
            const numberIsMultiple = number % multipleNumber === 0;
            
            if ((isMultiple && numberIsMultiple) || (!isMultiple && !numberIsMultiple)) {
                correctAnswer('multiple');
            } else {
                endGame('multiple');
            }
        }

        // æ­£è§£å‡¦ç†
        function correctAnswer(gameType) {
            score++;
            document.getElementById(gameType + 'Score').textContent = score;
            
            // çˆ†ç™ºã‚¨ãƒ•ã‚§ã‚¯ãƒˆ
            if (currentStar) {
                const rect = currentStar.getBoundingClientRect();
                createExplosion(rect.left + rect.width/2, rect.top + rect.height/2, gameType);
                currentStar.remove();
                currentStar = null;
            }
            
            if (currentStarLeft) {
                const rect = currentStarLeft.getBoundingClientRect();
                createExplosion(rect.left + rect.width/2, rect.top + rect.height/2, gameType);
                currentStarLeft.remove();
                currentStarLeft = null;
            }
            
            // æ¬¡ã®æ˜Ÿ
            setTimeout(() => {
                createShootingStar(gameType);
                if (gameType === 'lcm') {
                    const inp = document.getElementById('lcmInput');
                    if (inp) inp.focus();
                }
            }, 200);
        }

        // æœ€å°å…¬å€æ•°é€ä¿¡
        function submitLCM() {
            if (!gameActive || !currentStar || !currentStarLeft) return;
            
            const input = document.getElementById('lcmInput');
            const userAnswer = parseInt(input.value);
            if (Number.isNaN(userAnswer)) {
                input.focus();
                return;
            }
            const num1 = parseInt(currentStar.dataset.number);
            const num2 = parseInt(currentStarLeft.dataset.number);
            const correctLCM = lcm(num1, num2);
            
            if (userAnswer === correctLCM) {
                input.value = '';
                correctAnswer('lcm');
            } else {
                endGame('lcm');
            }
        }

        // LCMã‚¹ã‚­ãƒƒãƒ—æ©Ÿèƒ½
        function skipLCM() {
            if (!gameActive) return;
            if (currentStar) { 
                currentStar.remove(); 
                currentStar = null; 
            }
            if (currentStarLeft) { 
                currentStarLeft.remove(); 
                currentStarLeft = null; 
            }
            timeLeft = Math.max(0, timeLeft - 3);
            document.getElementById('lcmTimer').textContent = timeLeft;
            document.getElementById('lcmInput').value = '';
            setTimeout(() => {
                createShootingStar('lcm');
            }, 200);
        }

        // ã‚²ãƒ¼ãƒ çµ‚äº†
        function endGame(gameType) {
            gameActive = false;
            clearInterval(gameTimer);
            gameTimer = null;
            
            // æ®‹ã£ãŸæ˜Ÿã‚’å‰Šé™¤
            const stars = document.querySelectorAll('.shooting-star');
            stars.forEach(star => star.remove());
            
            // ãƒã‚¤ã‚¹ã‚³ã‚¢æ›´æ–°ãƒã‚§ãƒƒã‚¯
            const isNewHigh = saveHighScore(gameType, score);
            
            document.getElementById('gameOverTitle').textContent = 
                timeLeft <= 0 ? 'ã‚¿ã‚¤ãƒ ã‚¢ãƒƒãƒ—ï¼' : 'ã‚²ãƒ¼ãƒ ã‚ªãƒ¼ãƒãƒ¼ï¼';
            document.getElementById('gameOverText').textContent = `ã‚¹ã‚³ã‚¢: ${score}`;
            document.getElementById('gameOverHigh').textContent = 
                isNewHigh ? 'ğŸ‰ æ–°è¨˜éŒ²é”æˆï¼ ğŸ‰' : `ãƒã‚¤ã‚¹ã‚³ã‚¢: ${getHighScore(gameType)}`;
            
            document.getElementById('gameOver').style.display = 'block';
        }

        // ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã«æˆ»ã‚‹
        function backToMenu() {
            gameActive = false;
            clearInterval(gameTimer);
            gameTimer = null;
            clearInterval(rouletteInterval);
            rouletteInterval = null;
            
            // å…¨ã¦ã®ç”»é¢ã‚’éè¡¨ç¤º
            document.querySelectorAll('.game-screen').forEach(screen => {
                screen.style.display = 'none';
            });
            document.getElementById('roulette').style.display = 'none';
            document.getElementById('gameOver').style.display = 'none';
            document.getElementById('ruleScreen').style.display = 'none';
            document.getElementById('multipleConfirm').style.display = 'none';
            
            // æ®‹ã£ãŸæ˜Ÿã‚’å‰Šé™¤
            document.querySelectorAll('.shooting-star').forEach(star => star.remove());
            
            // ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã®ãƒã‚¤ã‚¹ã‚³ã‚¢ã‚’æ›´æ–°
            updateMenuHighScores();
            
            document.getElementById('menu').style.display = 'flex';
            currentGame = null;
            currentStar = null;
            currentStarLeft = null;
        }

        // ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã®ãƒã‚¤ã‚¹ã‚³ã‚¢æ›´æ–°
        function updateMenuHighScores() {
            document.getElementById('evenOddMenuHigh').textContent = getHighScore('evenOdd');
            document.getElementById('multipleMenuHigh').textContent = getHighScore('multiple');
            document.getElementById('lcmMenuHigh').textContent = getHighScore('lcm');
        }

        // ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ã‚¤ãƒ™ãƒ³ãƒˆ
        document.addEventListener('keydown', (e) => {
            // ãƒ«ãƒ¼ãƒ¬ãƒƒãƒˆç”»é¢ã§ã®ã‚­ãƒ¼æ“ä½œ
            if (document.getElementById('roulette').style.display === 'block') {
                if (e.code === 'Enter' || e.code === 'Space') {
                    e.preventDefault();
                    stopRoulette();
                }
                return;
            }
            
            // å€æ•°ç¢ºèªç”»é¢ã§ã®ã‚­ãƒ¼æ“ä½œ
            if (document.getElementById('multipleConfirm').style.display === 'block') {
                if (e.code === 'Enter') {
                    e.preventDefault();
                    startMultipleGame();
                } else if (e.code === 'Space') {
                    e.preventDefault();
                    backToRoulette();
                }
                return;
            }
            
            // ãƒ«ãƒ¼ãƒ«ç”»é¢ã§ã®ã‚­ãƒ¼æ“ä½œ
            if (document.getElementById('ruleScreen').style.display === 'block') {
                if (e.code === 'Enter') {
                    e.preventDefault();
                    startActualGame();
                } else if (e.code === 'Space') {
                    e.preventDefault();
                    backToMenu();
                }
                return;
            }
            
            // ã‚²ãƒ¼ãƒ ã‚ªãƒ¼ãƒãƒ¼ç”»é¢ã§ã®ã‚­ãƒ¼æ“ä½œ
            if (document.getElementById('gameOver').style.display === 'block') {
                if (e.code === 'Enter' || e.code === 'Space') {
                    e.preventDefault();
                    backToMenu();
                }
                return;
            }
            
            // ã‚²ãƒ¼ãƒ ä¸­ã®ã‚­ãƒ¼æ“ä½œ
            if (!gameActive) return;
            
            if (currentGame === 'evenOdd' && currentStar) {
                const number = parseInt(currentStar.dataset.number);
                const isEven = number % 2 === 0;
                
                if ((e.code === 'Enter' && isEven) || (e.code === 'Space' && !isEven)) {
                    correctAnswer('evenOdd');
                } else if (e.code === 'Enter' || e.code === 'Space') {
                    endGame('evenOdd');
                }
            }
            
            if (currentGame === 'multiple' && currentStar) {
                const number = parseInt(currentStar.dataset.number);
                const isMultiple = number % multipleNumber === 0;
                
                if ((e.code === 'Enter' && isMultiple) || (e.code === 'Space' && !isMultiple)) {
                    correctAnswer('multiple');
                } else if (e.code === 'Enter' || e.code === 'Space') {
                    endGame('multiple');
                }
            }
            
            if (currentGame === 'lcm' && e.code === 'Enter') {
                e.preventDefault();
                submitLCM();
            }
            
            if (currentGame === 'lcm' && e.code === 'KeyS') {
                e.preventDefault();
                skipLCM();
            }
        });

        // ãƒ†ãƒ³ã‚­ãƒ¼æ©Ÿèƒ½
        function addNumber(num) {
            const input = document.getElementById('lcmInput');
            input.value += num;
            input.focus();
        }

        function clearInput() {
            const input = document.getElementById('lcmInput');
            input.value = '';
            input.focus();
        }

        // åˆæœŸåŒ–
        createBackgroundStars();
        updateMenuHighScores();
        
        // ã‚¢ã‚¯ã‚»ã‚·ãƒ“ãƒªãƒ†ã‚£å¯¾å¿œ
        document.querySelectorAll('.timer-display, .score-display')
            .forEach(el => el.setAttribute('aria-live', 'polite'));

        // ã‚¿ãƒ–ã‚’é›¢ã‚ŒãŸã‚‰è‡ªå‹•ä¸€æ™‚åœæ­¢
        let pausedByHide = false;
        document.addEventListener('visibilitychange', () => {
            if (document.hidden) {
                pausedByHide = gameActive;
                gameActive = false;
                clearInterval(gameTimer);
                gameTimer = null;
            } else if (currentGame && !gameTimer && pausedByHide) {
                startGameTimer(currentGame);
                gameActive = true;
                pausedByHide = false;
            }
        });
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'975e94d5b7b49aae',t:'MTc1NjMyOTI5Ni4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
