<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <title>åˆ†æ•°ãƒãƒˆãƒ«ï¼</title>
    <link href="https://fonts.googleapis.com/css2?family=BIZ+UDGothic:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --safe-top: env(safe-area-inset-top);
            --safe-right: env(safe-area-inset-right);
            --safe-bottom: env(safe-area-inset-bottom);
            --safe-left: env(safe-area-inset-left);
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        html, body {
            height: 100svh;
        }
        
        body {
            font-family: 'BIZ UDGothic', 'Hiragino Sans', 'Yu Gothic', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            overflow-x: hidden;
            padding: max(8px, var(--safe-top)) max(8px, var(--safe-right)) max(8px, var(--safe-bottom)) max(8px, var(--safe-left));
            touch-action: manipulation;
        }
        
        .container {
            width: min(1200px, 100%);
            padding: 20px;
        }
        
        .screen {
            display: none;
            background: white;
            border-radius: 20px;
            padding: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            text-align: center;
            min-height: 600px;
        }
        
        .screen.active {
            display: block;
        }
        
        .title {
            font-size: 3.5rem;
            color: #4a5568;
            margin-bottom: 30px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
        }
        
        .subtitle {
            font-size: 1.5rem;
            color: #718096;
            margin-bottom: 40px;
        }
        
        .mode-buttons {
            display: flex;
            gap: 30px;
            justify-content: center;
            margin: 40px 0;
            flex-wrap: wrap;
        }
        
        .mode-btn {
            background: linear-gradient(135deg, #ff6b6b, #ee5a24);
            color: white;
            border: none;
            padding: 25px 40px;
            font-size: 1.8rem;
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 8px 15px rgba(0,0,0,0.1);
            min-width: 200px;
        }
        
        .mode-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 12px 25px rgba(0,0,0,0.2);
        }
        
        .mode-btn.two-player {
            background: linear-gradient(135deg, #4ecdc4, #44a08d);
        }
        
        .game-area {
            display: flex;
            justify-content: center;
            align-items: center;
            margin: 40px 0;
            gap: 30px;
        }
        
        .fraction-card {
            background: linear-gradient(135deg, #ffecd2, #fcb69f);
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
            min-width: 200px;
            transform: scale(1);
            transition: all 0.3s ease;
        }
        
        .fraction-card:hover {
            transform: scale(1.05);
        }
        
        .fraction {
            font-size: 4rem;
            color: #2d3748;
            font-weight: bold;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        
        .numerator {
            border-bottom: 4px solid #2d3748;
            padding-bottom: 10px;
            margin-bottom: 10px;
            min-width: 80px;
        }
        
        .denominator {
            min-width: 80px;
        }
        
        .vs {
            font-size: 3rem;
            color: #e53e3e;
            font-weight: bold;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
        }
        
        .answer-buttons {
            display: flex;
            gap: 20px;
            justify-content: center;
            margin: 40px 0;
            flex-wrap: wrap;
        }
        
        .answer-btn {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 50px 35px;
            font-size: 1.5rem;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 6px 12px rgba(0,0,0,0.1);
            min-width: 120px;
            min-height: 80px;
        }
        
        .answer-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 16px rgba(0,0,0,0.2);
        }
        
        .answer-btn.left {
            background: linear-gradient(135deg, #ff9a9e, #fecfef);
            color: #2d3748;
        }
        
        .answer-btn.right {
            background: linear-gradient(135deg, #a8edea, #fed6e3);
            color: #2d3748;
        }
        
        .answer-btn.equal {
            background: linear-gradient(135deg, #ffecd2, #fcb69f);
            color: #2d3748;
        }
        
        .score-area {
            display: flex;
            justify-content: space-around;
            margin: 15px 0;
            flex-wrap: wrap;
            gap: 15px;
        }
        
        .score-card {
            background: linear-gradient(135deg, #a8edea, #fed6e3);
            padding: 8px 15px;
            border-radius: 15px;
            box-shadow: 0 5px 10px rgba(0,0,0,0.1);
            min-width: 120px;
        }
        
        .score-label {
            font-size: 1rem;
            color: #4a5568;
            margin-bottom: 5px;
        }
        
        .score-value {
            font-size: 1.5rem;
            font-weight: bold;
            color: #2d3748;
        }
        
        .back-btn {
            background: linear-gradient(135deg, #cbd5e0, #a0aec0);
            color: #2d3748;
            border: none;
            padding: 15px 25px;
            font-size: 1.2rem;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 20px;
        }
        
        .back-btn:hover {
            transform: translateY(-2px);
        }
        
        .result-message {
            font-size: 2rem;
            margin: 20px 0;
            padding: 20px;
            border-radius: 15px;
            font-weight: bold;
        }
        
        .correct {
            background: linear-gradient(135deg, #68d391, #38b2ac);
            color: white;
        }
        
        .incorrect {
            background: linear-gradient(135deg, #fc8181, #e53e3e);
            color: white;
        }
        
        .rules {
            text-align: left;
            background: #f7fafc;
            padding: 30px;
            border-radius: 15px;
            margin: 30px 0;
            font-size: 1.2rem;
            line-height: 1.6;
        }
        
        .rules h3 {
            color: #2d3748;
            margin-bottom: 15px;
            font-size: 1.5rem;
        }
        
        .rules ul {
            margin-left: 20px;
        }
        
        .rules li {
            margin-bottom: 10px;
            color: #4a5568;
        }
        
        /* 2äººãƒ¢ãƒ¼ãƒ‰è¨­å®šç”»é¢ */
        .score-selection {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin: 30px 0;
            flex-wrap: wrap;
        }
        
        .score-btn {
            background: linear-gradient(135deg, #e2e8f0, #cbd5e0);
            color: #4a5568;
            border: none;
            padding: 15px 25px;
            font-size: 1.3rem;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        
        .score-btn.selected {
            background: linear-gradient(135deg, #4ecdc4, #44a08d);
            color: white;
            transform: scale(1.05);
        }
        
        .score-btn:hover {
            transform: translateY(-2px);
        }
        
        .player-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin: 40px 0;
            gap: 20px;
        }
        
        .player-card {
            background: linear-gradient(135deg, #ffecd2, #fcb69f);
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 8px 15px rgba(0,0,0,0.1);
            flex: 1;
            max-width: 300px;
        }
        
        .player-card h3 {
            font-size: 1.5rem;
            margin-bottom: 10px;
            color: #2d3748;
        }
        
        .player-card p {
            color: #4a5568;
            font-size: 1.1rem;
        }
        
        .player-name-input {
            background: transparent;
            border: none;
            color: #2d3748;
            font-size: 1.5rem;
            font-weight: bold;
            font-family: inherit;
            text-align: center;
            outline: none;
            border-bottom: 2px solid transparent;
            transition: all 0.3s ease;
            padding: 2px 8px;
            border-radius: 4px;
            max-width: 150px;
        }
        
        .player-name-input:focus {
            border-bottom: 2px solid #4ecdc4;
            background: rgba(255, 255, 255, 0.8);
        }
        
        .player-name-input:hover {
            background: rgba(255, 255, 255, 0.5);
        }
        
        .vs-large {
            font-size: 2.5rem;
            color: #e53e3e;
            font-weight: bold;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
        }
        
        /* 2äººãƒ¢ãƒ¼ãƒ‰ã‚²ãƒ¼ãƒ ç”»é¢ */
        .two-player-buttons {
            display: flex;
            gap: 40px;
            justify-content: space-between;
            margin: 30px 0;
        }
        
        .player-section {
            flex: 1;
            background: linear-gradient(135deg, #f7fafc, #edf2f7);
            padding: 25px;
            border-radius: 20px;
            box-shadow: 0 8px 15px rgba(0,0,0,0.1);
        }
        
        .left-section {
            border-left: 5px solid #ff6b6b;
        }
        
        .right-section {
            border-right: 5px solid #4ecdc4;
        }
        
        .player-title {
            font-size: 1.5rem;
            color: #2d3748;
            margin-bottom: 20px;
            text-align: center;
        }
        
        .player-answer-buttons {
            display: flex;
            flex-direction: row;
            gap: 15px;
            justify-content: center;
            flex-wrap: wrap;
        }
        
        .player1-btn {
            background: linear-gradient(135deg, #ff9a9e, #fecfef) !important;
            color: #2d3748 !important;
        }
        
        .player2-btn {
            background: linear-gradient(135deg, #a8edea, #fed6e3) !important;
            color: #2d3748 !important;
        }
        
        .player1-btn:hover, .player2-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 16px rgba(0,0,0,0.2);
        }
        
        .answer-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none !important;
        }
        
        /* å¤§ããªãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ */
        .big-popup {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(0);
            background: linear-gradient(135deg, #68d391, #38b2ac);
            color: white;
            padding: 30px 80px;
            border-radius: 25px;
            font-size: 2.5rem;
            font-weight: bold;
            box-shadow: 0 20px 40px rgba(0,0,0,0.3);
            z-index: 1000;
            animation: popupAnimation 1.5s ease-out;
            pointer-events: none;
            text-align: center;
            line-height: 1.2;
            min-width: 400px;
        }
        
        .big-popup.player1 {
            background: linear-gradient(135deg, #ff9a9e, #fecfef);
            color: #2d3748;
        }
        
        .big-popup.player2 {
            background: linear-gradient(135deg, #a8edea, #fed6e3);
            color: #2d3748;
        }
        
        @keyframes popupAnimation {
            0% {
                transform: translate(-50%, -50%) scale(0) rotate(-10deg);
                opacity: 0;
            }
            50% {
                transform: translate(-50%, -50%) scale(1.2) rotate(5deg);
                opacity: 1;
            }
            100% {
                transform: translate(-50%, -50%) scale(1) rotate(0deg);
                opacity: 0;
            }
        }
        
        /* iPadæ¨ªç”»é¢æœ€é©åŒ– */
        @media (min-width: 768px) and (max-width: 1024px) and (orientation: landscape) {
            .container {
                max-width: 100%;
                padding: 10px;
            }
            
            .screen {
                padding: 20px;
                min-height: auto;
                max-height: 100vh;
                overflow: hidden;
            }
            
            .title {
                font-size: 2.5rem;
                margin-bottom: 15px;
            }
            
            .subtitle {
                font-size: 1.2rem;
                margin-bottom: 20px;
            }
            
            .rules {
                padding: 15px;
                margin: 15px 0;
                font-size: 1rem;
            }
            
            .game-area {
                margin: 20px 0;
                gap: 15px;
            }
            
            .fraction-card {
                padding: 25px;
                min-width: 150px;
            }
            
            .fraction {
                font-size: 2.5rem;
            }
            
            .vs {
                font-size: 2rem;
            }
            
            .score-area {
                margin: 15px 0;
                gap: 10px;
            }
            
            .score-card {
                padding: 15px;
                min-width: 120px;
            }
            
            .answer-buttons {
                margin: 20px 0;
                gap: 15px;
            }
            
            .answer-btn {
                padding: 15px 20px;
                font-size: 1.2rem;
                min-width: 100px;
            }
            
            /* 2äººãƒ¢ãƒ¼ãƒ‰ç”¨iPadæœ€é©åŒ– */
            .two-player-buttons {
                gap: 20px;
                margin: 15px 0;
            }
            
            .player-section {
                padding: 15px;
            }
            
            .player-title {
                font-size: 1.2rem;
                margin-bottom: 15px;
            }
            
            .player-answer-buttons {
                gap: 8px;
                flex-direction: row;
            }
            
            .player-answer-buttons .answer-btn {
                padding: 10px 12px;
                font-size: 0.9rem;
                min-width: 80px;
            }
            
            .player-info {
                margin: 20px 0;
                gap: 15px;
            }
            
            .player-card {
                padding: 15px;
            }
            
            .vs-large {
                font-size: 2rem;
            }
            
            .score-selection {
                gap: 10px;
                margin: 20px 0;
            }
            
            .score-btn {
                padding: 12px 20px;
                font-size: 1.1rem;
            }
        }
        
        @media (max-width: 768px) {
            .title {
                font-size: 2.5rem;
            }
            
            .game-area {
                flex-direction: column;
                gap: 30px;
            }
            
            .fraction {
                font-size: 3rem;
            }
            
            .vs {
                font-size: 2rem;
            }
        }
        
        /* å‹•ãã«å¼±ã„å­å‘ã‘ã®ã‚¢ãƒ‹ãƒ¡è»½æ¸› */
        @media (prefers-reduced-motion: reduce) {
            .big-popup { animation: none !important; }
            .answer-btn:hover { transform: none !important; box-shadow: none !important; }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- ãƒ¡ãƒ‹ãƒ¥ãƒ¼ç”»é¢ -->
        <div id="menu-screen" class="screen active">
            <h1 class="title" id="menu-title" tabindex="-1">ğŸ¯ åˆ†æ•°ãƒãƒˆãƒ«ï¼</h1>
            <p class="subtitle">ã©ã¡ã‚‰ã®åˆ†æ•°ãŒå¤§ãã„ã‹ãªï¼Ÿ</p>
            
            <div class="rules">
                <h3>ğŸ“š ã‚²ãƒ¼ãƒ ã®ãƒ«ãƒ¼ãƒ«</h3>
                <ul>
                    <li>ç”»é¢ã«2ã¤ã®åˆ†æ•°ãŒè¡¨ç¤ºã•ã‚Œã¾ã™</li>
                    <li>ã©ã¡ã‚‰ãŒå¤§ãã„ã‹ã€ã¾ãŸã¯ç­‰ã—ã„ã‹ã‚’é¸ã‚“ã§ãã ã•ã„</li>
                    <li>æ­£è§£ã™ã‚‹ã¨1ç‚¹ã‚‚ã‚‰ãˆã¾ã™</li>
                    <li>10å•ãƒãƒ£ãƒ¬ãƒ³ã‚¸ã—ã¦é«˜å¾—ç‚¹ã‚’ç›®æŒ‡ãã†ï¼</li>
                </ul>
            </div>
            
            <div class="score-area" style="margin: 20px 0;">
                <div class="score-card">
                    <div class="score-label">ğŸ† ãƒã‚¤ã‚¹ã‚³ã‚¢</div>
                    <div class="score-value" id="high-score-display">--</div>
                </div>
            </div>
            
            <div class="mode-buttons">
                <button class="mode-btn" onclick="startGame(1)">
                    ğŸ® 1äººãƒ¢ãƒ¼ãƒ‰
                </button>
                <button class="mode-btn two-player" onclick="showTwoPlayerSetup()">
                    ğŸ‘¥ 2äººãƒ¢ãƒ¼ãƒ‰
                </button>
            </div>
        </div>
        
        <!-- 2äººãƒ¢ãƒ¼ãƒ‰è¨­å®šç”»é¢ -->
        <div id="two-player-setup" class="screen">
            <h2 class="title">ğŸ‘¥ 2äººãƒ¢ãƒ¼ãƒ‰è¨­å®š</h2>
            <p class="subtitle">ä½•ç‚¹å…ˆå–ã§å‹è² ã—ã¾ã™ã‹ï¼Ÿ</p>
            
            <div class="score-selection">
                <button class="score-btn" onclick="setTargetScore(this, 3)">3ç‚¹å…ˆå–</button>
                <button class="score-btn selected" onclick="setTargetScore(this, 5)">5ç‚¹å…ˆå–</button>
                <button class="score-btn" onclick="setTargetScore(this, 7)">7ç‚¹å…ˆå–</button>
                <button class="score-btn" onclick="setTargetScore(this, 10)">10ç‚¹å…ˆå–</button>
            </div>
            
            <div class="player-info">
                <div class="player-card left-player">
                    <h3>ğŸ‘¤ <input type="text" id="player1-name" class="player-name-input" value="ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼1" onclick="this.select()"></h3>
                    <p>å·¦å´ã®ãƒœã‚¿ãƒ³ã§è§£ç­”</p>
                </div>
                <div class="vs-large">VS</div>
                <div class="player-card right-player">
                    <h3>ğŸ‘¤ <input type="text" id="player2-name" class="player-name-input" value="ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼2" onclick="this.select()"></h3>
                    <p>å³å´ã®ãƒœã‚¿ãƒ³ã§è§£ç­”</p>
                </div>
            </div>
            
            <div class="mode-buttons">
                <button class="mode-btn" onclick="showMenu()">â† æˆ»ã‚‹</button>
                <button class="mode-btn two-player" onclick="startTwoPlayerGame()">ã‚²ãƒ¼ãƒ é–‹å§‹ï¼</button>
            </div>
        </div>

        <!-- ã‚²ãƒ¼ãƒ ç”»é¢ -->
        <div id="game-screen" class="screen">
            <button class="back-btn" onclick="showMenu()">â† ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã«æˆ»ã‚‹</button>
            
            <div class="score-area">
                <div class="score-card">
                    <div class="score-label">å•é¡Œ</div>
                    <div class="score-value" id="question-count">1 / 10</div>
                </div>
                <div class="score-card" id="timer-card" style="display: none;">
                    <div class="score-label">â±ï¸ çµŒéæ™‚é–“</div>
                    <div class="score-value" id="timer-display">0ç§’</div>
                </div>
                <div class="score-card" id="player1-score-card">
                    <div class="score-label" id="player1-label">ã‚ãªãŸã®å¾—ç‚¹</div>
                    <div class="score-value" id="player1-score">0</div>
                </div>
                <div class="score-card" id="player2-score-card" style="display: none;">
                    <div class="score-label" id="player2-label">ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼2ã®å¾—ç‚¹</div>
                    <div class="score-value" id="player2-score">0</div>
                </div>
            </div>
            
            <div class="game-area">
                <div class="fraction-card">
                    <div class="fraction">
                        <div class="numerator" id="fraction1-num">1</div>
                        <div class="denominator" id="fraction1-den">2</div>
                    </div>
                </div>
                
                <div class="vs">VS</div>
                
                <div class="fraction-card">
                    <div class="fraction">
                        <div class="numerator" id="fraction2-num">1</div>
                        <div class="denominator" id="fraction2-den">3</div>
                    </div>
                </div>
            </div>
            
            <!-- 1äººãƒ¢ãƒ¼ãƒ‰ç”¨ãƒœã‚¿ãƒ³ -->
            <div class="answer-buttons" id="single-player-buttons">
                <button class="answer-btn left" onclick="checkAnswer('left')">
                    â† å·¦ãŒå¤§ãã„
                </button>
                <button class="answer-btn equal" onclick="checkAnswer('equal')">
                    = ç­‰ã—ã„
                </button>
                <button class="answer-btn right" onclick="checkAnswer('right')">
                    å³ãŒå¤§ãã„ â†’
                </button>
            </div>

            <!-- 2äººãƒ¢ãƒ¼ãƒ‰ç”¨ãƒœã‚¿ãƒ³ -->
            <div class="two-player-buttons" id="two-player-buttons" style="display: none;">
                <div class="player-section left-section">
                    <h3 class="player-title" id="game-player1-title">ğŸ‘¤ ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼1</h3>
                    <div class="player-answer-buttons">
                        <button class="answer-btn left player1-btn" onclick="checkAnswerTwoPlayer(1, 'left')">
                            â† å·¦ãŒå¤§ãã„
                        </button>
                        <button class="answer-btn equal player1-btn" onclick="checkAnswerTwoPlayer(1, 'equal')">
                            = ç­‰ã—ã„
                        </button>
                        <button class="answer-btn right player1-btn" onclick="checkAnswerTwoPlayer(1, 'right')">
                            å³ãŒå¤§ãã„ â†’
                        </button>
                    </div>
                </div>
                
                <div class="player-section right-section">
                    <h3 class="player-title" id="game-player2-title">ğŸ‘¤ ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼2</h3>
                    <div class="player-answer-buttons">
                        <button class="answer-btn left player2-btn" onclick="checkAnswerTwoPlayer(2, 'left')">
                            â† å·¦ãŒå¤§ãã„
                        </button>
                        <button class="answer-btn equal player2-btn" onclick="checkAnswerTwoPlayer(2, 'equal')">
                            = ç­‰ã—ã„
                        </button>
                        <button class="answer-btn right player2-btn" onclick="checkAnswerTwoPlayer(2, 'right')">
                            å³ãŒå¤§ãã„ â†’
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- 2äººæˆ¦ç”¨ãƒ‘ã‚¹ãƒœã‚¿ãƒ³ -->
            <div id="pass-button-area" style="display: none; text-align: center; margin: 20px 0;">
                <button class="back-btn" onclick="skipToNextQuestion()" style="background: linear-gradient(135deg, #ffecd2, #fcb69f); color: #2d3748;">
                    â­ï¸ æ¬¡ã®å•é¡Œã¸
                </button>
            </div>
            
            <div id="result-message" class="result-message" style="display: none;" aria-live="polite"></div>
            
            <!-- å¤§ããªãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ç”¨ -->
            <div id="big-popup" class="big-popup" style="display: none;"></div>
        </div>
        
        <!-- ä¸æ­£è§£å•é¡Œå¾©ç¿’ç”»é¢ -->
        <div id="review-screen" class="screen">
            <h2 class="title">ğŸ“š ä¸æ­£è§£å•é¡Œã®å¾©ç¿’</h2>
            <p class="subtitle">é–“é•ãˆãŸå•é¡Œã‚’ã‚‚ã†ä¸€åº¦ãƒãƒ£ãƒ¬ãƒ³ã‚¸ã—ã‚ˆã†ï¼</p>
            
            <div class="mode-buttons">
                <button class="mode-btn" onclick="startReview()">
                    ğŸ”„ å¾©ç¿’é–‹å§‹
                </button>
                <button class="mode-btn two-player" onclick="skipReview()">
                    â­ï¸ ã‚¹ã‚­ãƒƒãƒ—ã—ã¦çµæœã¸
                </button>
            </div>
        </div>
        
        <!-- çµæœç”»é¢ -->
        <div id="result-screen" class="screen">
            <h2 class="title">ğŸ‰ ã‚²ãƒ¼ãƒ çµ‚äº†ï¼</h2>
            
            <div class="score-area">
                <div class="score-card">
                    <div class="score-label" id="final-player1-label">ã‚ãªãŸã®æœ€çµ‚å¾—ç‚¹</div>
                    <div class="score-value" id="final-player1-score">0</div>
                </div>
                <div class="score-card" id="final-timer-card" style="display: none;">
                    <div class="score-label">â±ï¸ ã‚¯ãƒªã‚¢æ™‚é–“</div>
                    <div class="score-value" id="final-timer">0ç§’</div>
                </div>
                <div class="score-card" id="final-player2-card" style="display: none;">
                    <div class="score-label" id="final-player2-label">ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼2ã®æœ€çµ‚å¾—ç‚¹</div>
                    <div class="score-value" id="final-player2-score">0</div>
                </div>
            </div>
            
            <div id="winner-message" class="result-message"></div>
            
            <div class="mode-buttons">
                <button class="mode-btn" onclick="showMenu()">
                    ğŸ  ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã«æˆ»ã‚‹
                </button>
                <button class="mode-btn two-player" onclick="restartGame()">
                    ğŸ”„ ã‚‚ã†ä¸€åº¦ãƒ—ãƒ¬ã‚¤
                </button>
            </div>
        </div>
    </div>

    <script>
        let gameMode = 1; // 1äººãƒ¢ãƒ¼ãƒ‰ã¾ãŸã¯2äººãƒ¢ãƒ¼ãƒ‰
        let currentPlayer = 1; // ç¾åœ¨ã®ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ï¼ˆ2äººãƒ¢ãƒ¼ãƒ‰ã§ä½¿ç”¨ï¼‰
        let questionCount = 0;
        let maxQuestions = 10;
        let player1Score = 0;
        let player2Score = 0;
        let currentFraction1 = { num: 1, den: 2 };
        let currentFraction2 = { num: 1, den: 3 };
        let startTime = 0;
        let gameTime = 0;
        let timerInterval = null;
        let incorrectQuestions = []; // ä¸æ­£è§£ã ã£ãŸå•é¡Œã‚’ä¿å­˜
        let highScore = parseFloat(localStorage.getItem('fractionGameHighScore')) || 999.99;
        let isReviewMode = false; // å¾©ç¿’ãƒ¢ãƒ¼ãƒ‰ã‹ã©ã†ã‹
        let reviewIndex = 0; // å¾©ç¿’ä¸­ã®å•é¡Œã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹
        let targetScore = 5; // 2äººãƒ¢ãƒ¼ãƒ‰ã®ç›®æ¨™ç‚¹æ•°
        let buttonsDisabled = false; // æ—©æŠ¼ã—åˆ¶å¾¡ç”¨
        let player1Eliminated = false; // ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼1ãŒä¸æ­£è§£ã§é™¤å¤–ã•ã‚ŒãŸã‹
        let player2Eliminated = false; // ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼2ãŒä¸æ­£è§£ã§é™¤å¤–ã•ã‚ŒãŸã‹
        
        const EQUAL_PROB = 0.18; // ç­‰å·ã®å‡ºé¡Œç‡
        
        // ç›´è¿‘ã®å‡ºé¡Œãƒšã‚¢ã‚’è»½ãå»é‡ï¼ˆè¢«ã‚Šæ„Ÿã‚’æ¸›ã‚‰ã™ï¼‰
        const recentPairs = [];
        function pairKey(a,b){ return `${a.num}/${a.den}|${b.num}/${b.den}`; }
        function isRecent(a,b){
            const k1 = pairKey(a,b), k2 = pairKey(b,a);
            return recentPairs.includes(k1) || recentPairs.includes(k2);
        }
        function rememberPair(a,b){
            const k = pairKey(a,b);
            recentPairs.push(k);
            if (recentPairs.length > 8) recentPairs.shift(); // ç›´è¿‘8å•ã ã‘è¨˜æ†¶
        }
        
        // åˆ†æ•°æ¯”è¼ƒé–¢æ•°ï¼ˆäº¤å·®ç©ä½¿ç”¨ï¼‰
        function cmp(fr1, fr2){
            const L = fr1.num * fr2.den;
            const R = fr2.num * fr1.den;
            return L === R ? 0 : (L > R ? 1 : -1); // 1:left, 0:equal, -1:right
        }
        
        function fractionsAreIdentical(a, b){
            return a.num === b.num && a.den === b.den;
        }
        
        function fractionsAreEquivalent(a, b){
            return a.num * b.den === b.num * a.den;
        }
        
        function showMenu() {
            document.getElementById('menu-screen').classList.add('active');
            document.getElementById('game-screen').classList.remove('active');
            document.getElementById('result-screen').classList.remove('active');
            document.getElementById('review-screen').classList.remove('active');
            document.getElementById('two-player-setup').classList.remove('active');
            
            // ãƒã‚¤ã‚¹ã‚³ã‚¢è¡¨ç¤ºæ›´æ–°
            const highScoreDisplay = document.getElementById('high-score-display');
            if (highScore < 999) {
                highScoreDisplay.textContent = highScore.toFixed(2) + 'ç§’';
            } else {
                highScoreDisplay.textContent = '--';
            }
            
            // ãƒ•ã‚©ãƒ¼ã‚«ã‚¹ç§»å‹•
            document.getElementById('menu-title')?.focus();
        }
        
        function showTwoPlayerSetup() {
            document.getElementById('menu-screen').classList.remove('active');
            document.getElementById('two-player-setup').classList.add('active');
        }
        
        function setTargetScore(el, score) {
            targetScore = score;
            document.querySelectorAll('.score-btn').forEach(btn => btn.classList.remove('selected'));
            el.classList.add('selected');
        }
        
        function startTwoPlayerGame() {
            gameMode = 2;
            maxQuestions = 999; // 2äººãƒ¢ãƒ¼ãƒ‰ã¯ç„¡åˆ¶é™
            startGame(2);
        }
        
        function startGame(mode) {
            gameMode = mode;
            currentPlayer = 1;
            questionCount = 0;
            player1Score = 0;
            player2Score = 0;
            incorrectQuestions = []; // ä¸æ­£è§£å•é¡Œãƒªã‚»ãƒƒãƒˆ
            
            // ã‚¿ã‚¤ãƒãƒ¼åˆæœŸåŒ–
            if (timerInterval) {
                clearInterval(timerInterval);
            }
            startTime = Date.now();
            gameTime = 0;
            
            // UIæ›´æ–°
            document.getElementById('menu-screen').classList.remove('active');
            document.getElementById('two-player-setup').classList.remove('active');
            document.getElementById('game-screen').classList.add('active');
            document.getElementById('result-screen').classList.remove('active');
            
            if (mode === 2) {
                document.getElementById('player2-score-card').style.display = 'block';
                const player1Name = document.getElementById('player1-name').value || 'ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼1';
                const player2Name = document.getElementById('player2-name').value || 'ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼2';
                document.getElementById('player1-label').textContent = player1Name + 'ã®å¾—ç‚¹';
                document.getElementById('player2-label').textContent = player2Name + 'ã®å¾—ç‚¹';
                document.getElementById('game-player1-title').textContent = 'ğŸ‘¤ ' + player1Name;
                document.getElementById('game-player2-title').textContent = 'ğŸ‘¤ ' + player2Name;
                document.getElementById('timer-card').style.display = 'none';
                document.getElementById('single-player-buttons').style.display = 'none';
                document.getElementById('two-player-buttons').style.display = 'flex';
                document.getElementById('pass-button-area').style.display = 'block';
                document.getElementById('question-count').textContent = `${targetScore}ç‚¹å…ˆå–`;
            } else {
                document.getElementById('player2-score-card').style.display = 'none';
                document.getElementById('player1-label').textContent = 'ã‚ãªãŸã®å¾—ç‚¹';
                document.getElementById('timer-card').style.display = 'block';
                document.getElementById('single-player-buttons').style.display = 'flex';
                document.getElementById('two-player-buttons').style.display = 'none';
                document.getElementById('pass-button-area').style.display = 'none';
                startTimer();
            }
            
            updateScores();
            generateQuestion();
        }
        
        function startTimer() {
            if (timerInterval) clearInterval(timerInterval);
            timerInterval = setInterval(() => {
                gameTime = (Date.now() - startTime) / 1000;
                document.getElementById('timer-display').textContent = gameTime.toFixed(2) + 'ç§’';
            }, 100);
        }
        
        function generateQuestion() {
            if (gameMode === 1 && !isReviewMode) {
                questionCount++;
            }
            
            // ç­‰ã—ã„å•é¡Œã‹ç­‰ã—ããªã„å•é¡Œã‹ã‚’ç¢ºç‡ã§æ±ºå®šï¼ˆæ–¹é‡ã‚’æœ€åˆã«å›ºå®šï¼‰
            const wantEqual = Math.random() < EQUAL_PROB;
            let pair = wantEqual ? generateEqualPair() : generateNonEqualPair();
            
            // ç›´è¿‘ã®å‡ºé¡Œãƒšã‚¢ã¨é‡è¤‡ã—ãªã„ã‚ˆã†è»½ãèª¿æ•´ï¼ˆæ–¹é‡ã‚’ç¶­æŒï¼‰
            let tries = 0;
            while (isRecent(pair[0], pair[1]) && tries < 10) {
                pair = wantEqual ? generateEqualPair() : generateNonEqualPair();
                tries++;
            }
            currentFraction1 = pair[0];
            currentFraction2 = pair[1];
            rememberPair(currentFraction1, currentFraction2);
            
            // UIæ›´æ–°
            document.getElementById('fraction1-num').textContent = currentFraction1.num;
            document.getElementById('fraction1-den').textContent = currentFraction1.den;
            document.getElementById('fraction2-num').textContent = currentFraction2.num;
            document.getElementById('fraction2-den').textContent = currentFraction2.den;
            
            if (gameMode === 1) {
                document.getElementById('question-count').textContent = `${questionCount} / ${maxQuestions}`;
            } else {
                document.getElementById('question-count').textContent = `${targetScore}ç‚¹å…ˆå–`;
            }
            
            // çµæœãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’éš ã™
            document.getElementById('result-message').style.display = 'none';
            
            // ãƒœã‚¿ãƒ³ã‚’æœ‰åŠ¹åŒ–ï¼ˆ2äººãƒ¢ãƒ¼ãƒ‰ã§ã¯é™¤å¤–çŠ¶æ…‹ã‚’ãƒªã‚»ãƒƒãƒˆï¼‰
            buttonsDisabled = false;
            if (gameMode === 2) {
                player1Eliminated = false;
                player2Eliminated = false;
            }
            enableAllButtons();
        }
        
        function generateFraction() {
            let denominator, numerator;
            do {
                denominator = Math.floor(Math.random() * 5) + 2; // 2-6
                numerator = Math.floor(Math.random() * denominator) + 1; // 1-åˆ†æ¯
            } while (numerator === denominator); // åˆ†å­ã¨åˆ†æ¯ãŒåŒã˜ï¼ˆ=1ï¼‰ã®å ´åˆã¯é™¤å¤–
            return { num: numerator, den: denominator };
        }
        
        // ç­‰ã—ã„åˆ†æ•°ãƒšã‚¢ç”Ÿæˆï¼ˆå¿…ãšåˆ¥è¡¨è¨˜ï¼‰
        function generateEqualPair(){
            const base = generateFraction();
            const g = (a,b)=> b?g(b,a%b):a;
            const d = g(base.num, base.den);
            const n0 = base.num / d, d0 = base.den / d;

            const options = [];
            const maxK = Math.floor(6 / d0);
            for(let k=1; k<=maxK; k++){
                const cand = { num: n0*k, den: d0*k };
                if (!fractionsAreIdentical(cand, base)) options.push(cand);
            }
            // å€™è£œãŒãªã‘ã‚Œã°å¼•ãç›´ã—
            if (!options.length) return generateEqualPair();

            return [base, options[Math.floor(Math.random()*options.length)]];
        }
        
        // ç­‰ã—ããªã„åˆ†æ•°ãƒšã‚¢ç”Ÿæˆ
        function generateNonEqualPair(){
            const a = generateFraction();
            let b;
            do {
                b = generateFraction();
            } while (fractionsAreIdentical(a, b) || fractionsAreEquivalent(a, b));
            return [a, b];
        }
        
        function enableAllButtons() {
            document.querySelectorAll('.answer-btn').forEach(btn => {
                btn.disabled = false;
            });
        }
        
        function disableAllButtons() {
            document.querySelectorAll('.answer-btn').forEach(btn => {
                btn.disabled = true;
            });
        }
        
        function disablePlayerButtons(player) {
            if (player === 1) {
                document.querySelectorAll('.player1-btn').forEach(btn => {
                    btn.disabled = true;
                });
            } else {
                document.querySelectorAll('.player2-btn').forEach(btn => {
                    btn.disabled = true;
                });
            }
        }
        
        function showBigPopup(player, message) {
            const popup = document.getElementById('big-popup');
            popup.innerHTML = message.replace('\n', '<br>');
            popup.className = `big-popup player${player}`;
            popup.style.display = 'block';
            
            setTimeout(() => {
                popup.style.display = 'none';
            }, 1500);
        }
        
        function checkAnswerTwoPlayer(player, answer) {
            if (buttonsDisabled) return;
            buttonsDisabled = true; // å…ˆã«ãƒ­ãƒƒã‚¯
            
            // ãã®ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ãŒæ—¢ã«é™¤å¤–ã•ã‚Œã¦ã„ã‚‹å ´åˆã¯ç„¡è¦–
            if ((player === 1 && player1Eliminated) || (player === 2 && player2Eliminated)) {
                buttonsDisabled = false;
                return;
            }
            
            const r = cmp(currentFraction1, currentFraction2);
            const correctAnswer = (r===0 ? 'equal' : r>0 ? 'left' : 'right');
            const correct = (answer === correctAnswer);
            
            if (correct) {
                // æ­£è§£ã®å ´åˆï¼šå¤§ããªãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—è¡¨ç¤ºã€å¾—ç‚¹è¿½åŠ ã€æ¬¡ã®å•é¡Œã¸
                const playerName = player === 1 ? 
                    (document.getElementById('player1-name').value || 'ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼1') : 
                    (document.getElementById('player2-name').value || 'ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼2');
                showBigPopup(player, `${playerName}\nğŸ‰ æ­£è§£ï¼`);
                
                if (player === 1) {
                    player1Score++;
                } else {
                    player2Score++;
                }
                
                updateScores();
                disableAllButtons();
                
                // å‹åˆ©åˆ¤å®š
                setTimeout(() => {
                    if (player1Score >= targetScore || player2Score >= targetScore) {
                        showResults();
                    } else {
                        generateQuestion();
                    }
                }, 1200);
            } else {
                // ä¸æ­£è§£ã®å ´åˆï¼šãã®ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚’é™¤å¤–ã€ã‚‚ã†ä¸€æ–¹ã¯ç¶™ç¶šå¯èƒ½
                if (player === 1) {
                    player1Eliminated = true;
                    disablePlayerButtons(1);
                } else {
                    player2Eliminated = true;
                    disablePlayerButtons(2);
                }
                
                // çµæœãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è¡¨ç¤º
                const resultMessage = document.getElementById('result-message');
                const playerName = player === 1 ? 
                    (document.getElementById('player1-name').value || 'ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼1') : 
                    (document.getElementById('player2-name').value || 'ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼2');
                resultMessage.textContent = `âŒ ${playerName}ä¸æ­£è§£... è§£ç­”æ¨©ã‚’å¤±ã„ã¾ã—ãŸ`;
                resultMessage.className = 'result-message incorrect';
                resultMessage.style.display = 'block';
                
                // ã¾ã èª°ã‹ç­”ãˆã‚‰ã‚Œã‚‹ãªã‚‰ãƒ­ãƒƒã‚¯è§£é™¤ï¼ˆã‚‚ã†ä¸€äººã«ãƒãƒ£ãƒ³ã‚¹ï¼‰
                if (!(player1Eliminated && player2Eliminated)) {
                    buttonsDisabled = false;
                }
                
                // ä¸¡æ–¹ã®ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ãŒé™¤å¤–ã•ã‚ŒãŸå ´åˆã¯æ¬¡ã®å•é¡Œã¸
                if (player1Eliminated && player2Eliminated) {
                    setTimeout(() => {
                        resultMessage.style.display = 'none';
                        generateQuestion();
                    }, 1500);
                } else {
                    // ã¾ã è§£ç­”å¯èƒ½ãªãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ãŒã„ã‚‹å ´åˆã¯çµæœãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã ã‘æ¶ˆã™
                    setTimeout(() => {
                        resultMessage.style.display = 'none';
                    }, 1500);
                }
            }
        }
        
        function checkAnswer(answer) {
            const r = cmp(currentFraction1, currentFraction2);
            const correctAnswer = (r===0 ? 'equal' : r>0 ? 'left' : 'right');
            const correct = (answer === correctAnswer);
            
            // çµæœè¡¨ç¤º
            const resultMessage = document.getElementById('result-message');
            if (correct) {
                resultMessage.textContent = 'ğŸ‰ æ­£è§£ï¼';
                resultMessage.className = 'result-message correct';
                
                if (gameMode === 1 || currentPlayer === 1) {
                    player1Score++;
                } else {
                    player2Score++;
                }
            } else {
                resultMessage.textContent = 'âŒ ä¸æ­£è§£... (+5ç§’ãƒšãƒŠãƒ«ãƒ†ã‚£)';
                resultMessage.className = 'result-message incorrect';
                
                // 1äººãƒ¢ãƒ¼ãƒ‰ã®å ´åˆã€5ç§’ãƒšãƒŠãƒ«ãƒ†ã‚£
                if (gameMode === 1) {
                    startTime -= 5000; // 5ç§’åˆ†ã‚¿ã‚¤ãƒãƒ¼ã‚’é…ã‚‰ã›ã‚‹
                }
                
                // ä¸æ­£è§£å•é¡Œã‚’ä¿å­˜
                incorrectQuestions.push({
                    fraction1: { ...currentFraction1 },
                    fraction2: { ...currentFraction2 }
                });
            }
            
            resultMessage.style.display = 'block';
            updateScores();
            
            // æ¬¡ã®å•é¡Œã¾ãŸã¯çµæœç”»é¢ã¸ï¼ˆé«˜é€ŸåŒ–ï¼š800msï¼‰
            setTimeout(() => {
                resultMessage.style.display = 'none';
                if (isReviewMode) {
                    reviewIndex++;
                    generateReviewQuestion();
                } else if (questionCount >= maxQuestions) {
                    // ä¸æ­£è§£å•é¡Œã®å¾©ç¿’ãŒã‚ã‚‹ã‹ãƒã‚§ãƒƒã‚¯
                    if (gameMode === 1 && incorrectQuestions.length > 0) {
                        showIncorrectReview();
                    } else {
                        showResults();
                    }
                } else {
                    generateQuestion();
                }
            }, 800);
        }
        
        function updateScores() {
            document.getElementById('player1-score').textContent = player1Score;
            document.getElementById('player2-score').textContent = player2Score;
        }
        
        function showResults() {
            // ã‚¿ã‚¤ãƒãƒ¼åœæ­¢
            if (timerInterval) {
                clearInterval(timerInterval);
                timerInterval = null;
            }
            
            document.getElementById('game-screen').classList.remove('active');
            document.getElementById('result-screen').classList.add('active');
            
            document.getElementById('final-player1-score').textContent = player1Score;
            
            if (gameMode === 2) {
                document.getElementById('final-player2-card').style.display = 'block';
                document.getElementById('final-player2-score').textContent = player2Score;
                const player1Name = document.getElementById('player1-name').value || 'ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼1';
                const player2Name = document.getElementById('player2-name').value || 'ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼2';
                document.getElementById('final-player1-label').textContent = player1Name + 'ã®æœ€çµ‚å¾—ç‚¹';
                document.getElementById('final-player2-label').textContent = player2Name + 'ã®æœ€çµ‚å¾—ç‚¹';
                document.getElementById('final-timer-card').style.display = 'none';
                
                const winnerMessage = document.getElementById('winner-message');
                if (player1Score > player2Score) {
                    winnerMessage.textContent = `ğŸ† ${player1Name}ã®å‹åˆ©ï¼`;
                    winnerMessage.className = 'result-message correct';
                } else if (player2Score > player1Score) {
                    winnerMessage.textContent = `ğŸ† ${player2Name}ã®å‹åˆ©ï¼`;
                    winnerMessage.className = 'result-message correct';
                } else {
                    winnerMessage.textContent = 'ğŸ¤ å¼•ãåˆ†ã‘ï¼';
                    winnerMessage.className = 'result-message';
                    winnerMessage.style.background = 'linear-gradient(135deg, #ffecd2, #fcb69f)';
                    winnerMessage.style.color = '#2d3748';
                }
            } else {
                document.getElementById('final-player2-card').style.display = 'none';
                document.getElementById('final-player1-label').textContent = 'ã‚ãªãŸã®æœ€çµ‚å¾—ç‚¹';
                document.getElementById('final-timer-card').style.display = 'block';
                document.getElementById('final-timer').textContent = gameTime.toFixed(2) + 'ç§’';
                
                const winnerMessage = document.getElementById('winner-message');
                
                // ãƒã‚¤ã‚¹ã‚³ã‚¢æ›´æ–°ãƒã‚§ãƒƒã‚¯ï¼ˆæº€ç‚¹ã®å ´åˆã®ã¿ï¼‰
                let isNewRecord = false;
                if (player1Score === 10 && gameTime < highScore) {
                    highScore = gameTime;
                    localStorage.setItem('fractionGameHighScore', highScore.toString());
                    isNewRecord = true;
                }
                
                if (player1Score >= 8) {
                    if (isNewRecord) {
                        winnerMessage.textContent = 'ğŸ† æ–°è¨˜éŒ²ï¼åˆ†æ•°ãƒã‚¹ã‚¿ãƒ¼ã§ã™ï¼';
                    } else if (gameTime <= 30) {
                        winnerMessage.textContent = 'ğŸš€ è¶…é«˜é€Ÿï¼åˆ†æ•°ãƒã‚¹ã‚¿ãƒ¼ã§ã™ï¼';
                    } else if (gameTime <= 60) {
                        winnerMessage.textContent = 'ğŸŒŸ ç´ æ™´ã‚‰ã—ã„ï¼åˆ†æ•°ãƒã‚¹ã‚¿ãƒ¼ã§ã™ï¼';
                    } else {
                        winnerMessage.textContent = 'ğŸŒŸ åˆ†æ•°ãƒã‚¹ã‚¿ãƒ¼ã§ã™ï¼';
                    }
                    winnerMessage.className = 'result-message correct';
                } else if (player1Score >= 6) {
                    winnerMessage.textContent = 'ğŸ‘ ã‚ˆãã§ãã¾ã—ãŸï¼';
                    winnerMessage.className = 'result-message correct';
                } else {
                    winnerMessage.textContent = 'ğŸ’ª ã‚‚ã†ä¸€åº¦ãƒãƒ£ãƒ¬ãƒ³ã‚¸ã—ã¦ã¿ã‚ˆã†ï¼';
                    winnerMessage.className = 'result-message incorrect';
                }
            }
        }
        
        function showIncorrectReview() {
            document.getElementById('game-screen').classList.remove('active');
            document.getElementById('review-screen').classList.add('active');
        }
        
        function startReview() {
            isReviewMode = true;
            reviewIndex = 0;
            questionCount = 0;
            
            document.getElementById('review-screen').classList.remove('active');
            document.getElementById('game-screen').classList.add('active');
            
            generateReviewQuestion();
        }
        
        function skipReview() {
            showResults();
        }
        
        function generateReviewQuestion() {
            if (reviewIndex >= incorrectQuestions.length) {
                isReviewMode = false;
                showResults();
                return;
            }
            
            const q = incorrectQuestions[reviewIndex];
            currentFraction1 = q.fraction1;
            currentFraction2 = q.fraction2;
            
            // UIæ›´æ–°
            document.getElementById('question-count').textContent = `å¾©ç¿’ ${reviewIndex + 1} / ${incorrectQuestions.length}`;
            document.getElementById('fraction1-num').textContent = currentFraction1.num;
            document.getElementById('fraction1-den').textContent = currentFraction1.den;
            document.getElementById('fraction2-num').textContent = currentFraction2.num;
            document.getElementById('fraction2-den').textContent = currentFraction2.den;
            
            // çµæœãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’éš ã™
            document.getElementById('result-message').style.display = 'none';
        }
        
        function restartGame() {
            startGame(gameMode);
        }
        
        // 2äººæˆ¦ç”¨ãƒ‘ã‚¹æ©Ÿèƒ½
        function skipToNextQuestion() {
            if (gameMode !== 2) return;
            
            const resultMessage = document.getElementById('result-message');
            resultMessage.textContent = 'â­ï¸ æ¬¡ã®å•é¡Œã¸ã‚¹ã‚­ãƒƒãƒ—ã—ã¾ã—ãŸ';
            resultMessage.className = 'result-message';
            resultMessage.style.background = 'linear-gradient(135deg, #ffecd2, #fcb69f)';
            resultMessage.style.color = '#2d3748';
            resultMessage.style.display = 'block';
            
            setTimeout(() => {
                resultMessage.style.display = 'none';
                generateQuestion();
            }, 1000);
        }
        
        // ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰æ“ä½œï¼ˆ1äººãƒ¢ãƒ¼ãƒ‰ç”¨ï¼‰
        window.addEventListener('keydown', (e) => {
            if (!document.getElementById('game-screen').classList.contains('active')) return;
            if (gameMode !== 1) return;
            if (buttonsDisabled) return;
            
            if (e.key === 'ArrowLeft') {
                e.preventDefault();
                checkAnswer('left');
            } else if (e.key === 'ArrowRight') {
                e.preventDefault();
                checkAnswer('right');
            } else if (e.key === '=' || e.key === 'Enter') {
                e.preventDefault();
                checkAnswer('equal');
            }
        });
    </script>
</html>
