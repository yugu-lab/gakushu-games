<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç´„æ•°é¸æŠã‚²ãƒ¼ãƒ </title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;500;600;700&display=swap');
        body { font-family: 'Noto Sans JP', sans-serif; }
        .pulse-animation { animation: pulse 1s infinite; }
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
    </style>
</head>
<body class="bg-gradient-to-br from-blue-50 to-indigo-100 min-h-screen">
    <div class="container mx-auto px-4 py-8 max-w-4xl">
        <!-- ãƒ¡ã‚¤ãƒ³ã‚¿ã‚¤ãƒˆãƒ« -->
        <div id="mainTitle" class="text-center mb-8">
            <h1 class="text-4xl font-bold text-indigo-800 mb-2">ç´„æ•°é¸æŠã‚²ãƒ¼ãƒ </h1>
            <p class="text-gray-600">æ•°ã®ç´„æ•°ã‚’ç´ æ—©ãè¦‹ã¤ã‘ã‚ˆã†ï¼</p>
        </div>

        <!-- ãƒ¡ã‚¤ãƒ³ãƒ¡ãƒ‹ãƒ¥ãƒ¼ -->
        <div id="mainMenu" class="bg-white rounded-xl shadow-lg p-8">
            <div class="text-center mb-8">
                <h2 class="text-2xl font-semibold text-gray-800 mb-4">ã‚²ãƒ¼ãƒ ãƒ¢ãƒ¼ãƒ‰ã‚’é¸æŠ</h2>
                <div class="grid md:grid-cols-2 gap-6">
                    <button onclick="showRules('single')" class="bg-blue-500 hover:bg-blue-600 text-white font-semibold py-6 px-8 rounded-lg transition-colors">
                        <div class="text-xl mb-2">ğŸƒâ€â™‚ï¸ 1äººãƒ¢ãƒ¼ãƒ‰</div>
                        <div class="text-sm opacity-90">45ç§’ã§ä½•å•æ­£è§£ã§ãã‚‹ã‹æŒ‘æˆ¦ï¼</div>
                    </button>
                    <button onclick="showRules('multi')" class="bg-green-500 hover:bg-green-600 text-white font-semibold py-6 px-8 rounded-lg transition-colors">
                        <div class="text-xl mb-2">ğŸ‘¥ 2äººãƒ¢ãƒ¼ãƒ‰</div>
                        <div class="text-sm opacity-90">å‹é”ã¨å¯¾æˆ¦ã—ã‚ˆã†ï¼</div>
                    </button>
                </div>
            </div>
            
            <!-- ãƒ«ãƒ¼ãƒ«èª¬æ˜ãƒœã‚¿ãƒ³ -->
            <div class="text-center">
                <button onclick="showExample()" class="bg-gray-500 hover:bg-gray-600 text-white font-medium py-3 px-6 rounded-lg transition-colors">
                    ğŸ“š ãƒ«ãƒ¼ãƒ«ã¨ä¾‹é¡Œã‚’è¦‹ã‚‹
                </button>
            </div>
        </div>

        <!-- ãƒ«ãƒ¼ãƒ«èª¬æ˜ç”»é¢ -->
        <div id="rulesScreen" class="bg-white rounded-xl shadow-lg p-8 hidden">
            <h2 class="text-2xl font-semibold text-gray-800 mb-6">ã‚²ãƒ¼ãƒ ãƒ«ãƒ¼ãƒ«</h2>
            
            <div class="mb-6">
                <h3 class="text-lg font-medium text-gray-700 mb-3">åŸºæœ¬ãƒ«ãƒ¼ãƒ«</h3>
                <ul class="list-disc list-inside text-gray-600 space-y-2">
                    <li>2ä»¥ä¸Š20ä»¥ä¸‹ã®æ•°ãŒè¡¨ç¤ºã•ã‚Œã¾ã™</li>
                    <li>ãã®æ•°ã®ç´„æ•°ã‚’å…¨ã¦é¸æŠã—ã¦ãã ã•ã„</li>
                    <li>1ï½20ã®ãƒœã‚¿ãƒ³ã‹ã‚‰æ­£ã—ã„ç´„æ•°ã‚’é¸ã‚“ã§ã€Œé€ä¿¡ã€ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã¾ã™</li>
                    <li>å…¨ã¦ã®ç´„æ•°ã‚’æ­£ã—ãé¸æŠã§ãã‚Œã°æ­£è§£ã§ã™</li>
                </ul>
            </div>

            <div class="mb-6">
                <h3 class="text-lg font-medium text-gray-700 mb-3">ãƒ¢ãƒ¼ãƒ‰åˆ¥ãƒ«ãƒ¼ãƒ«</h3>
                <div class="grid md:grid-cols-2 gap-4">
                    <div class="bg-blue-50 p-4 rounded-lg">
                        <h4 class="font-medium text-blue-800 mb-2">ğŸƒâ€â™‚ï¸ 1äººãƒ¢ãƒ¼ãƒ‰</h4>
                        <p class="text-sm text-blue-700">45ç§’ä»¥å†…ã«ä½•å•æ­£è§£ã§ãã‚‹ã‹ã‚’ç«¶ã„ã¾ã™</p>
                    </div>
                    <div class="bg-green-50 p-4 rounded-lg">
                        <h4 class="font-medium text-green-800 mb-2">ğŸ‘¥ 2äººãƒ¢ãƒ¼ãƒ‰</h4>
                        <p class="text-sm text-green-700">åŒã˜å•é¡Œã§æ—©ãæ­£è§£ã—ãŸæ–¹ãŒ1ãƒã‚¤ãƒ³ãƒˆç²å¾—</p>
                    </div>
                </div>
            </div>

            <div id="modeSpecificRules"></div>

            <!-- åå‰å…¥åŠ›æ¬„ï¼ˆ2äººãƒ¢ãƒ¼ãƒ‰ã®å ´åˆã®ã¿è¡¨ç¤ºï¼‰ -->
            <div id="nameInputSection" class="mb-6 hidden">
                <h3 class="text-lg font-medium text-gray-700 mb-3">ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼åè¨­å®š</h3>
                <div class="grid md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼1ã®åå‰</label>
                        <input type="text" id="rulesPlayer1Name" value="ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼1" onclick="this.select()" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼2ã®åå‰</label>
                        <input type="text" id="rulesPlayer2Name" value="ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼2" onclick="this.select()" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500">
                    </div>
                </div>
                
                <div class="mt-4">
                    <label class="block text-sm font-medium text-gray-700 mb-2">å…ˆå–ãƒã‚¤ãƒ³ãƒˆæ•°</label>
                    <select id="rulesTargetScore" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500">
                        <option value="3">3ç‚¹å…ˆå–</option>
                        <option value="5">5ç‚¹å…ˆå–</option>
                        <option value="7">7ç‚¹å…ˆå–</option>
                        <option value="10">10ç‚¹å…ˆå–</option>
                    </select>
                </div>
            </div>

            <div class="flex gap-4 justify-center">
                <button onclick="backToMenu()" class="bg-gray-500 hover:bg-gray-600 text-white font-medium py-2 px-6 rounded-lg transition-colors">
                    æˆ»ã‚‹
                </button>
                <button id="startGameBtn" class="bg-indigo-500 hover:bg-indigo-600 text-white font-medium py-2 px-6 rounded-lg transition-colors">
                    ã‚²ãƒ¼ãƒ é–‹å§‹
                </button>
            </div>
        </div>

        <!-- ä¾‹é¡Œç”»é¢ -->
        <div id="exampleScreen" class="bg-white rounded-xl shadow-lg p-8 hidden">
            <h2 class="text-2xl font-semibold text-gray-800 mb-6">ä¾‹é¡Œã§ç·´ç¿’</h2>
            
            <div class="bg-yellow-50 border-l-4 border-yellow-400 p-4 mb-6">
                <h3 class="font-medium text-yellow-800 mb-2">ä¾‹ï¼šæ•°å­—ã€Œ12ã€ã®ç´„æ•°ã‚’è¦‹ã¤ã‘ã‚ˆã†</h3>
                <p class="text-yellow-700 text-sm mb-3">12ã‚’å‰²ã‚Šåˆ‡ã‚Œã‚‹æ•°ã‚’å…¨ã¦é¸æŠã—ã¾ã™</p>
                <div class="text-sm text-yellow-600">
                    <p>12 Ã· 1 = 12 âœ“</p>
                    <p>12 Ã· 2 = 6 âœ“</p>
                    <p>12 Ã· 3 = 4 âœ“</p>
                    <p>12 Ã· 4 = 3 âœ“</p>
                    <p>12 Ã· 6 = 2 âœ“</p>
                    <p>12 Ã· 12 = 1 âœ“</p>
                    <p class="font-medium mt-2">ç­”ãˆï¼š1, 2, 3, 4, 6, 12</p>
                </div>
            </div>

            <div class="text-center">
                <button onclick="backToMenu()" class="bg-indigo-500 hover:bg-indigo-600 text-white font-medium py-2 px-6 rounded-lg transition-colors">
                    ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã«æˆ»ã‚‹
                </button>
            </div>
        </div>

        <!-- 2äººãƒ¢ãƒ¼ãƒ‰è¨­å®šç”»é¢ -->
        <div id="multiSetupScreen" class="bg-white rounded-xl shadow-lg p-8 hidden">
            <h2 class="text-2xl font-semibold text-gray-800 mb-6">2äººãƒ¢ãƒ¼ãƒ‰è¨­å®š</h2>
            
            <div class="space-y-6">
                <div class="grid md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼1ã®åå‰</label>
                        <input type="text" id="player1Name" value="ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼1" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼2ã®åå‰</label>
                        <input type="text" id="player2Name" value="ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼2" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500">
                    </div>
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">å…ˆå–ãƒã‚¤ãƒ³ãƒˆæ•°</label>
                    <select id="targetScore" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500">
                        <option value="3">3ç‚¹å…ˆå–</option>
                        <option value="5">5ç‚¹å…ˆå–</option>
                        <option value="7">7ç‚¹å…ˆå–</option>
                        <option value="10">10ç‚¹å…ˆå–</option>
                    </select>
                </div>
            </div>

            <div class="flex gap-4 justify-center mt-8">
                <button onclick="backToMenu()" class="bg-gray-500 hover:bg-gray-600 text-white font-medium py-2 px-6 rounded-lg transition-colors">
                    æˆ»ã‚‹
                </button>
                <button onclick="startMultiGame()" class="bg-green-500 hover:bg-green-600 text-white font-medium py-2 px-6 rounded-lg transition-colors">
                    ã‚²ãƒ¼ãƒ é–‹å§‹
                </button>
            </div>
        </div>

        <!-- ã‚²ãƒ¼ãƒ ç”»é¢ -->
        <div id="gameScreen" class="bg-white rounded-xl shadow-lg p-1 hidden">
            <!-- ã‚²ãƒ¼ãƒ æƒ…å ±ï¼ˆ1äººãƒ¢ãƒ¼ãƒ‰ã®ã¿è¡¨ç¤ºï¼‰ -->
            <div id="gameInfo" class="mb-4"></div>
            
            <!-- 1äººãƒ¢ãƒ¼ãƒ‰ç”¨å•é¡Œè¡¨ç¤º -->
            <div id="singleModeProblem" class="text-center mb-6 hidden">
                <div class="text-lg text-gray-600 mb-2">ã“ã®æ•°ã®ç´„æ•°ã‚’å…¨ã¦é¸æŠã—ã¦ãã ã•ã„</div>
                <div id="currentNumberSingle" class="text-6xl font-bold text-indigo-600 mb-4">12</div>
                <div id="gameStatusSingle" class="text-sm text-gray-500"></div>
            </div>

            <!-- é¸æŠãƒœã‚¿ãƒ³ -->
            <div class="mb-2">
                <!-- 1äººãƒ¢ãƒ¼ãƒ‰ç”¨ãƒœã‚¿ãƒ³ -->
                <div id="singleModeButtons" class="hidden">
                    <div class="text-center mb-4">
                        <span class="text-sm text-gray-600">é¸æŠã—ãŸç´„æ•°: </span>
                        <span id="selectedNumbers" class="font-medium text-indigo-600">ãªã—</span>
                    </div>
                    <div id="numberButtons" class="grid grid-cols-10 gap-2 max-w-4xl mx-auto"></div>
                </div>

                <!-- 2äººãƒ¢ãƒ¼ãƒ‰ç”¨ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ -->
                <div id="multiModeButtons" class="hidden">
                    <!-- ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼2ã‚¨ãƒªã‚¢ï¼ˆä¸Šå´ãƒ»é€†å‘ãï¼‰ -->
                    <div class="p-1 bg-green-50 rounded mb-1 transform rotate-180">
                        <div class="text-center mb-1">
                            <h3 class="text-xs font-semibold text-green-800" id="player2NameDisplay">ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼2</h3>
                            <div class="text-xs text-green-600"><span id="player2Selected" class="font-medium">ãªã—</span></div>
                        </div>
                        <div id="player2Buttons" class="grid grid-cols-10 gap-0.5 max-w-3xl mx-auto mb-1"></div>
                        <div class="text-center">
                            <button id="player2SubmitBtn" onclick="submitMultiAnswer(2)" class="bg-green-500 hover:bg-green-600 text-white font-medium py-1 px-3 rounded text-xs transition-colors">
                                é€ä¿¡
                            </button>
                        </div>
                    </div>

                    <!-- å•é¡Œè¡¨ç¤ºï¼ˆä¸­å¤®ï¼‰ -->
                    <div class="py-1 bg-gray-50 rounded mb-1">
                        <div class="flex justify-between items-center px-2">
                            <!-- ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼2ã®æƒ…å ±ï¼ˆå·¦å´ãƒ»é€†å‘ãï¼‰ -->
                            <div class="flex flex-col items-center transform rotate-180 w-16">
                                <div class="text-xs font-bold text-green-800" id="player2ScoreArea"></div>
                                <div id="player2Status" class="text-xs mt-1 font-medium"></div>
                            </div>
                            
                            <!-- å•é¡Œæ•°å­—ï¼ˆä¸­å¤®ï¼‰ -->
                            <div class="flex justify-center items-center flex-1">
                                <div class="bg-white rounded-xl px-20 py-6 shadow-lg border-4 border-indigo-200 w-full max-w-2xl">
                                    <div class="text-center">
                                        <div class="text-sm text-gray-500 mb-4 transform rotate-180">å•é¡Œ</div>
                                        <div class="flex items-center justify-center space-x-24">
                                            <div id="currentNumberP2" class="text-6xl font-bold text-indigo-600 transform rotate-180">12</div>
                                            <div class="w-px h-20 bg-gray-300"></div>
                                            <div id="currentNumberP1" class="text-6xl font-bold text-indigo-600">12</div>
                                        </div>
                                        <div class="text-sm text-gray-500 mt-4">ã“ã®æ•°ã®ç´„æ•°ã‚’é¸æŠ</div>
                                        <div class="text-sm text-gray-500 mt-1 transform rotate-180">ã“ã®æ•°ã®ç´„æ•°ã‚’é¸æŠ</div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼1ã®æƒ…å ±ï¼ˆå³å´ãƒ»é€šå¸¸å‘ãï¼‰ -->
                            <div class="flex flex-col items-center w-16">
                                <div class="text-xs font-bold text-blue-800" id="player1ScoreArea"></div>
                                <div id="player1Status" class="text-xs mt-1 font-medium"></div>
                            </div>
                        </div>
                        <div id="gameStatus" class="text-xs text-gray-500 mt-1 text-center">æ—©æŠ¼ã—ã§å›ç­”ã—ã¦ãã ã•ã„ï¼</div>
                        <div id="currentTurnIndicator" class="text-xs font-bold text-center"></div>
                    </div>

                    <!-- ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼1ã‚¨ãƒªã‚¢ï¼ˆä¸‹å´ãƒ»é€šå¸¸å‘ãï¼‰ -->
                    <div class="p-1 bg-blue-50 rounded">
                        <div class="text-center mb-1">
                            <h3 class="text-xs font-semibold text-blue-800" id="player1NameDisplay">ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼1</h3>
                            <div class="text-xs text-blue-600"><span id="player1Selected" class="font-medium">ãªã—</span></div>
                        </div>
                        <div id="player1Buttons" class="grid grid-cols-10 gap-0.5 max-w-3xl mx-auto mb-1"></div>
                        <div class="text-center">
                            <button id="player1SubmitBtn" onclick="submitMultiAnswer(1)" class="bg-blue-500 hover:bg-blue-600 text-white font-medium py-1 px-3 rounded text-xs transition-colors">
                                é€ä¿¡
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- æ“ä½œãƒœã‚¿ãƒ³ï¼ˆ1äººãƒ¢ãƒ¼ãƒ‰ç”¨ï¼‰ -->
            <div id="singleModeControls" class="text-center space-x-4 hidden">
                <button id="clearBtn" onclick="clearSelection()" class="bg-gray-500 hover:bg-gray-600 text-white font-medium py-2 px-6 rounded-lg transition-colors">
                    ã‚¯ãƒªã‚¢
                </button>
                <button id="submitBtn" onclick="submitAnswer()" class="bg-indigo-500 hover:bg-indigo-600 text-white font-medium py-3 px-8 rounded-lg transition-colors pulse-animation">
                    é€ä¿¡
                </button>
            </div>

            <!-- çµæœè¡¨ç¤º -->
            <div id="resultDisplay" class="mt-2 text-center hidden"></div>
        </div>

        <!-- çµæœç”»é¢ -->
        <div id="resultScreen" class="bg-white rounded-xl shadow-lg p-8 hidden">
            <div id="finalResult" class="text-center"></div>
            <div class="text-center mt-6">
                <button onclick="backToMenu()" class="bg-indigo-500 hover:bg-indigo-600 text-white font-medium py-2 px-6 rounded-lg transition-colors">
                    ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã«æˆ»ã‚‹
                </button>
            </div>
        </div>
    </div>

    <script>
        let gameMode = '';
        let currentNumber = 0;
        let selectedNumbers = [];
        let player1SelectedNumbers = [];
        let player2SelectedNumbers = [];
        let gameTimer = null;
        let timeLeft = 45;
        let score = 0;
        let player1Score = 0;
        let player2Score = 0;
        let player1Name = 'ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼1';
        let player2Name = 'ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼2';
        let targetScore = 3;
        let currentTurn = 0; // 0: ä¸¡æ–¹å¯èƒ½, 1: ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼1ã®ã¿, 2: ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼2ã®ã¿
        let questionStartTime = 0;
        let gameEnded = false;
        let lastNums = [];
        let wrongAnswers = []; // é–“é•ãˆãŸå•é¡Œã‚’è¨˜éŒ²
        let singleLocked = false; // 1äººãƒ¢ãƒ¼ãƒ‰ã®äºŒé‡é€ä¿¡é˜²æ­¢

        // 2äººãƒ¢ãƒ¼ãƒ‰ã®ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼æœ‰åŠ¹/ç„¡åŠ¹åˆ‡æ›¿
        function setPlayerActive(player, active) {
            const submitBtn = document.getElementById(`player${player}SubmitBtn`);
            submitBtn.disabled = !active;
            submitBtn.className = active
                ? (player === 1
                    ? 'bg-blue-500 hover:bg-blue-600 text-white font-medium py-2 px-6 rounded-lg transition-colors'
                    : 'bg-green-500 hover:bg-green-600 text-white font-medium py-2 px-6 rounded-lg transition-colors')
                : 'bg-gray-400 text-white font-medium py-2 px-6 rounded-lg cursor-not-allowed';

            for (let i = 1; i <= 20; i++) {
                const btn = document.getElementById(`p${player}-btn-${i}`);
                if (!btn) continue;
                if (active) {
                    // å†ã‚¢ã‚¿ãƒƒãƒï¼ˆã‚¯ãƒ­ãƒ¼ã‚¸ãƒ£ã§iã‚’å›ºå®šï¼‰
                    btn.onclick = ((n, b) => () => togglePlayerNumber(player, n, b))(i, btn);
                    if (!btn.className.includes('hover:bg-gray-300')) btn.className += ' hover:bg-gray-300';
                    btn.classList.remove('cursor-not-allowed');
                } else {
                    btn.onclick = null;
                    btn.className = btn.className.replace('hover:bg-gray-300', '');
                    btn.classList.add('cursor-not-allowed');
                }
            }
        }

        function showScreen(screenId) {
            const screens = ['mainMenu', 'rulesScreen', 'exampleScreen', 'multiSetupScreen', 'gameScreen', 'resultScreen'];
            screens.forEach(id => {
                document.getElementById(id).classList.add('hidden');
            });
            document.getElementById(screenId).classList.remove('hidden');
        }

        function showRules(mode) {
            gameMode = mode;
            const modeRules = document.getElementById('modeSpecificRules');
            
            if (mode === 'single') {
                modeRules.innerHTML = `
                    <div class="mb-6">
                        <h3 class="text-lg font-medium text-gray-700 mb-3">1äººãƒ¢ãƒ¼ãƒ‰è©³ç´°</h3>
                        <div class="bg-blue-50 p-4 rounded-lg">
                            <ul class="list-disc list-inside text-blue-700 space-y-1 text-sm">
                                <li>åˆ¶é™æ™‚é–“ã¯45ç§’ã§ã™</li>
                                <li>æ™‚é–“å†…ã«ä½•å•æ­£è§£ã§ãã‚‹ã‹ã‚’ç«¶ã„ã¾ã™</li>
                                <li>é–“é•ãˆã¦ã‚‚æ¬¡ã®å•é¡Œã«é€²ã‚ã¾ã™</li>
                                <li>é«˜å¾—ç‚¹ã‚’ç›®æŒ‡ã—ã¾ã—ã‚‡ã†ï¼</li>
                            </ul>
                        </div>
                    </div>
                `;
                document.getElementById('nameInputSection').classList.add('hidden');
                document.getElementById('startGameBtn').onclick = startSingleGame;
            } else {
                modeRules.innerHTML = `
                    <div class="mb-6">
                        <h3 class="text-lg font-medium text-gray-700 mb-3">2äººãƒ¢ãƒ¼ãƒ‰è©³ç´°</h3>
                        <div class="bg-green-50 p-4 rounded-lg">
                            <ul class="list-disc list-inside text-green-700 space-y-1 text-sm">
                                <li>åŒã˜å•é¡Œã«å¯¾ã—ã¦2äººãŒåŒæ™‚ã«æŒ‘æˆ¦</li>
                                <li>æ­£è§£ã‹ã¤æ—©ãé€ä¿¡ã—ãŸæ–¹ãŒ1ãƒã‚¤ãƒ³ãƒˆç²å¾—</li>
                                <li>é–“é•ãˆãŸå ´åˆã¯ãƒã‚¤ãƒ³ãƒˆãªã—</li>
                                <li>è¨­å®šã—ãŸãƒã‚¤ãƒ³ãƒˆæ•°ã«å…ˆã«åˆ°é”ã—ãŸæ–¹ãŒå‹åˆ©</li>
                            </ul>
                        </div>
                    </div>
                `;
                document.getElementById('nameInputSection').classList.remove('hidden');
                document.getElementById('startGameBtn').onclick = startMultiGameFromRules;
            }
            
            showScreen('rulesScreen');
        }

        function showExample() {
            showScreen('exampleScreen');
        }

        function showMultiSetup() {
            showScreen('multiSetupScreen');
        }

        function backToMenu() {
            showScreen('mainMenu');
            resetGame();
            // ã‚¿ã‚¤ãƒˆãƒ«ã‚’å†è¡¨ç¤º
            document.getElementById('mainTitle').style.display = 'block';
        }

        function resetGame() {
            if (gameTimer) {
                clearInterval(gameTimer);
                gameTimer = null;
            }
            selectedNumbers = [];
            player1SelectedNumbers = [];
            player2SelectedNumbers = [];
            score = 0;
            player1Score = 0;
            player2Score = 0;
            timeLeft = 45;
            currentTurn = 0;
            gameEnded = false;
            wrongAnswers = [];
            lastNums = [];           // â˜… è¿½åŠ ï¼šå±¥æ­´ã‚‚ãƒªã‚»ãƒƒãƒˆ
        }

        function generateRandomNumber() {
            let n;
            do { 
                n = Math.floor(Math.random() * 19) + 2; // 2-20ã®ç¯„å›²
            } while(lastNums.includes(n));
            lastNums = [n, ...lastNums].slice(0, 3); // ç›´å‰3å•ã‚’è¨˜éŒ²
            return n;
        }

        function getDivisors(num) {
            const divisors = [];
            for (let i = 1; i <= num; i++) {
                if (num % i === 0) {
                    divisors.push(i);
                }
            }
            return divisors;
        }

        function createNumberButtons() {
            if (gameMode === 'single') {
                const container = document.getElementById('numberButtons');
                container.innerHTML = '';
                
                for (let i = 1; i <= 20; i++) {
                    const button = document.createElement('button');
                    button.textContent = i;
                    button.className = 'bg-gray-200 hover:bg-gray-300 text-gray-800 font-medium py-2 px-3 rounded transition-colors';
                    button.onclick = () => toggleNumber(i, button);
                    button.id = `s-btn-${i}`;
                    container.appendChild(button);
                }
            } else {
                // ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼1ã®ãƒœã‚¿ãƒ³
                const player1Container = document.getElementById('player1Buttons');
                player1Container.innerHTML = '';
                
                for (let i = 1; i <= 20; i++) {
                    const button = document.createElement('button');
                    button.textContent = i;
                    button.className = 'bg-gray-200 hover:bg-gray-300 text-gray-800 font-medium py-2 px-2 rounded transition-colors text-sm';
                    button.onclick = () => togglePlayerNumber(1, i, button);
                    button.id = `p1-btn-${i}`;
                    player1Container.appendChild(button);
                }

                // ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼2ã®ãƒœã‚¿ãƒ³
                const player2Container = document.getElementById('player2Buttons');
                player2Container.innerHTML = '';
                
                for (let i = 1; i <= 20; i++) {
                    const button = document.createElement('button');
                    button.textContent = i;
                    button.className = 'bg-gray-200 hover:bg-gray-300 text-gray-800 font-medium py-2 px-2 rounded transition-colors text-sm';
                    button.onclick = () => togglePlayerNumber(2, i, button);
                    button.id = `p2-btn-${i}`;
                    player2Container.appendChild(button);
                }
            }
        }

        function toggleNumber(num, button) {
            const index = selectedNumbers.indexOf(num);
            if (index === -1) {
                selectedNumbers.push(num);
                button.className = 'bg-indigo-500 text-white font-medium py-2 px-3 rounded transition-colors';
            } else {
                selectedNumbers.splice(index, 1);
                button.className = 'bg-gray-200 hover:bg-gray-300 text-gray-800 font-medium py-2 px-3 rounded transition-colors';
            }
            
            updateSelectedDisplay();
        }

        function togglePlayerNumber(player, num, button) {
            // æ—©æŠ¼ã—ãƒ¢ãƒ¼ãƒ‰ï¼šç¾åœ¨ã®ã‚¿ãƒ¼ãƒ³ã§ãªã„å ´åˆã¯æ“ä½œä¸å¯
            if (currentTurn !== 0 && currentTurn !== player) return;
            if (gameEnded) return;

            const selectedArray = player === 1 ? player1SelectedNumbers : player2SelectedNumbers;
            const index = selectedArray.indexOf(num);
            
            if (index === -1) {
                selectedArray.push(num);
                button.className = player === 1 ? 
                    'bg-blue-500 text-white font-medium py-2 px-2 rounded transition-colors text-sm' :
                    'bg-green-500 text-white font-medium py-2 px-2 rounded transition-colors text-sm';
            } else {
                selectedArray.splice(index, 1);
                button.className = 'bg-gray-200 hover:bg-gray-300 text-gray-800 font-medium py-2 px-2 rounded transition-colors text-sm';
            }
            
            updatePlayerSelectedDisplay(player);
        }

        function updateSelectedDisplay() {
            const display = document.getElementById('selectedNumbers');
            if (selectedNumbers.length === 0) {
                display.textContent = 'ãªã—';
            } else {
                display.textContent = selectedNumbers.sort((a, b) => a - b).join(', ');
            }
        }

        function updatePlayerSelectedDisplay(player) {
            const selectedArray = player === 1 ? player1SelectedNumbers : player2SelectedNumbers;
            const displayId = player === 1 ? 'player1Selected' : 'player2Selected';
            const display = document.getElementById(displayId);
            
            if (selectedArray.length === 0) {
                display.textContent = 'ãªã—';
            } else {
                display.textContent = selectedArray.sort((a, b) => a - b).join(', ');
            }
        }

        function clearSelection() {
            selectedNumbers = [];
            createNumberButtons();
            updateSelectedDisplay();
        }

        function clearPlayerSelection(player) {
            if (player === 1) {
                player1SelectedNumbers = [];
            } else {
                player2SelectedNumbers = [];
            }
            createNumberButtons();
            updatePlayerSelectedDisplay(player);
        }

        function startSingleGame() {
            gameMode = 'single';
            showScreen('gameScreen');
            resetGame();
            timeLeft = 45;
            score = 0;
            
            // 1äººãƒ¢ãƒ¼ãƒ‰ç”¨UIè¡¨ç¤º
            document.getElementById('singleModeProblem').classList.remove('hidden');
            document.getElementById('singleModeButtons').classList.remove('hidden');
            document.getElementById('singleModeControls').classList.remove('hidden');
            document.getElementById('multiModeButtons').classList.add('hidden');
            
            // ã‚²ãƒ¼ãƒ æƒ…å ±è¡¨ç¤º
            document.getElementById('gameInfo').style.display = 'block';
            document.getElementById('gameInfo').innerHTML = `
                <div class="flex justify-between items-center bg-blue-50 p-4 rounded-lg">
                    <div class="text-blue-800">
                        <span class="font-medium">1äººãƒ¢ãƒ¼ãƒ‰</span>
                    </div>
                    <div class="text-blue-800">
                        <span class="font-medium">å¾—ç‚¹: <span id="currentScore">${score}</span></span>
                    </div>
                    <div class="text-blue-800">
                        <span class="font-medium">æ®‹ã‚Šæ™‚é–“: <span id="timeDisplay">${timeLeft}</span>ç§’</span>
                    </div>
                </div>
            `;
            
            startNewQuestion();
            startTimer();
            singleLocked = false;
        }

        function startMultiGameFromRules() {
            gameMode = 'multi';
            player1Name = document.getElementById('rulesPlayer1Name').value || 'ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼1';
            player2Name = document.getElementById('rulesPlayer2Name').value || 'ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼2';
            targetScore = parseInt(document.getElementById('rulesTargetScore').value);
            
            showScreen('gameScreen');
            resetGame();
            
            // 2äººãƒ¢ãƒ¼ãƒ‰ç”¨UIè¡¨ç¤º
            document.getElementById('singleModeProblem').classList.add('hidden');
            document.getElementById('singleModeButtons').classList.add('hidden');
            document.getElementById('singleModeControls').classList.add('hidden');
            document.getElementById('multiModeButtons').classList.remove('hidden');
            
            // ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼åã‚’è¡¨ç¤ºã«åæ˜ 
            document.getElementById('player1NameDisplay').textContent = player1Name;
            document.getElementById('player2NameDisplay').textContent = player2Name;
            
            // ã‚²ãƒ¼ãƒ æƒ…å ±ã‚’éè¡¨ç¤ºï¼ˆ2äººãƒ¢ãƒ¼ãƒ‰ã§ã¯ä¸è¦ï¼‰
            document.getElementById('gameInfo').style.display = 'none';
            
            // ã‚¿ã‚¤ãƒˆãƒ«ã‚’éè¡¨ç¤ºï¼ˆ2äººãƒ¢ãƒ¼ãƒ‰ã§ã¯ä¸è¦ï¼‰
            document.getElementById('mainTitle').style.display = 'none';
            
            startNewMultiQuestion();
        }

        function startMultiGame() {
            gameMode = 'multi';
            player1Name = document.getElementById('player1Name').value || 'ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼1';
            player2Name = document.getElementById('player2Name').value || 'ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼2';
            targetScore = parseInt(document.getElementById('targetScore').value);
            
            showScreen('gameScreen');
            resetGame();
            
            // 2äººãƒ¢ãƒ¼ãƒ‰ç”¨UIè¡¨ç¤º
            document.getElementById('singleModeProblem').classList.add('hidden');
            document.getElementById('singleModeButtons').classList.add('hidden');
            document.getElementById('singleModeControls').classList.add('hidden');
            document.getElementById('multiModeButtons').classList.remove('hidden');
            
            // ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼åã‚’è¡¨ç¤ºã«åæ˜ 
            document.getElementById('player1NameDisplay').textContent = player1Name;
            document.getElementById('player2NameDisplay').textContent = player2Name;
            
            // ã‚²ãƒ¼ãƒ æƒ…å ±ã‚’éè¡¨ç¤ºï¼ˆ2äººãƒ¢ãƒ¼ãƒ‰ã§ã¯ä¸è¦ï¼‰
            document.getElementById('gameInfo').style.display = 'none';
            
            // ã‚¿ã‚¤ãƒˆãƒ«ã‚’éè¡¨ç¤ºï¼ˆ2äººãƒ¢ãƒ¼ãƒ‰ã§ã¯ä¸è¦ï¼‰
            document.getElementById('mainTitle').style.display = 'none';
            
            startNewMultiQuestion();
        }

        function startNewQuestion() {
            currentNumber = generateRandomNumber();
            document.getElementById('currentNumberSingle').textContent = currentNumber;
            clearSelection();
            document.getElementById('resultDisplay').classList.add('hidden');
            singleLocked = false;
            document.getElementById('submitBtn').disabled = false;
        }

        function startNewMultiQuestion() {
            currentNumber = generateRandomNumber();
            document.getElementById('currentNumberP1').textContent = currentNumber;
            document.getElementById('currentNumberP2').textContent = currentNumber;
            
            // 2äººãƒ¢ãƒ¼ãƒ‰ç”¨ã®ã‚¯ãƒªã‚¢
            player1SelectedNumbers = [];
            player2SelectedNumbers = [];
            currentTurn = 0; // ä¸¡æ–¹ã®ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ãŒå›ç­”å¯èƒ½
            gameEnded = false;
            
            createNumberButtons();
            updatePlayerSelectedDisplay(1);
            updatePlayerSelectedDisplay(2);
            
            // ã‚¹ã‚³ã‚¢è¡¨ç¤ºã‚’æ›´æ–°
            document.getElementById('player1ScoreArea').textContent = `${player1Name}: ${player1Score}ç‚¹`;
            document.getElementById('player2ScoreArea').textContent = `${player2Name}: ${player2Score}ç‚¹`;
            document.getElementById('player1Status').textContent = '';
            document.getElementById('player2Status').textContent = '';
            
            document.getElementById('resultDisplay').classList.add('hidden');
            document.getElementById('gameStatus').textContent = 'æ—©æŠ¼ã—ã§å›ç­”ã—ã¦ãã ã•ã„ï¼';
            document.getElementById('currentTurnIndicator').textContent = '';
            
            // ä¸¡ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚’æœ‰åŠ¹åŒ–
            setPlayerActive(1, true);
            setPlayerActive(2, true);
            
            questionStartTime = Date.now();
        }

        function startTimer() {
            gameTimer = setInterval(() => {
                timeLeft--;
                document.getElementById('timeDisplay').textContent = timeLeft;
                
                if (timeLeft <= 0) {
                    endSingleGame();
                }
            }, 1000);
        }

        function submitAnswer() { // ã‚·ãƒ³ã‚°ãƒ«å°‚ç”¨
            if (gameMode === 'single') submitSingleAnswer();
        }

        function submitSingleAnswer() {
            if (singleLocked) return;
            singleLocked = true;
            
            const correctDivisors = getDivisors(currentNumber);
            const isCorrect = arraysEqual(selectedNumbers.sort((a, b) => a - b), correctDivisors.sort((a, b) => a - b));
            
            const resultDiv = document.getElementById('resultDisplay');
            resultDiv.classList.remove('hidden');
            
            if (isCorrect) {
                score++;
                document.getElementById('currentScore').textContent = score;
                resultDiv.innerHTML = `
                    <div class="bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded mb-4">
                        <strong>æ­£è§£ï¼</strong> ${currentNumber}ã®ç´„æ•°: ${correctDivisors.join(', ')}
                    </div>
                `;
            } else {
                // é–“é•ãˆãŸå•é¡Œã‚’è¨˜éŒ²
                wrongAnswers.push({
                    number: currentNumber,
                    correctAnswer: correctDivisors,
                    userAnswer: [...selectedNumbers].sort((a, b) => a - b)
                });
                
                resultDiv.innerHTML = `
                    <div class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-4">
                        <strong>ä¸æ­£è§£</strong> æ­£è§£: ${correctDivisors.join(', ')} / ã‚ãªãŸã®å›ç­”: ${selectedNumbers.sort((a, b) => a - b).join(', ') || 'ãªã—'}
                    </div>
                `;
            }
            
            // é€ä¿¡ãƒœã‚¿ãƒ³ã‚’ç„¡åŠ¹åŒ–
            document.getElementById('submitBtn').disabled = true;
            // æ•°å­—ãƒœã‚¿ãƒ³ã‚‚ä¸€æ™‚ç„¡åŠ¹åŒ–
            for (let i = 1; i <= 20; i++) {
                const b = document.getElementById(`s-btn-${i}`);
                if (b) { 
                    b.onclick = null; 
                    b.classList.add('cursor-not-allowed'); 
                }
            }
            
            // æ­£è§£ã‚’ç·‘ã§ãƒã‚¤ãƒ©ã‚¤ãƒˆ
            correctDivisors.forEach(n=>{
                const b=document.getElementById(`s-btn-${n}`);
                if(b) b.className='bg-green-500 text-white font-medium py-2 px-3 rounded';
            });
            // èª¤ã£ã¦é¸ã‚“ã æ•°ã‚’èµ¤ã§ãƒã‚¤ãƒ©ã‚¤ãƒˆ
            selectedNumbers
                .filter(n=>!correctDivisors.includes(n))
                .forEach(n=>{
                    const b=document.getElementById(`s-btn-${n}`);
                    if(b) b.className='bg-red-500 text-white font-medium py-2 px-3 rounded';
                });
            
            setTimeout(() => {
                if (timeLeft > 0) {
                    startNewQuestion();
                }
            }, 800);
        }

        function submitMultiAnswer(player) {
            if (gameEnded) return;
            if (currentTurn !== 0 && currentTurn !== player) return;
            
            const selectedArray = player === 1 ? player1SelectedNumbers : player2SelectedNumbers;
            const correctDivisors = getDivisors(currentNumber);
            const isCorrect = arraysEqual(selectedArray.sort((a, b) => a - b), correctDivisors.sort((a, b) => a - b));
            const currentTime = Date.now() - questionStartTime;
            const playerName = player === 1 ? player1Name : player2Name;
            const otherPlayer = player === 1 ? 2 : 1;
            const otherPlayerName = player === 1 ? player2Name : player1Name;
            
            if (isCorrect) {
                // æ­£è§£ã®å ´åˆ
                if (player === 1) {
                    player1Score++;
                } else {
                    player2Score++;
                }
                
                gameEnded = true;
                
                // ã‚¹ã‚³ã‚¢è¡¨ç¤ºã‚’æ›´æ–°
                document.getElementById('player1ScoreArea').textContent = `${player1Name}: ${player1Score}ç‚¹`;
                document.getElementById('player2ScoreArea').textContent = `${player2Name}: ${player2Score}ç‚¹`;
                
                // æ­£è§£ã—ãŸãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹è¡¨ç¤º
                const statusElement = document.getElementById(`player${player}Status`);
                statusElement.innerHTML = `<span class="text-green-600">âœ“ æ­£è§£!</span><br><span class="text-xs text-gray-500">${(currentTime / 1000).toFixed(1)}ç§’</span>`;
                
                const resultDiv = document.getElementById('resultDisplay');
                resultDiv.classList.remove('hidden');
                resultDiv.innerHTML = `
                    <div class="fixed inset-0 bg-black bg-opacity-50 flex flex-col z-50">
                        <!-- ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼2ç”¨ï¼ˆä¸ŠåŠåˆ†ãƒ»é€†å‘ãï¼‰ -->
                        <div class="flex-1 bg-green-100 border-b-2 border-green-400 flex items-center justify-center transform rotate-180">
                            <div class="text-center">
                                <div class="text-2xl font-bold text-green-800 mb-2">ğŸ‰ ${playerName} æ­£è§£ï¼</div>
                                <div class="text-lg text-green-700">æ­£è§£: ${correctDivisors.join(', ')}</div>
                                <div class="text-xl font-bold text-purple-600 mt-2">${playerName}ãŒ1ãƒã‚¤ãƒ³ãƒˆç²å¾—ï¼</div>
                            </div>
                        </div>
                        <!-- ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼1ç”¨ï¼ˆä¸‹åŠåˆ†ãƒ»é€šå¸¸å‘ãï¼‰ -->
                        <div class="flex-1 bg-green-100 border-t-2 border-green-400 flex items-center justify-center">
                            <div class="text-center">
                                <div class="text-2xl font-bold text-green-800 mb-2">ğŸ‰ ${playerName} æ­£è§£ï¼</div>
                                <div class="text-lg text-green-700">æ­£è§£: ${correctDivisors.join(', ')}</div>
                                <div class="text-xl font-bold text-purple-600 mt-2">${playerName}ãŒ1ãƒã‚¤ãƒ³ãƒˆç²å¾—ï¼</div>
                            </div>
                        </div>
                    </div>
                `;
                
                document.getElementById('gameStatus').textContent = `${playerName}ã®å‹åˆ©ï¼`;
                disableAllButtons();
                
                if (player1Score >= targetScore || player2Score >= targetScore) {
                    setTimeout(() => {
                        endMultiGame();
                    }, 1500);
                } else {
                    setTimeout(() => {
                        startNewMultiQuestion();
                    }, 1500);
                }
            } else {
                // ä¸æ­£è§£ã®å ´åˆ
                currentTurn = otherPlayer; // ç›¸æ‰‹ã®ã‚¿ãƒ¼ãƒ³ã«
                
                // ä¸æ­£è§£ã—ãŸãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹è¡¨ç¤º
                const statusElement = document.getElementById(`player${player}Status`);
                statusElement.innerHTML = `<span class="text-red-600">âœ— ä¸æ­£è§£</span><br><span class="text-xs text-gray-500">${(currentTime / 1000).toFixed(1)}ç§’</span>`;
                
                // ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®æœ‰åŠ¹/ç„¡åŠ¹ã‚’åˆ‡ã‚Šæ›¿ãˆ
                setPlayerActive(player, false);          // é–“é•ãˆãŸå´ã‚’ç„¡åŠ¹åŒ–
                setPlayerActive(otherPlayer, true);      // ç›¸æ‰‹ã‚’æœ‰åŠ¹åŒ–ï¼ˆéå»ã«èª¤ç­”ã—ã¦ç„¡åŠ¹åŒ–ã•ã‚Œã¦ã¦ã‚‚å¾©æ´»ã•ã›ã‚‹ï¼‰
                
                document.getElementById('gameStatus').textContent = `${playerName}ä¸æ­£è§£ï¼`;
                document.getElementById('currentTurnIndicator').textContent = `${otherPlayerName}ã®ã‚¿ãƒ¼ãƒ³`;
                
                const resultDiv = document.getElementById('resultDisplay');
                resultDiv.classList.remove('hidden');
                resultDiv.innerHTML = `
                    <div class="fixed inset-0 bg-black bg-opacity-50 flex flex-col z-50">
                        <!-- ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼2ç”¨ï¼ˆä¸ŠåŠåˆ†ãƒ»é€†å‘ãï¼‰ -->
                        <div class="flex-1 bg-red-100 border-b-2 border-red-400 flex items-center justify-center transform rotate-180">
                            <div class="text-center">
                                <div class="text-xl font-bold text-red-800">${playerName} ä¸æ­£è§£</div>
                                <div class="text-lg text-red-700">å›ç­”: ${selectedArray.sort((a, b) => a - b).join(', ') || 'ãªã—'}</div>
                                <div class="text-lg font-bold text-blue-600 mt-2">${otherPlayerName}ã®ã‚¿ãƒ¼ãƒ³</div>
                            </div>
                        </div>
                        <!-- ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼1ç”¨ï¼ˆä¸‹åŠåˆ†ãƒ»é€šå¸¸å‘ãï¼‰ -->
                        <div class="flex-1 bg-red-100 border-t-2 border-red-400 flex items-center justify-center">
                            <div class="text-center">
                                <div class="text-xl font-bold text-red-800">${playerName} ä¸æ­£è§£</div>
                                <div class="text-lg text-red-700">å›ç­”: ${selectedArray.sort((a, b) => a - b).join(', ') || 'ãªã—'}</div>
                                <div class="text-lg font-bold text-blue-600 mt-2">${otherPlayerName}ã®ã‚¿ãƒ¼ãƒ³</div>
                            </div>
                        </div>
                    </div>
                `;
                
                setTimeout(() => {
                    document.getElementById('resultDisplay').classList.add('hidden');
                }, 1000);
            }
        }

        function disableAllButtons() {
            // å…¨ã¦ã®é€ä¿¡ãƒœã‚¿ãƒ³ã‚’ç„¡åŠ¹åŒ–
            document.getElementById('player1SubmitBtn').disabled = true;
            document.getElementById('player2SubmitBtn').disabled = true;
            document.getElementById('player1SubmitBtn').className = 'bg-gray-400 text-white font-medium py-2 px-6 rounded-lg cursor-not-allowed';
            document.getElementById('player2SubmitBtn').className = 'bg-gray-400 text-white font-medium py-2 px-6 rounded-lg cursor-not-allowed';
            
            // å…¨ã¦ã®æ•°å­—ãƒœã‚¿ãƒ³ã‚’ç„¡åŠ¹åŒ–
            for (let i = 1; i <= 20; i++) {
                const btn1 = document.getElementById(`p1-btn-${i}`);
                const btn2 = document.getElementById(`p2-btn-${i}`);
                if (btn1) {
                    btn1.onclick = null;
                    btn1.className = btn1.className.replace('hover:bg-gray-300', '').replace('hover:bg-blue-600', '').replace('hover:bg-green-600', '');
                }
                if (btn2) {
                    btn2.onclick = null;
                    btn2.className = btn2.className.replace('hover:bg-gray-300', '').replace('hover:bg-blue-600', '').replace('hover:bg-green-600', '');
                }
            }
        }



        function endSingleGame() {
            clearInterval(gameTimer);
            showScreen('resultScreen');
            
            let reviewSection = '';
            if (wrongAnswers.length > 0) {
                reviewSection = `
                    <div class="mt-8 p-6 bg-yellow-50 rounded-lg border border-yellow-200">
                        <h3 class="text-xl font-semibold text-yellow-800 mb-4">ğŸ“ é–“é•ãˆãŸå•é¡Œã‚’æŒ¯ã‚Šè¿”ã‚ã†</h3>
                        <div class="space-y-3">
                            ${wrongAnswers.map(wrong => `
                                <div class="bg-white p-4 rounded border">
                                    <div class="font-medium text-gray-800 mb-2">å•é¡Œ: ${wrong.number}ã®ç´„æ•°</div>
                                    <div class="text-sm text-green-700">âœ“ æ­£è§£: ${wrong.correctAnswer.join(', ')}</div>
                                    <div class="text-sm text-red-700">âœ— ã‚ãªãŸã®å›ç­”: ${wrong.userAnswer.join(', ') || 'ãªã—'}</div>
                                </div>
                            `).join('')}
                        </div>
                        <div class="mt-4 text-sm text-yellow-700">
                            ğŸ’¡ ç´„æ•°ã¯ã€ãã®æ•°ã‚’å‰²ã‚Šåˆ‡ã‚Œã‚‹æ•°ã®ã“ã¨ã§ã™ã€‚1ã‹ã‚‰é †ç•ªã«å‰²ã‚Šç®—ã—ã¦ã¿ã¾ã—ã‚‡ã†ï¼
                        </div>
                    </div>
                `;
            }
            
            document.getElementById('finalResult').innerHTML = `
                <h2 class="text-3xl font-bold text-indigo-600 mb-4">ã‚²ãƒ¼ãƒ çµ‚äº†ï¼</h2>
                <div class="text-6xl font-bold text-gray-800 mb-4">${score}</div>
                <div class="text-xl text-gray-600 mb-6">å•æ­£è§£</div>
                <div class="text-lg text-gray-500">45ç§’é–“ãŠç–²ã‚Œã•ã¾ã§ã—ãŸï¼</div>
                ${reviewSection}
            `;
        }

        function endMultiGame() {
            showScreen('resultScreen');
            
            const winner = player1Score >= targetScore ? player1Name : player2Name;
            const winnerScore = player1Score >= targetScore ? player1Score : player2Score;
            const loserScore = player1Score >= targetScore ? player2Score : player1Score;
            
            document.getElementById('finalResult').innerHTML = `
                <h2 class="text-3xl font-bold text-green-600 mb-4">ã‚²ãƒ¼ãƒ çµ‚äº†ï¼</h2>
                <div class="text-4xl font-bold text-gray-800 mb-4">ğŸ† ${winner} ã®å‹åˆ©ï¼</div>
                <div class="text-xl text-gray-600 mb-6">
                    æœ€çµ‚ã‚¹ã‚³ã‚¢: ${winnerScore} - ${loserScore}
                </div>
                <div class="text-lg text-gray-500">ãŠç–²ã‚Œã•ã¾ã§ã—ãŸï¼</div>
            `;
        }

        function arraysEqual(a, b) {
            return a.length === b.length && a.every((val, i) => val === b[i]);
        }

        // åˆæœŸåŒ–
        gameMode = 'single'; // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã¯1äººãƒ¢ãƒ¼ãƒ‰
        createNumberButtons();
        updateSelectedDisplay();
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9785d59391098384',t:'MTc1Njc0MDg5My4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
